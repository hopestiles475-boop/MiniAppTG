<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>NFT Cases</title>
    <!-- –í–ï–†–°–ò–Ø –§–ê–ô–õ–ê: 2024-12-19-TonConnect-Fix-v2 -->
    <noscript>
        <div style="position:fixed;top:0;left:0;width:100%;height:100%;background:red;color:white;z-index:99999;padding:20px;font-size:24px;">
            ‚ö†Ô∏è JavaScript –æ—Ç–∫–ª—é—á–µ–Ω! –í–∫–ª—é—á–∏—Ç–µ JavaScript –¥–ª—è —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
        </div>
    </noscript>
    <script>
        // –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê - –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ü–ï–†–í–´–ú
        // –í–ï–†–°–ò–Ø: 2024-12-19-TonConnect-Fix-v2
        (function() {
            'use strict';
            try {
                console.log('üöÄ –°–¢–†–ê–ù–ò–¶–ê –ù–ê–ß–ê–õ–ê –ó–ê–ì–†–£–ñ–ê–¢–¨–°–Ø - –í–ï–†–°–ò–Ø v2');
                console.log('Timestamp:', new Date().toISOString());
                console.log('User Agent:', navigator.userAgent);
                console.log('URL:', window.location.href);
                
                // –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ CSP
                try {
                    const testDiv = document.createElement('div');
                    testDiv.style.display = 'none';
                    document.body.appendChild(testDiv);
                    console.log('‚úÖ DOM –¥–æ—Å—Ç—É–ø–µ–Ω');
                } catch(e) {
                    console.error('‚ùå DOM –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:', e);
                }
                
                // –ü–µ—Ä–µ—Ö–≤–∞—Ç –≤—Å–µ—Ö –æ—à–∏–±–æ–∫
                window.addEventListener('error', function(e) {
                    console.error('‚ùå –ì–õ–û–ë–ê–õ–¨–ù–ê–Ø –û–®–ò–ë–ö–ê:', e.message, e.filename, e.lineno);
                }, true);
                
                // –ü–µ—Ä–µ—Ö–≤–∞—Ç –Ω–µ–ø–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–Ω—ã—Ö –ø—Ä–æ–º–∏—Å–æ–≤
                window.addEventListener('unhandledrejection', function(e) {
                    console.error('‚ùå –û–®–ò–ë–ö–ê –ü–†–û–ú–ò–°–ê:', e.reason);
                });
            } catch(err) {
                alert('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: ' + err.message);
            }
        })();
    </script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        // –ü–ï–†–ï–•–í–ê–¢–´–í–ê–ï–ú –û–®–ò–ë–ö–ò –û–¢ TELEGRAM SDK
        window.addEventListener('error', function(e) {
            if (e.message && (e.message.includes("reading 'top'") || e.message.includes('calculatePosition'))) {
                e.preventDefault();
                return true;
            }
        }, true);
        
        window.addEventListener('unhandledrejection', function(e) {
            if (e.reason && e.reason.message && (e.reason.message.includes("reading 'top'") || e.reason.message.includes('calculatePosition'))) {
                e.preventDefault();
                return true;
            }
        });
        
        // –§–£–ù–ö–¶–ò–Ø –ù–ê–í–ò–ì–ê–¶–ò–ò - –û–ü–†–ï–î–ï–õ–Ø–ï–ú –í HEAD –ß–¢–û–ë–´ –ë–´–õ–ê –î–û–°–¢–£–ü–ù–ê –°–†–ê–ó–£
        // –ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è —É–∂–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞, –Ω–µ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º
        if (!window.handleNavClick) {
            window.handleNavClick = function(page, clickedItem) {
                if (!page) return;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É
                var items = document.querySelectorAll('.nav-item');
                for (var i = 0; i < items.length; i++) {
                    items[i].classList.remove('active');
                }
                if (clickedItem) clickedItem.classList.add('active');
                
                // –ü–æ–ª—É—á–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                var mainPage = document.getElementById('mainPage');
                var profilePage = document.getElementById('profilePage');
                var crashPage = document.getElementById('crashPage');
                var minesPage = document.getElementById('minesPage');
                var dicePage = document.getElementById('dicePage');
                var caseDetailPage = document.getElementById('caseDetailPage');
                var header = document.querySelector('.header');
                var openBtn = document.getElementById('openBtn');
                
                if (!mainPage || !profilePage) return;
                
                // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –≤–∫–ª—é—á–∞—è –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –∫–µ–π—Å–∞
                var pages = [mainPage, profilePage];
                if (crashPage) pages.push(crashPage);
                if (minesPage) pages.push(minesPage);
                if (dicePage) pages.push(dicePage);
                if (caseDetailPage) pages.push(caseDetailPage);
                
                for (var i = 0; i < pages.length; i++) {
                    if (pages[i]) {
                        pages[i].style.display = 'none';
                        pages[i].style.visibility = 'hidden';
                        pages[i].style.opacity = '0';
                        pages[i].style.pointerEvents = 'none';
                        pages[i].classList.remove('active');
                        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è caseDetailPage
                        if (pages[i].id === 'caseDetailPage') {
                            pages[i].style.position = 'fixed';
                            pages[i].style.top = '0';
                            pages[i].style.left = '0';
                            pages[i].style.right = '0';
                            pages[i].style.bottom = '0';
                            pages[i].style.zIndex = '-1';
                        }
                    }
                }
                
                // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–û—Ç–∫—Ä—ã—Ç—å" –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –≤–∫–ª–∞–¥–æ–∫
                if (openBtn) {
                    openBtn.style.display = 'none';
                    openBtn.style.visibility = 'hidden';
                    openBtn.style.opacity = '0';
                    openBtn.classList.remove('show');
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º
                if (page === 'cases' && mainPage) {
                    if (header) header.style.display = 'flex';
                    mainPage.style.display = 'block';
                    mainPage.style.visibility = 'visible';
                    mainPage.style.opacity = '1';
                    mainPage.style.pointerEvents = 'auto';
                    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–µ–π—Å—ã
                    setTimeout(function() {
                        if (typeof initCaseCards === 'function') initCaseCards();
                        if (typeof initOpenButton === 'function') initOpenButton();
                    }, 50);
                } else if (page === 'profile' && profilePage) {
                    if (header) header.style.display = 'flex';
                    profilePage.style.display = 'block';
                    profilePage.style.visibility = 'visible';
                    profilePage.style.opacity = '1';
                    profilePage.style.pointerEvents = 'auto';
                    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–æ—Ñ–∏–ª—å
                    setTimeout(function() {
                        if (typeof updateProfileInfo === 'function') updateProfileInfo();
                        if (typeof updateInventory === 'function') updateInventory();
                        if (typeof initProfileHandlers === 'function') initProfileHandlers();
                        if (typeof initTopUpHandlers === 'function') initTopUpHandlers();
                        if (typeof initWithdrawHandlers === 'function') initWithdrawHandlers();
                    }, 50);
                } else if (page === 'crash' && crashPage) {
                    if (header) header.style.display = 'none';
                    crashPage.style.display = 'block';
                    crashPage.style.visibility = 'visible';
                    crashPage.style.opacity = '1';
                    crashPage.style.position = 'fixed';
                    crashPage.style.top = '0';
                    crashPage.style.left = '0';
                    crashPage.style.right = '0';
                    crashPage.style.bottom = '0';
                    crashPage.style.width = '100%';
                    crashPage.style.height = '100%';
                    crashPage.style.zIndex = '100';
                    crashPage.style.pointerEvents = 'auto';
                    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫—Ä–∞—à –∏–≥—Ä—É
                    console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã –ö—Ä–∞—à...');
                    setTimeout(function() {
                        if (typeof updateBalanceDisplay === 'function') updateBalanceDisplay();
                        if (typeof initCrashGame === 'function') {
                            console.log('‚úÖ –í—ã–∑—ã–≤–∞—é initCrashGame');
                            initCrashGame();
                        } else {
                            console.error('‚ùå initCrashGame –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
                        }
                    }, 50);
                    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤—ã–∑–æ–≤—ã –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
                    setTimeout(function() {
                        if (typeof initCrashGame === 'function') {
                            console.log('‚úÖ –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—ã–∑–æ–≤ initCrashGame');
                            initCrashGame();
                        }
                    }, 200);
                    setTimeout(function() {
                        if (typeof initCrashGame === 'function') {
                            console.log('‚úÖ –¢—Ä–µ—Ç–∏–π –≤—ã–∑–æ–≤ initCrashGame');
                            initCrashGame();
                        }
                    }, 500);
                } else if (page === 'mines' && minesPage) {
                    if (header) header.style.display = 'flex';
                    minesPage.style.display = 'block';
                    minesPage.style.visibility = 'visible';
                    minesPage.style.opacity = '1';
                    minesPage.style.position = 'fixed';
                    minesPage.style.top = '0';
                    minesPage.style.left = '0';
                    minesPage.style.right = '0';
                    minesPage.style.bottom = '0';
                    minesPage.style.width = '100%';
                    minesPage.style.height = '100%';
                    minesPage.style.zIndex = '100';
                    minesPage.style.pointerEvents = 'auto';
                    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –º–∏–Ω—ã –∏–≥—Ä—É
                    setTimeout(function() {
                        if (typeof updateBalanceDisplay === 'function') updateBalanceDisplay();
                        if (typeof initMinesGame === 'function') initMinesGame();
                    }, 50);
                } else if (page === 'dice' && dicePage) {
                    if (header) header.style.display = 'flex';
                    dicePage.style.display = 'block';
                    dicePage.style.visibility = 'visible';
                    dicePage.style.opacity = '1';
                    dicePage.style.position = 'fixed';
                    dicePage.style.top = '0';
                    dicePage.style.left = '0';
                    dicePage.style.right = '0';
                    dicePage.style.bottom = '0';
                    dicePage.style.width = '100%';
                    dicePage.style.height = '100%';
                    dicePage.style.zIndex = '100';
                    dicePage.style.pointerEvents = 'auto';
                    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º dice –∏–≥—Ä—É
                    setTimeout(function() {
                        if (typeof updateBalanceDisplay === 'function') updateBalanceDisplay();
                        if (typeof initDiceGame === 'function') initDiceGame();
                    }, 50);
                }
            };
        }
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--tg-theme-bg-color, #0a0a0a);
            color: var(--tg-theme-text-color, #ffffff);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 20px;
        }

        /* –°–∫—Ä—ã–≤–∞–µ–º header –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∫—Ä–∞—à–∞ */
        #crashPage ~ .header,
        .crash-page ~ .header {
            display: none;
        }

        .profile-section {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            overflow: hidden;
            position: relative;
        }

        .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .username {
            font-weight: 600;
            font-size: 16px;
            color: #ffffff;
        }

        .balance-section {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 16px;
            border-radius: 20px;
        }
        
        .balance-section, .balance-text {
            color: #ffffff !important;
        }

        .diamond-icon {
            width: 18px;
            height: 18px;
            display: inline-block;
            background-image: url('ton_symbol.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            vertical-align: middle;
        }
        
        .currency-icon {
            width: 16px;
            height: 16px;
            display: inline-block;
            background-image: url('ton_symbol.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            vertical-align: middle;
            margin-right: 2px;
        }

        .balance-text {
            font-weight: 600;
            font-size: 16px;
        }

        .ton-balance {
            display: none !important;
            visibility: hidden !important;
            font-size: 24px;
            font-weight: 700;
            margin: 10px 20px;
            color: #ffffff;
        }

        .demo-badge {
            display: none !important;
            visibility: hidden !important;
            background: #667eea;
            padding: 4px 12px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }

        .subscribe-btn {
            cursor: pointer !important;
            pointer-events: auto !important;
            position: relative !important;
            z-index: 10 !important;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 15px auto;
            padding: 20px;
            border-radius: 16px;
            border: none;
            color: white;
            cursor: pointer;
            gap: 15px;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3);
            transition: all 0.3s;
            max-width: 90%;
            width: 100%;
        }

        .subscribe-btn:active {
            transform: scale(0.98);
            box-shadow: 0 2px 10px rgba(102, 126, 234, 0.2);
        }

        .subscribe-inner {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            font-size: 18px;
            font-weight: 700;
            width: 100%;
        }

        .subscribe-icon {
            font-size: 24px;
        }

        .subscribe-action {
            background: white;
            color: #667eea;
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            transition: all 0.3s;
            box-shadow: 0 2px 10px rgba(255, 255, 255, 0.2);
        }

        .subscribe-action:active {
            transform: scale(0.95);
        }

        .tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            padding: 0 20px;
            margin-bottom: 15px;
        }

        .tab {
            padding: 10px 20px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: rgba(255, 255, 255, 0.6);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }


        .cases-carousel {
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding: 20px;
            padding-bottom: 100px;
            width: 100%;
            box-sizing: border-box;
        }

        .cases-carousel::-webkit-scrollbar {
            display: none;
        }

        .case-card {
            cursor: pointer !important;
            pointer-events: auto !important;
            position: relative !important;
            z-index: 10 !important;
            width: 100%;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.15) 0%, rgba(118, 75, 162, 0.15) 100%);
            border-radius: 16px;
            padding: 15px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            box-sizing: border-box;
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 15px;
        }

        .case-card:active {
            transform: scale(0.98);
        }

        .case-icon {
            font-size: 80px;
            text-align: center;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 120px;
            min-width: 120px;
            height: 120px;
            background: transparent;
            border-radius: 12px;
            padding: 10px;
            flex-shrink: 0;
        }

        .case-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            display: block;
        }

        .case-icon:empty {
            display: none;
        }

        /* –°–∫—Ä—ã–≤–∞–µ–º fallback —ç–º–æ–¥–∑–∏ –µ—Å–ª–∏ –µ—Å—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ */
        .case-icon img + * {
            display: none;
        }

        .case-price-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            color: #00d4ff;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .case-price-badge .currency-icon {
            width: 14px;
            height: 14px;
        }

        .case-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding-left: 10px;
        }

        .case-name {
            font-size: 18px;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 5px;
        }

        .case-description {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.6);
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            padding: 15px;
            padding-bottom: 100px;
        }

        .page-btn {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.5);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .page-btn.active {
            background: #667eea;
            color: white;
        }

        #mainPage {
            display: block;
            position: relative;
            width: 100%;
            min-height: 100vh;
        }

        #mainPage.hidden {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            position: absolute !important;
            pointer-events: none !important;
        }
        
        #minesPage {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
            overflow-y: auto;
            z-index: 100;
            background: #0a0a0a;
        }
        
        #minesPage[style*="none"] {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            pointer-events: none !important;
        }
        
        #profilePage {
            position: relative;
            width: 100%;
            min-height: 100vh;
        }
        
        #profilePage[style*="none"] {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            position: absolute !important;
            pointer-events: none !important;
        }
        
        #crashPage {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
            overflow-y: auto;
            z-index: 100;
        }
        
        #crashPage[style*="none"] {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            pointer-events: none !important;
        }
        
        #caseDetailPage {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
            overflow-y: auto;
            z-index: 1000;
            background: var(--tg-theme-bg-color, #0a0a0a);
            display: none;
            visibility: hidden;
            opacity: 0;
            pointer-events: none;
        }

        #caseDetailPage.active,
        #caseDetailPage[style*="block"] {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            pointer-events: auto !important;
        }

        .case-detail-page {
            padding: 20px;
            padding-bottom: 120px;
        }

        .case-detail-page.active ~ .open-btn,
        .case-detail-page.active + .open-btn {
            display: flex !important;
        }


        .case-detail-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .case-detail-icon {
            font-size: 120px;
            margin: 20px 0;
            background: transparent;
            border-radius: 16px;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 150px;
        }

        .case-detail-icon img {
            width: 100%;
            max-width: 300px;
            min-width: 150px;
            height: auto;
            max-height: 300px;
            object-fit: contain;
            display: block;
        }

        .roulette-container {
            width: 100%;
            height: 200px;
            position: relative;
            overflow: hidden !important;
            margin: 20px 0;
            border-radius: 16px;
            background: rgba(255, 255, 255, 0.05);
            display: none;
            padding: 0;
            box-sizing: border-box;
            min-height: 200px;
        }
        
        .roulette-wrapper {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden !important;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .roulette-container.active {
            display: block;
        }

        .roulette-track {
            display: flex;
            gap: 20px;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            will-change: transform;
            white-space: nowrap;
            width: auto;
            height: 150px;
            align-items: center;
            margin: 0;
            padding: 0;
            box-sizing: content-box;
        }

        .gift-item {
            width: 150px;
            min-width: 150px;
            max-width: 150px;
            height: 150px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.3) 0%, rgba(118, 75, 162, 0.3) 100%);
            border-radius: 16px;
            display: flex !important;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 3px solid rgba(255, 255, 255, 0.2);
            font-size: 80px;
            position: relative;
            flex-shrink: 0;
            visibility: visible !important;
            opacity: 1 !important;
            z-index: 2;
            transition: none !important;
            pointer-events: auto !important;
            margin: 0;
            padding: 0;
            vertical-align: top;
        }

        .gift-item img {
            width: 80px;
            height: 80px;
            object-fit: contain;
            display: block;
        }

        .gift-item.selected {
            border-color: #00ff00;
            background: rgba(0, 255, 0, 0.2);
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.5);
            transform: scale(1.1);
            z-index: 3;
        }

        .gift-name {
            position: absolute;
            bottom: -25px;
            font-size: 12px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.8);
            white-space: nowrap;
        }

        .center-indicator {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 3px;
            height: 180px;
            background: linear-gradient(to bottom, transparent, #00ff00, transparent);
            z-index: 5;
            pointer-events: none;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
        }

        .case-detail-price {
            font-size: 28px;
            font-weight: 700;
            color: #667eea;
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 6px;
            justify-content: center;
        }
        
        .case-detail-price .currency-icon {
            width: 24px;
            height: 24px;
        }

        .whats-inside-title {
            font-size: 20px;
            font-weight: 700;
            margin: 30px 0 20px 0;
            padding: 0 10px;
            color: #ffffff;
        }

        .prizes-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            padding: 0 10px;
            margin-bottom: 30px;
        }

        .prize-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 15px;
            text-align: center;
            border: 2px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
        }

        .prize-item.win {
            border-color: #00ff00;
            background: rgba(0, 255, 0, 0.1);
            animation: winPulse 1s;
        }

        @keyframes winPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .prize-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            margin-bottom: 10px;
        }

        .prize-icon img {
            width: 60px;
            height: 60px;
            object-fit: contain;
            display: block;
        }

        .prize-value {
            font-size: 16px;
            font-weight: 600;
            color: #667eea;
            display: flex;
            align-items: center;
            gap: 4px;
            justify-content: center;
        }
        
        .prize-value .currency-icon {
            width: 16px;
            height: 16px;
        }

        .open-btn {
            position: fixed !important;
            bottom: 100px !important;
            left: 20px !important;
            right: 20px !important;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            color: white !important;
            border: 3px solid rgba(255, 255, 255, 0.3) !important;
            padding: 18px !important;
            border-radius: 16px !important;
            font-size: 18px !important;
            font-weight: 700 !important;
            cursor: pointer !important;
            display: none !important;
            align-items: center !important;
            justify-content: center !important;
            gap: 10px !important;
            z-index: 99999 !important;
            box-shadow: 0 8px 40px rgba(102, 126, 234, 0.8), 0 0 30px rgba(102, 126, 234, 0.6), inset 0 1px 0 rgba(255, 255, 255, 0.3) !important;
            visibility: hidden !important;
            opacity: 0 !important;
            transition: all 0.3s !important;
            backdrop-filter: blur(10px) !important;
        }
        
        /* –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –Ω–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö –∫—Ä–æ–º–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–µ—Ç–∞–ª–µ–π –∫–µ–π—Å–∞ */
        #mainPage:not(.hidden) ~ .open-btn,
        #profilePage[style*="block"] ~ .open-btn,
        #profilePage:not([style*="none"]) ~ .open-btn {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
        }
        
        .open-btn:hover {
            transform: translateY(-2px) !important;
            box-shadow: 0 10px 50px rgba(102, 126, 234, 1), 0 0 40px rgba(102, 126, 234, 0.8), inset 0 1px 0 rgba(255, 255, 255, 0.4) !important;
        }
        
        .open-btn:active {
            transform: translateY(0) !important;
        }

        .open-btn.show {
            display: flex !important;
            visibility: visible !important;
            opacity: 1 !important;
        }

        /* –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–û—Ç–∫—Ä—ã—Ç—å" –∫–æ–≥–¥–∞ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞–∫—Ç–∏–≤–Ω–æ */
        .modal.active ~ .open-btn,
        .modal.active + * + .open-btn,
        body:has(.modal.active) .open-btn {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
        }

        #caseDetailPage.active ~ #openBtn,
        #caseDetailPage.active + #openBtn {
            display: flex !important;
            visibility: visible !important;
            opacity: 1 !important;
        }

        .open-btn:disabled {
            opacity: 0.5 !important;
            cursor: not-allowed !important;
            pointer-events: none !important;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.5) 0%, rgba(118, 75, 162, 0.5) 100%) !important;
            border-color: rgba(255, 255, 255, 0.2) !important;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3) !important;
            transform: none !important;
        }
        
        .open-btn:disabled:hover {
            transform: none !important;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3) !important;
        }

        .spinning {
            animation: spin 0.1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .spinning-prizes {
            animation: shuffle 0.05s linear infinite;
        }

        @keyframes shuffle {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .back-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: #ffffff;
            padding: 10px 20px;
            border-radius: 12px;
            font-size: 14px;
            cursor: pointer;
            margin-bottom: 20px;
        }

        .modal {
            display: none !important;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex !important;
        }

        /* –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–û—Ç–∫—Ä—ã—Ç—å" —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–µ—Ç–∞–ª–µ–π –∫–æ–≥–¥–∞ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞–∫—Ç–∏–≤–Ω–æ */
        .modal.active ~ #openBtn {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            pointer-events: none !important;
        }

        .modal-content {
            background: rgba(26, 26, 46, 0.85);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 40px;
            padding-bottom: 30px;
            text-align: center;
            max-width: 90%;
            width: 100%;
            max-width: 400px;
            animation: scaleIn 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-sizing: border-box;
        }
        
        .modal-content > * {
            width: 100%;
        }
        
        .modal-content .modal-close {
            width: auto !important;
        }

        .inventory-modal-content {
            max-width: 400px;
            width: 90%;
            padding: 30px;
            position: relative;
        }

        .modal-close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: rgba(255, 255, 255, 0.7);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            z-index: 10;
        }

        .modal-close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            color: #ffffff;
        }

        .modal-close-btn:active {
            transform: scale(0.9);
        }

        .inventory-modal-icon {
            width: 150px;
            height: 150px;
            margin: 20px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 20px;
            background: rgba(102, 126, 234, 0.1);
            padding: 20px;
        }

        .inventory-modal-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            display: block;
        }

        .inventory-modal-name {
            font-size: 28px;
            font-weight: 700;
            color: #ffffff;
            text-align: center;
            margin-bottom: 20px;
        }

        .inventory-modal-price {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            margin-bottom: 30px;
        }

        .price-label {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.6);
            font-weight: 500;
        }

        .price-value {
            font-size: 32px;
            font-weight: 700;
            color: #667eea;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .price-value .currency-icon {
            width: 28px;
            height: 28px;
        }

        .inventory-modal-buttons {
            display: flex;
            gap: 12px;
            width: 100%;
        }

        .inventory-modal-btn {
            flex: 1;
            padding: 16px 24px;
            border-radius: 16px;
            border: none;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .inventory-modal-btn.sell-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
        }

        .inventory-modal-btn.sell-btn:active {
            transform: scale(0.98);
            box-shadow: 0 2px 10px rgba(102, 126, 234, 0.3);
        }

        .inventory-modal-btn.close-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            color: rgba(255, 255, 255, 0.8);
        }

        .inventory-modal-btn.close-btn:active {
            transform: scale(0.98);
            background: rgba(255, 255, 255, 0.15);
        }

        @keyframes scaleIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .modal-prize-icon {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-prize-icon img {
            width: 120px;
            height: 120px;
            object-fit: contain;
            display: block;
        }

        .modal-prize-icon-old {
            font-size: 100px;
            margin: 20px 0;
            animation: bounce 0.6s;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-30px); }
        }

        .modal-prize-name {
            font-size: 28px;
            font-weight: 700;
            margin: 20px 0;
            color: #ffffff;
        }

        .modal-prize-value {
            font-size: 24px;
            color: #667eea;
            font-weight: 700;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 6px;
            justify-content: center;
        }
        
        .modal-prize-value .currency-icon {
            width: 20px;
            height: 20px;
        }

        .modal-open-btn {
            display: none !important;
        }
        
        .modal-open-btn:hover {
            transform: translateY(-2px) !important;
            box-shadow: 0 10px 50px rgba(102, 126, 234, 1), 0 0 40px rgba(102, 126, 234, 0.8), inset 0 1px 0 rgba(255, 255, 255, 0.4) !important;
        }
        
        .modal-open-btn:active {
            transform: translateY(0) !important;
        }

        .modal-close {
            background: rgba(255, 255, 255, 0.08) !important;
            color: rgba(255, 255, 255, 0.7) !important;
            border: 2px solid rgba(255, 255, 255, 0.2) !important;
            padding: 10px 25px !important;
            border-radius: 12px !important;
            font-size: 14px !important;
            font-weight: 500 !important;
            cursor: pointer !important;
            width: auto !important;
            min-width: 100px !important;
            max-width: 150px !important;
            margin: 0 auto !important;
            display: block !important;
            box-sizing: border-box !important;
            text-align: center !important;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2) !important;
            transition: all 0.3s !important;
            align-self: center !important;
        }
        
        .modal-close:hover {
            background: rgba(255, 255, 255, 0.15) !important;
            border-color: rgba(255, 255, 255, 0.35) !important;
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3) !important;
        }
        
        .modal-close:active {
            transform: translateY(0);
        }

        .bottom-nav {
            position: fixed !important;
            bottom: 0 !important;
            left: 0 !important;
            right: 0 !important;
            background: rgba(10, 10, 10, 0.98);
            backdrop-filter: blur(20px);
            border-top: 2px solid rgba(255, 255, 255, 0.15);
            display: flex !important;
            justify-content: space-around;
            padding: 12px 0;
            z-index: 9999 !important;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.5);
            pointer-events: auto !important;
        }

        .nav-item {
            cursor: pointer !important;
            pointer-events: auto !important;
            position: relative !important;
            z-index: 100 !important;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px 20px;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            transition: all 0.3s;
        }

        .nav-item.active {
            color: #667eea;
        }
        
        .nav-item.active .nav-icon {
            transform: scale(1.1);
        }

        .nav-icon {
            font-size: 24px;
        }

        .nav-label {
            font-size: 12px;
            font-weight: 500;
        }

        .profile-page {
            padding: 20px;
            padding-bottom: 120px;
            min-height: 100vh;
            position: relative;
            z-index: 1;
        }

        .profile-header {
            text-align: center;
            margin-bottom: 30px;
            margin-top: 20px;
        }

        .profile-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border: 4px solid rgba(255, 255, 255, 0.2);
        }

        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-username {
            font-size: 24px;
            font-weight: 700;
            color: #ffffff;
        }

        .top-up-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            justify-content: center;
        }

        .top-up-btn {
            cursor: pointer !important;
            pointer-events: auto !important;
            position: relative !important;
            z-index: 10 !important;
            flex: 1;
            padding: 16px 20px;
            border-radius: 16px;
            border: none;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .top-up-btn.primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .top-up-btn.secondary {
            background: transparent;
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
        }

        .top-up-btn:active {
            transform: scale(0.98);
        }

        .btn-icon {
            font-size: 20px;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è */
        .top-up-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .top-up-modal-content {
            background: #1a1a1a;
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 100%;
            position: relative;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .top-up-modal-title {
            font-size: 22px;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 20px;
            text-align: center;
        }

        .top-up-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .top-up-label {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 600;
        }

        .top-up-input {
            width: 100%;
            padding: 14px 16px;
            border-radius: 12px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            color: white;
            font-size: 16px;
            box-sizing: border-box;
        }

        .top-up-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .top-up-info {
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 12px;
            padding: 12px;
            text-align: center;
        }

        .top-up-info p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            margin: 0;
        }

        .top-up-info span {
            color: #667eea;
            font-weight: 700;
        }

        .top-up-modal.active {
            display: flex !important;
        }

        .payment-methods {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }

        .payment-method-btn {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
            width: 100%;
        }

        .payment-method-btn:active {
            transform: scale(0.98);
            background: rgba(102, 126, 234, 0.2);
            border-color: #667eea;
        }

        .payment-method-icon {
            font-size: 32px;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 12px;
        }

        .payment-method-info {
            flex: 1;
        }

        .payment-method-name {
            font-size: 16px;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 4px;
        }

        .payment-method-desc {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.6);
        }


        .payment-status {
            padding: 12px;
            border-radius: 12px;
            text-align: center;
            font-size: 14px;
            font-weight: 600;
        }

        .payment-status p {
            margin: 0;
        }


        .payment-section {
            margin-top: 10px;
        }

        .telegram-bot-info {
            background: rgba(0, 136, 204, 0.1);
            border: 1px solid rgba(0, 136, 204, 0.3);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            text-align: center;
        }

        .telegram-bot-info p {
            margin: 5px 0;
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
        }

        .telegram-bot-info .bot-instruction {
            color: rgba(255, 255, 255, 0.6);
            font-size: 12px;
        }

        .telegram-bot-btn {
            width: 100%;
            padding: 16px;
            border-radius: 16px;
            border: none;
            background: linear-gradient(135deg, #0088cc 0%, #006699 100%);
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s;
            box-shadow: 0 4px 20px rgba(0, 136, 204, 0.4);
            margin-bottom: 15px;
        }

        .telegram-bot-btn:active {
            transform: scale(0.98);
        }

        .telegram-bot-steps {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .telegram-bot-steps p {
            margin: 0 0 10px 0;
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            font-weight: 600;
        }

        .telegram-bot-steps ol {
            margin: 0;
            padding-left: 20px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 13px;
            line-height: 1.8;
        }

        .telegram-bot-steps code {
            background: rgba(102, 126, 234, 0.3);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
            color: #667eea;
        }

        .telegram-bot-steps span {
            color: #667eea;
            font-weight: 700;
        }

        .check-payment-btn {
            width: 100%;
            padding: 14px;
            border-radius: 12px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .check-payment-btn:active {
            transform: scale(0.98);
            background: rgba(255, 255, 255, 0.15);
        }

        .inventory-section {
            margin-top: 30px;
        }

        .inventory-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .inventory-title {
            font-size: 18px;
            font-weight: 600;
            color: #ffffff;
        }

        .sell-all-btn {
            background: rgba(102, 126, 234, 0.3);
            border: 1px solid rgba(102, 126, 234, 0.5);
            color: #667eea;
            padding: 8px 16px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .sell-all-btn:active {
            transform: scale(0.98);
        }

        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .inventory-slot {
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s;
        }

        .inventory-slot:active {
            transform: scale(0.95);
        }

        .inventory-slot.has-item {
            border-color: rgba(102, 126, 234, 0.5);
            background: rgba(102, 126, 234, 0.1);
        }

        .inventory-slot img {
            width: 80%;
            height: 80%;
            object-fit: contain;
        }

        .inventory-slot .empty-icon {
            font-size: 40px;
            color: rgba(255, 255, 255, 0.3);
        }

        .mines-page {
            padding: 20px;
            padding-bottom: 120px;
            min-height: 100vh;
            background: #0a0a0a;
            position: relative;
            z-index: 1;
        }

        .dice-page {
            padding: 20px;
            padding-bottom: 120px;
            min-height: 100vh;
            background: #0a0a0a;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
            overflow-y: auto;
            z-index: 100;
        }

        .dice-header {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        .dice-balance {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 16px;
            border: 2px solid rgba(102, 126, 234, 0.3);
            color: #ffffff;
            font-size: 18px;
            font-weight: 700;
        }

        .dice-game-container {
            max-width: 500px;
            margin: 0 auto;
        }

        .dice-controls {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .dice-bet-control {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .dice-bet-control label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 16px;
            font-weight: 600;
        }

        .dice-input {
            padding: 10px 15px;
            border-radius: 12px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            color: white;
            font-size: 16px;
            font-weight: 600;
            width: 150px;
            text-align: right;
            box-sizing: border-box;
        }

        .dice-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .dice-threshold-container {
            margin-bottom: 20px;
        }

        .dice-threshold-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            font-weight: 600;
        }

        .dice-threshold-label span:nth-child(2) {
            font-size: 20px;
            font-weight: 700;
            color: #ffffff;
        }

        .dice-slider-wrapper {
            position: relative;
        }

        .dice-slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(to right, #ff0000 0%, #00ff00 100%);
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        .dice-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #ff0000;
            border: 3px solid #ffffff;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(255, 0, 0, 0.5);
        }

        .dice-slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #ff0000;
            border: 3px solid #ffffff;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(255, 0, 0, 0.5);
        }

        .dice-slider-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 12px;
        }

        .dice-roll-type {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .dice-roll-type-btn {
            flex: 1;
            padding: 12px;
            border-radius: 12px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            color: rgba(255, 255, 255, 0.7);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .dice-roll-type-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: rgba(255, 255, 255, 0.5);
            color: white;
        }

        .dice-roll-type-btn:active {
            transform: scale(0.95);
        }

        .dice-auto-control {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .dice-auto-label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 16px;
            font-weight: 600;
        }

        .dice-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }

        .dice-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .dice-switch-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.2);
            transition: 0.3s;
            border-radius: 30px;
        }

        .dice-switch-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        .dice-switch input:checked + .dice-switch-slider {
            background-color: #00ff00;
        }

        .dice-switch input:checked + .dice-switch-slider:before {
            transform: translateX(30px);
        }

        .dice-auto-status {
            color: rgba(255, 255, 255, 0.8);
            font-size: 16px;
            font-weight: 600;
            min-width: 40px;
        }

        .dice-start-btn {
            width: 100%;
            padding: 18px;
            border-radius: 12px;
            border: none;
            background: linear-gradient(135deg, #00ff00 0%, #00cc00 100%);
            color: #000;
            font-size: 20px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 20px rgba(0, 255, 0, 0.4);
            text-transform: uppercase;
        }

        .dice-start-btn:active {
            transform: scale(0.98);
        }

        .dice-start-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .dice-result-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 20px;
            text-align: center;
        }

        .dice-result-display {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .dice-result-value {
            font-size: 72px;
            font-weight: 700;
            color: #ffffff;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .dice-result-text {
            font-size: 18px;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 600;
        }

        .dice-result-value.win {
            color: #00ff00;
        }

        .dice-result-value.lose {
            color: #ff0000;
        }

        .dice-stats {
            display: flex;
            justify-content: space-around;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 15px;
        }

        .dice-stat-item {
            text-align: center;
        }

        .dice-stat-label {
            display: block;
            color: rgba(255, 255, 255, 0.6);
            font-size: 12px;
            margin-bottom: 5px;
        }

        .dice-stat-item span:last-child {
            display: block;
            color: #ffffff;
            font-size: 18px;
            font-weight: 700;
        }

        .mines-header {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        .mines-balance {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 16px;
            border: 2px solid rgba(102, 126, 234, 0.3);
            color: #ffffff;
            font-size: 18px;
            font-weight: 700;
        }

        .mines-game-container {
            max-width: 500px;
            margin: 0 auto;
        }

        .mines-controls {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .mines-bet-control {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .mines-bet-control label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 16px;
            font-weight: 600;
        }

        .mines-input {
            padding: 10px 15px;
            border-radius: 12px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            color: white;
            font-size: 16px;
            font-weight: 600;
            width: 150px;
            text-align: right;
            box-sizing: border-box;
        }

        .mines-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .mines-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .mines-count-control {
            margin-bottom: 15px;
        }

        .mines-count-control label {
            display: block;
            color: rgba(255, 255, 255, 0.8);
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .mines-count-buttons {
            display: flex;
            gap: 10px;
        }

        .mines-count-btn {
            flex: 1;
            padding: 12px;
            border-radius: 12px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            color: rgba(255, 255, 255, 0.7);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .mines-count-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: rgba(255, 255, 255, 0.5);
            color: white;
        }

        .mines-count-btn:active {
            transform: scale(0.95);
        }

        .mines-multiplier-display {
            text-align: center;
            margin-bottom: 15px;
        }

        .mines-multiplier-label {
            color: rgba(255, 255, 255, 0.6);
            font-size: 14px;
            margin-bottom: 5px;
        }

        .mines-multiplier-value {
            color: #00ff00;
            font-size: 28px;
            font-weight: 700;
        }

        .mines-cash-out-btn,
        .mines-start-btn {
            width: 100%;
            padding: 16px;
            border-radius: 12px;
            border: none;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 10px;
        }

        .mines-start-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
        }

        .mines-start-btn:active {
            transform: scale(0.98);
        }

        .mines-cash-out-btn {
            background: linear-gradient(135deg, #00ff00 0%, #00cc00 100%);
            color: #000;
            box-shadow: 0 4px 20px rgba(0, 255, 0, 0.4);
        }

        .mines-cash-out-btn:active {
            transform: scale(0.98);
        }

        .mines-cash-out-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .mines-grid-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .mines-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            max-width: 400px;
            margin: 0 auto;
        }

        .mines-cell {
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
        }

        .mines-cell:active {
            transform: scale(0.95);
        }

        .mines-cell.opened {
            background: rgba(102, 126, 234, 0.3);
            border-color: rgba(102, 126, 234, 0.5);
            cursor: default;
        }

        .mines-cell.mine {
            background: #ff0000;
            border-color: #ff3333;
        }

        .mines-cell.safe {
            background: rgba(0, 255, 0, 0.2);
            border-color: rgba(0, 255, 0, 0.4);
        }

        .mines-stats {
            display: flex;
            justify-content: space-around;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 15px;
        }

        .mines-stat-item {
            text-align: center;
        }

        .mines-stat-label {
            display: block;
            color: rgba(255, 255, 255, 0.6);
            font-size: 12px;
            margin-bottom: 5px;
        }

        .mines-stat-item span:last-child {
            display: block;
            color: #ffffff;
            font-size: 18px;
            font-weight: 700;
        }

        .inventory-slot .next-icon {
            font-size: 30px;
            color: rgba(255, 255, 255, 0.5);
        }

        .inventory-slot .item-value {
            position: absolute;
            bottom: 5px;
            left: 5px;
            right: 5px;
            background: rgba(0, 0, 0, 0.7);
            padding: 4px 6px;
            border-radius: 8px;
            font-size: 10px;
            font-weight: 600;
            color: #00d4ff;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2px;
        }

        .inventory-slot .item-value .currency-icon {
            width: 10px;
            height: 10px;
        }

        .crash-page {
            padding: 20px;
            padding-bottom: 120px;
            min-height: 100vh;
            background: var(--tg-theme-bg-color, #0a0a0a);
        }

        .crash-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .players-count {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(0, 255, 0, 0.2);
            padding: 8px 16px;
            border-radius: 20px;
            color: #00ff00;
            font-weight: 600;
            font-size: 14px;
        }

        .players-icon {
            font-size: 18px;
        }

        .crash-balance {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 16px;
            border-radius: 20px;
        }

        .crash-graph-container {
            width: 100%;
            height: 250px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }

        .crash-graph {
            width: 100%;
            height: 100%;
            position: relative;
        }

        #crashCanvas {
            width: 100%;
            height: 100%;
        }

        .current-multiplier {
            position: absolute;
            top: 15px;
            left: 15px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 20px;
            border-radius: 12px;
            font-size: 24px;
            font-weight: 700;
            color: #00ff00;
            border: 2px solid #00ff00;
        }

        .crash-controls {
            margin-bottom: 20px;
        }

        .multiplier-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .multiplier-btn {
            cursor: pointer !important;
            pointer-events: auto !important;
            position: relative !important;
            z-index: 100 !important;
            padding: 10px 16px;
            border-radius: 12px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .multiplier-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: rgba(255, 255, 255, 0.5);
            color: white;
        }

        .multiplier-btn:active {
            transform: scale(0.95);
        }

        .bet-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .bet-type-btn {
            cursor: pointer !important;
            pointer-events: auto !important;
            position: relative !important;
            z-index: 100 !important;
            flex: 1;
            padding: 12px 20px;
            border-radius: 12px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: all 0.3s;
        }

        .bet-type-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: rgba(255, 255, 255, 0.5);
            color: white;
        }

        .bet-amount-input,
        .bet-item-select {
            width: 100%;
            padding: 14px 16px;
            border-radius: 12px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            color: white;
            font-size: 16px;
            margin-bottom: 15px;
            box-sizing: border-box;
        }

        .bet-amount-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .bet-amount-input:focus,
        .bet-item-select:focus {
            outline: none;
            border-color: #667eea;
        }

        .make-bet-btn {
            width: 100%;
            padding: 18px;
            border-radius: 16px;
            border: none;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
        }

        .make-bet-btn:active {
            transform: scale(0.98);
        }

        .make-bet-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .bets-list {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
        }

        .bets-list-header {
            font-size: 18px;
            font-weight: 600;
            color: white;
            margin-bottom: 15px;
        }

        .bet-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            margin-bottom: 10px;
        }

        .bet-item-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }

        .bet-item-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .bet-item-username {
            font-size: 14px;
            font-weight: 600;
            color: white;
        }

        .bet-item-details {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .bet-item-winnings {
            font-size: 16px;
            font-weight: 700;
            color: #00ff00;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .bet-item-winnings .currency-icon {
            width: 14px;
            height: 14px;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="profile-section">
            <div class="avatar">üë§</div>
            <div class="username" id="username">User</div>
        </div>
        <div class="balance-section">
            <span class="diamond-icon"></span>
            <span class="balance-text" id="balance">0.00</span>
            <button style="background: transparent; border: none; color: #ffffff; font-size: 18px; cursor: pointer; padding: 0 5px;">+</button>
        </div>
    </div>


    <div id="mainPage">
        <button class="subscribe-btn">
            <div class="subscribe-inner">
                <div class="subscribe-icon"></div>
                <span>–ü–æ–¥–ø–∏—à–∏—Å—å –Ω–∞ –Ω–∞—Å</span>
            </div>
            <div class="subscribe-action">–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è</div>
        </button>

        <div class="tabs">
            <button class="tab active" data-tab="cases">–ö–µ–π—Å—ã</button>
        </div>


        <div class="cases-carousel" id="casesCarousel">
            <div class="case-card" data-case="1" data-price="0.1" onclick="try{window.handleCaseClick(1);}catch(e){alert('–û—à–∏–±–∫–∞: '+e.message);}" style="cursor: pointer !important; pointer-events: auto !important; z-index: 999 !important;">
                <div class="case-price-badge"><span class="currency-icon"></span> 0.1</div>
                <div class="case-icon"><img src="IconCase/2c0JGQXrElCDlaNGbYHwgipHo2-yq00qIxcU39IganVzrqDys2-no-bg-preview%20%28carve.photos%29.png" alt="Case 1" onerror="console.error('Failed to load image:', this.src)"></div>
                <div class="case-info">
                    <div class="case-name">–ö–µ–π—Å #1</div>
                    <div class="case-description">9 –ø—Ä–µ–¥–º–µ—Ç–æ–≤</div>
                </div>
            </div>
        </div>

        <div class="pagination" style="display: none;">
        </div>
    </div>

    <div class="case-detail-page" id="caseDetailPage" style="display: none;">
        <button class="back-btn" onclick="window.goBack()">‚Üê –ù–∞–∑–∞–¥</button>
        <div class="case-detail-header">
            <div class="case-detail-icon" id="detailIcon"></div>
            <div class="case-detail-price" id="detailPrice"><span class="currency-icon"></span> 2.25</div>
            
            <div class="roulette-container" id="rouletteContainer">
                <div class="roulette-wrapper">
                    <div class="center-indicator"></div>
                    <div class="roulette-track" id="rouletteTrack"></div>
                </div>
            </div>
        </div>

        <div class="whats-inside-title">–ß—Ç–æ –≤–Ω—É—Ç—Ä–∏?</div>
        
        <div class="prizes-grid" id="prizesGrid">
        </div>

    </div>

    <button class="open-btn" id="openBtn" type="button" onclick="try{if(typeof window.openCase === 'function'){window.openCase();}else if(typeof openCase === 'function'){openCase();}else{alert('–§—É–Ω–∫—Ü–∏—è openCase –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');}}catch(e){alert('–û—à–∏–±–∫–∞: '+e.message);}" style="cursor: pointer !important; pointer-events: auto !important; z-index: 99999 !important;">
        –û—Ç–∫—Ä—ã—Ç—å <span>üöÄ</span>
    </button>

    <div class="modal" id="prizeModal">
        <div class="modal-content">
            <div class="modal-prize-icon" id="modalPrizeIcon">üèÜ</div>
            <div class="modal-prize-name" id="modalPrizeName">–û—Å–∫–∞—Ä</div>
            <div class="modal-prize-value" id="modalPrizeValue"><span class="currency-icon"></span> 82.17</div>
            <button class="modal-close" onclick="closePrizeModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <div class="modal" id="inventoryItemModal">
        <div class="modal-content inventory-modal-content">
            <button class="modal-close-btn" onclick="closeInventoryModal()">‚úï</button>
            <div class="inventory-modal-icon" id="inventoryModalIcon"></div>
            <div class="inventory-modal-name" id="inventoryModalName">–ü—Ä–µ–¥–º–µ—Ç</div>
            <div class="inventory-modal-price">
                <span class="price-label">–¶–µ–Ω–∞:</span>
                <span class="price-value" id="inventoryModalPrice"><span class="currency-icon"></span> 0.00</span>
            </div>
            <div class="inventory-modal-buttons">
                <button class="inventory-modal-btn sell-btn" id="sellItemBtn" onclick="try{if(typeof sellSelectedItem === 'function'){sellSelectedItem();}else if(typeof window.sellSelectedItem === 'function'){window.sellSelectedItem();}else{alert('–§—É–Ω–∫—Ü–∏—è sellSelectedItem –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');}}catch(e){console.error(e);alert('–û—à–∏–±–∫–∞: '+e.message);}">–ü—Ä–æ–¥–∞—Ç—å</button>
                <button class="inventory-modal-btn close-btn" onclick="closeInventoryModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <div class="profile-page" id="profilePage" style="display: none;">
        <div class="profile-header">
            <div class="profile-avatar" id="profileAvatar">
                <img id="profileAvatarImg" src="" alt="Avatar">
            </div>
            <div class="profile-username" id="profileUsername">User</div>
        </div>

        <div class="top-up-buttons">
            <button class="top-up-btn primary" id="topUpBtn" onclick="try{window.handleTopUp(event);}catch(e){alert('–û—à–∏–±–∫–∞: '+e.message);}" style="cursor: pointer !important; pointer-events: auto !important; z-index: 999 !important;">
                <span class="btn-icon"><span class="currency-icon" style="width: 18px; height: 18px; display: inline-block;"></span></span>
                <span>–ü–æ–ø–æ–ª–Ω–∏—Ç—å</span>
            </button>
            <button class="top-up-btn secondary" id="withdrawBtn" onclick="try{window.handleWithdraw(event);}catch(e){alert('–û—à–∏–±–∫–∞: '+e.message);}" style="cursor: pointer !important; pointer-events: auto !important; z-index: 999 !important;">
                <span>–í—ã–≤–µ—Å—Ç–∏</span>
            </button>
        </div>
        
        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ —Å–ø–æ—Å–æ–±–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è -->
        <div class="top-up-modal" id="topUpModal" onclick="event.target === this && closeTopUpModal()">
            <div class="top-up-modal-content" onclick="event.stopPropagation()">
                <h3 class="top-up-modal-title">–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è</h3>
                <div class="payment-methods">
                    <button class="payment-method-btn" id="telegramWalletBtn" onclick="try{if(typeof processTelegramWalletTopUp === 'function'){processTelegramWalletTopUp();}else if(tg && tg.openTelegramLink){const userId=tg.initDataUnsafe?.user?.id || 'unknown';tg.openTelegramLink('https://t.me/your_bot?start=wallet_'+userId);}else{alert('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏');}}catch(e){console.error(e);alert('–û—à–∏–±–∫–∞: '+e.message);}">
                        <div class="payment-method-icon">üí≥</div>
                        <div class="payment-method-info">
                            <div class="payment-method-name">–ß–µ—Ä–µ–∑ Telegram Wallet</div>
                            <div class="payment-method-desc">–ë–æ—Ç —Å–æ–∑–¥–∞—Å—Ç –∏–Ω–≤–æ–π—Å –¥–ª—è –æ–ø–ª–∞—Ç—ã —á–µ—Ä–µ–∑ –∫–æ—à–µ–ª—ë–∫</div>
                        </div>
                    </button>
                    <button class="payment-method-btn" id="telegramBotBtn" onclick="try{if(typeof processTelegramBotTopUp === 'function'){processTelegramBotTopUp();}else if(tg && tg.openTelegramLink){const userId=tg.initDataUnsafe?.user?.id || 'unknown';tg.openTelegramLink('https://t.me/your_bot?start=topup_'+userId);}else{alert('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏');}}catch(e){console.error(e);alert('–û—à–∏–±–∫–∞: '+e.message);}">
                        <div class="payment-method-icon">ü§ñ</div>
                        <div class="payment-method-info">
                            <div class="payment-method-name">–ß–µ—Ä–µ–∑ –±–æ—Ç–∞ CryptoBot</div>
                            <div class="payment-method-desc">–ü–æ–ø–æ–ª–Ω–∏—Ç—å —á–µ—Ä–µ–∑ –±–æ—Ç–∞ Telegram</div>
                        </div>
                    </button>
                </div>
                <button class="modal-close" onclick="closeTopUpModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
        
        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ —Å–ø–æ—Å–æ–±–∞ –≤—ã–≤–æ–¥–∞ -->
        <div class="top-up-modal" id="withdrawModal" onclick="event.target === this && closeWithdrawModal()">
            <div class="top-up-modal-content" onclick="event.stopPropagation()">
                <h3 class="top-up-modal-title">–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –≤—ã–≤–æ–¥–∞</h3>
                <div class="payment-methods">
                    <button class="payment-method-btn" id="withdrawTelegramWalletBtn" onclick="try{if(typeof processTelegramWalletWithdraw === 'function'){processTelegramWalletWithdraw();}else if(tg && tg.openTelegramLink){const userId=tg.initDataUnsafe?.user?.id || 'unknown';tg.openTelegramLink('https://t.me/your_bot?start=withdraw_wallet_'+userId);}else{alert('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏');}}catch(e){console.error(e);alert('–û—à–∏–±–∫–∞: '+e.message);}">
                        <div class="payment-method-icon">üí≥</div>
                        <div class="payment-method-info">
                            <div class="payment-method-name">–ß–µ—Ä–µ–∑ Telegram Wallet</div>
                            <div class="payment-method-desc">–í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ Telegram –∫–æ—à–µ–ª—ë–∫</div>
                        </div>
                    </button>
                    <button class="payment-method-btn" id="withdrawTelegramBotBtn" onclick="try{if(typeof processTelegramBotWithdraw === 'function'){processTelegramBotWithdraw();}else if(tg && tg.openTelegramLink){const userId=tg.initDataUnsafe?.user?.id || 'unknown';tg.openTelegramLink('https://t.me/your_bot?start=withdraw_'+userId);}else{alert('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏');}}catch(e){console.error(e);alert('–û—à–∏–±–∫–∞: '+e.message);}">
                        <div class="payment-method-icon">ü§ñ</div>
                        <div class="payment-method-info">
                            <div class="payment-method-name">–ß–µ—Ä–µ–∑ –±–æ—Ç–∞ CryptoBot</div>
                            <div class="payment-method-desc">–í—ã–≤–µ—Å—Ç–∏ —á–µ—Ä–µ–∑ –±–æ—Ç–∞ Telegram</div>
                        </div>
                    </button>
                </div>
                <button class="modal-close" onclick="closeWithdrawModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>

        <div class="inventory-section">
            <div class="inventory-header">
                <span class="inventory-title">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å (<span id="inventoryCount">0</span>)</span>
                <button class="sell-all-btn" id="sellAllBtn" onclick="try{if(typeof sellAllItems === 'function'){sellAllItems();}else if(typeof window.sellAllItems === 'function'){window.sellAllItems();}else{alert('–§—É–Ω–∫—Ü–∏—è sellAllItems –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');}}catch(e){console.error(e);alert('–û—à–∏–±–∫–∞: '+e.message);}">–ü—Ä–æ–¥–∞—Ç—å –≤—Å–µ</button>
            </div>
            <div class="inventory-grid" id="inventoryGrid">
            </div>
        </div>
    </div>

    <div class="crash-page" id="crashPage" style="display: none;">
        <div class="crash-header">
            <div class="players-count">
                <span class="players-icon">üë•</span>
                <span id="playersCount">0</span>
            </div>
            <div class="crash-balance">
                <span class="diamond-icon"></span>
                <span class="balance-text" id="crashBalance">0.00</span>
                <button style="background: transparent; border: none; color: #ffffff; font-size: 18px; cursor: pointer; padding: 0 5px;">+</button>
            </div>
        </div>

        <div class="crash-graph-container">
            <div class="crash-graph" id="crashGraph">
                <canvas id="crashCanvas"></canvas>
                <div class="current-multiplier" id="currentMultiplier">x1.00</div>
            </div>
        </div>

        <div class="crash-controls">
            <div class="multiplier-buttons" id="multiplierButtons">
                <button class="multiplier-btn" data-mult="auto" onclick="try{if(typeof window.handleMultiplierClick === 'function'){window.handleMultiplierClick('auto', event);}else if(typeof selectedMultiplier !== 'undefined'){selectedMultiplier=null;document.querySelectorAll('.multiplier-btn').forEach(b=>b.classList.remove('active'));event.target.closest('.multiplier-btn')?.classList.add('active');}}catch(e){console.error(e);}" style="cursor: pointer !important; pointer-events: auto !important; z-index: 100 !important;">–ê–≤—Ç–æ</button>
                <button class="multiplier-btn active" data-mult="1.5" onclick="try{if(typeof window.handleMultiplierClick === 'function'){window.handleMultiplierClick('1.5', event);}else if(typeof selectedMultiplier !== 'undefined'){selectedMultiplier=1.5;document.querySelectorAll('.multiplier-btn').forEach(b=>b.classList.remove('active'));event.target.closest('.multiplier-btn')?.classList.add('active');}}catch(e){console.error(e);}" style="cursor: pointer !important; pointer-events: auto !important; z-index: 100 !important;">x1.5</button>
                <button class="multiplier-btn" data-mult="2.0" onclick="try{if(typeof window.handleMultiplierClick === 'function'){window.handleMultiplierClick('2.0', event);}else if(typeof selectedMultiplier !== 'undefined'){selectedMultiplier=2.0;document.querySelectorAll('.multiplier-btn').forEach(b=>b.classList.remove('active'));event.target.closest('.multiplier-btn')?.classList.add('active');}}catch(e){console.error(e);}" style="cursor: pointer !important; pointer-events: auto !important; z-index: 100 !important;">x2.0</button>
                <button class="multiplier-btn" data-mult="3.0" onclick="try{if(typeof window.handleMultiplierClick === 'function'){window.handleMultiplierClick('3.0', event);}else if(typeof selectedMultiplier !== 'undefined'){selectedMultiplier=3.0;document.querySelectorAll('.multiplier-btn').forEach(b=>b.classList.remove('active'));event.target.closest('.multiplier-btn')?.classList.add('active');}}catch(e){console.error(e);}" style="cursor: pointer !important; pointer-events: auto !important; z-index: 100 !important;">x3.0</button>
                <button class="multiplier-btn" data-mult="5.0" onclick="try{if(typeof window.handleMultiplierClick === 'function'){window.handleMultiplierClick('5.0', event);}else if(typeof selectedMultiplier !== 'undefined'){selectedMultiplier=5.0;document.querySelectorAll('.multiplier-btn').forEach(b=>b.classList.remove('active'));event.target.closest('.multiplier-btn')?.classList.add('active');}}catch(e){console.error(e);}" style="cursor: pointer !important; pointer-events: auto !important; z-index: 100 !important;">x5.0</button>
            </div>
            <div class="bet-buttons">
                <button class="bet-type-btn active" data-type="balance" id="betBalanceBtn" onclick="try{if(typeof window.handleBetTypeClick === 'function'){window.handleBetTypeClick('balance', event);}else{const btn=event.target.closest('.bet-type-btn');if(btn){document.querySelectorAll('.bet-type-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');const amountInput=document.getElementById('betAmountInput');const itemSelect=document.getElementById('betItemSelect');if(amountInput){amountInput.style.display='block';amountInput.style.visibility='visible';}if(itemSelect){itemSelect.style.display='none';itemSelect.style.visibility='hidden';}}}}catch(e){console.error(e);}" style="cursor: pointer !important; pointer-events: auto !important; z-index: 100 !important;">
                    <span class="currency-icon" style="width: 16px; height: 16px; display: inline-block;"></span>
                    <span>–ë–∞–ª–∞–Ω—Å</span>
                </button>
                <button class="bet-type-btn" data-type="item" id="betItemBtn" onclick="try{if(typeof window.handleBetTypeClick === 'function'){window.handleBetTypeClick('item', event);}else{const btn=event.target.closest('.bet-type-btn');if(btn){document.querySelectorAll('.bet-type-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');const amountInput=document.getElementById('betAmountInput');const itemSelect=document.getElementById('betItemSelect');if(amountInput){amountInput.style.display='none';amountInput.style.visibility='hidden';}if(itemSelect){itemSelect.style.display='block';itemSelect.style.visibility='visible';if(typeof updateBetItemSelect === 'function'){updateBetItemSelect();}}}}}catch(e){console.error(e);}" style="cursor: pointer !important; pointer-events: auto !important; z-index: 100 !important;">
                    <span>üéÅ</span>
                    <span>–ü–æ–¥–∞—Ä–æ–∫</span>
                </button>
            </div>
            <input type="number" class="bet-amount-input" id="betAmountInput" placeholder="–°—É–º–º–∞ —Å—Ç–∞–≤–∫–∏" min="0.01" step="0.01">
            <select class="bet-item-select" id="betItemSelect" style="display: none;">
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç</option>
            </select>
            <button class="make-bet-btn" id="makeBetBtn" onclick="try{window.handleCrashBetClick(event);}catch(e){alert('–û—à–∏–±–∫–∞: '+e.message);}" style="cursor: pointer !important; pointer-events: auto !important; z-index: 999 !important;">–°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É</button>
        </div>

        <div class="bets-list" id="betsList">
            <div class="bets-list-header">–ê–∫—Ç–∏–≤–Ω—ã–µ —Å—Ç–∞–≤–∫–∏</div>
        </div>
    </div>

    <div id="minesPage" class="mines-page" style="display: none;">
        <div class="mines-header">
            <div class="mines-balance">
                <span class="currency-icon"></span>
                <span id="minesBalance">0.00</span>
            </div>
        </div>
        
        <div class="mines-game-container">
            <div class="mines-controls">
                <div class="mines-bet-control">
                    <label>–°—Ç–∞–≤–∫–∞:</label>
                    <input type="number" id="minesBetAmount" class="mines-input" value="0.1" min="0.01" step="0.01" placeholder="0.00">
                </div>
                <div class="mines-count-control">
                    <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∏–Ω:</label>
                    <div class="mines-count-buttons">
                        <button class="mines-count-btn" data-count="3" onclick="try{if(typeof minesGameState !== 'undefined'){minesGameState.minesCount=3;document.querySelectorAll('.mines-count-btn').forEach(b=>b.classList.remove('active'));event.target.closest('.mines-count-btn')?.classList.add('active');}else{alert('–ò–≥—Ä–∞ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');}}catch(e){console.error(e);}">3</button>
                        <button class="mines-count-btn active" data-count="5" onclick="try{if(typeof minesGameState !== 'undefined'){minesGameState.minesCount=5;document.querySelectorAll('.mines-count-btn').forEach(b=>b.classList.remove('active'));event.target.closest('.mines-count-btn')?.classList.add('active');}else{alert('–ò–≥—Ä–∞ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');}}catch(e){console.error(e);}">5</button>
                        <button class="mines-count-btn" data-count="10" onclick="try{if(typeof minesGameState !== 'undefined'){minesGameState.minesCount=10;document.querySelectorAll('.mines-count-btn').forEach(b=>b.classList.remove('active'));event.target.closest('.mines-count-btn')?.classList.add('active');}else{alert('–ò–≥—Ä–∞ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');}}catch(e){console.error(e);}">10</button>
                    </div>
                </div>
                <div class="mines-multiplier-display">
                    <div class="mines-multiplier-label">–ú–Ω–æ–∂–∏—Ç–µ–ª—å:</div>
                    <div class="mines-multiplier-value" id="minesMultiplier">x1.00</div>
                </div>
                <button id="minesCashOutBtn" class="mines-cash-out-btn" onclick="try{if(typeof cashOutMines === 'function'){cashOutMines();}else if(typeof window.cashOutMines === 'function'){window.cashOutMines();}else{alert('–§—É–Ω–∫—Ü–∏—è cashOutMines –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');}}catch(e){console.error(e);alert('–û—à–∏–±–∫–∞: '+e.message);}" disabled>–ó–∞–±—Ä–∞—Ç—å</button>
                <button id="minesStartBtn" class="mines-start-btn" onclick="try{window.handleMinesStart(event);}catch(e){alert('–û—à–∏–±–∫–∞: '+e.message);}" style="cursor: pointer !important; pointer-events: auto !important; z-index: 999 !important;">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
            </div>
            
            <div class="mines-grid-container">
                <div id="minesGrid" class="mines-grid"></div>
            </div>
            
            <div class="mines-stats">
                <div class="mines-stat-item">
                    <span class="mines-stat-label">–û—Ç–∫—Ä—ã—Ç–æ:</span>
                    <span id="minesOpenedCount">0</span>
                </div>
                <div class="mines-stat-item">
                    <span class="mines-stat-label">–ú–∏–Ω:</span>
                    <span id="minesTotalCount">3</span>
                </div>
                <div class="mines-stat-item">
                    <span class="mines-stat-label">–í—ã–∏–≥—Ä—ã—à:</span>
                    <span id="minesWinnings">0.00</span>
                </div>
            </div>
        </div>
    </div>

    <div id="dicePage" class="dice-page" style="display: none;">
        <div class="dice-header">
            <div class="dice-balance">
                <span class="currency-icon"></span>
                <span id="diceBalance">0.00</span>
            </div>
        </div>
        
        <div class="dice-game-container">
            <div class="dice-controls">
                <div class="dice-bet-control">
                    <label>–°—Ç–∞–≤–∫–∞:</label>
                    <input type="number" id="diceBetAmount" class="dice-input" value="0.1" min="0.01" step="0.01" placeholder="0.00">
                </div>
                
                <div class="dice-threshold-container">
                    <div class="dice-threshold-label">
                        <span>Roll Under</span>
                        <span id="diceThresholdValue">50</span>
                        <span>Roll Over</span>
                    </div>
                    <div class="dice-slider-wrapper">
                        <input type="range" id="diceThreshold" class="dice-slider" min="1" max="98" value="50">
                        <div class="dice-slider-labels">
                            <span>0</span>
                            <span>99</span>
                        </div>
                    </div>
                </div>
                
                <div class="dice-roll-type">
                    <button id="diceRollUnderBtn" class="dice-roll-type-btn active" onclick="try{if(typeof diceGameState !== 'undefined'){diceGameState.rollType='under';document.getElementById('diceRollUnderBtn')?.classList.add('active');document.getElementById('diceRollOverBtn')?.classList.remove('active');}else{alert('–ò–≥—Ä–∞ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');}}catch(e){console.error(e);}">Roll Under</button>
                    <button id="diceRollOverBtn" class="dice-roll-type-btn" onclick="try{if(typeof diceGameState !== 'undefined'){diceGameState.rollType='over';document.getElementById('diceRollOverBtn')?.classList.add('active');document.getElementById('diceRollUnderBtn')?.classList.remove('active');}else{alert('–ò–≥—Ä–∞ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');}}catch(e){console.error(e);}">Roll Over</button>
                </div>
                
                <div class="dice-auto-control">
                    <span class="dice-auto-label">AUTO</span>
                    <label class="dice-switch">
                        <input type="checkbox" id="diceAutoToggle">
                        <span class="dice-switch-slider"></span>
                    </label>
                    <span class="dice-auto-status" id="diceAutoStatus">OFF</span>
                </div>
                
                <button id="diceStartBtn" class="dice-start-btn" onclick="try{window.handleDiceStart(event);}catch(e){alert('–û—à–∏–±–∫–∞: '+e.message);}" style="cursor: pointer !important; pointer-events: auto !important; z-index: 999 !important;">START</button>
            </div>
            
            <div class="dice-result-container">
                <div class="dice-result-display" id="diceResultDisplay">
                    <div class="dice-result-value" id="diceResultValue">?</div>
                    <div class="dice-result-text" id="diceResultText">–ù–∞–∂–º–∏—Ç–µ START</div>
                </div>
            </div>
            
            <div class="dice-stats">
                <div class="dice-stat-item">
                    <span class="dice-stat-label">–í—ã–∏–≥—Ä—ã—à:</span>
                    <span id="diceWinnings">0.00</span>
                </div>
                <div class="dice-stat-item">
                    <span class="dice-stat-label">–ú–Ω–æ–∂–∏—Ç–µ–ª—å:</span>
                    <span id="diceMultiplier">x2.00</span>
                </div>
            </div>
        </div>
    </div>

    <div class="bottom-nav" id="bottomNav">
        <div class="nav-item active" data-page="cases" onclick="handleNavClick('cases', this)">
            <div class="nav-icon">üéÅ</div>
            <div class="nav-label">–ö–µ–π—Å—ã</div>
        </div>
        <div class="nav-item" data-page="crash" onclick="handleNavClick('crash', this)">
            <div class="nav-icon">üöÄ</div>
            <div class="nav-label">–ö—Ä–∞—à</div>
        </div>
        <div class="nav-item" data-page="mines" onclick="handleNavClick('mines', this)">
            <div class="nav-icon">üí£</div>
            <div class="nav-label">–ú–∏–Ω—ã</div>
        </div>
        <div class="nav-item" data-page="dice" onclick="handleNavClick('dice', this)">
            <div class="nav-icon">üé≤</div>
            <div class="nav-label">Dice</div>
        </div>
        <div class="nav-item" data-page="profile" onclick="handleNavClick('profile', this)">
            <div class="nav-icon">üë§</div>
            <div class="nav-label">–ü—Ä–æ—Ñ–∏–ª—å</div>
        </div>
    </div>

    <script>
        console.log('‚úÖ JAVASCRIPT –†–ê–ë–û–¢–ê–ï–¢!');
        
        // ===== –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò - –ò–ù–ò–¶–ò–ê–õ–ò–ó–ò–†–£–ï–ú –°–†–ê–ó–£ =====
        // –î–µ–ª–∞–µ–º –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≥–ª–æ–±–∞–ª—å–Ω—ã–º–∏ –∏ –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ —Å—Ä–∞–∑—É
        
        // –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ö–ï–ô–°–ê #1
        const case1Config = {
            icon: 'IconCase/2c0JGQXrElCDlaNGbYHwgipHo2-yq00qIxcU39IganVzrqDys2-no-bg-preview%20%28carve.photos%29.png',
            price: 0.1,
            items: [
                { icon: 'ItemCase1/_Jne2Jf3nM6erEUU5TEnvU7PWFOiElGs2WJc0zQ250JHxRd6md_v1huDDCpZRSesDCZP53pWDPEnqfojbzsYqjbD.png', name: '–õ–æ–ª–∏ –ø–æ–ø', value: 82.17 },
                { icon: 'ItemCase1/4dOUEOHs9WSNk5pRBkEnCptGIs16lB5xe4E7mh3sWF6XAkHcwQvINscw7cXwhK5IUXv5eOdct9_vxDZtoaMTm8GJ.png', name: '–ë–∞–±–æ—á–∫–∞', value: 75.66 },
                { icon: 'ItemCase1/GsJZ-oPiqQHoyerbmc-z_L_NTi8cBWgKmS9ueEOwk5_PHeYbWeRwn6Jxic2d1Yhl8IZwt0rBUg5ZfvrkYkYp0UrO.png', name: '–ó–µ–ª—å–µ', value: 69.30 },
                { icon: 'ItemCase1/qlq8mJd7J1-60XWhd29rLbtjBfzeXSPLMVgzkcBDTNfHL50TBMHG2B0h2jB1bAd-rJWlHO1NtkI0zAsWF4BgcVHn.png', name: '–®–ª–µ–º', value: 25.27 },
                { icon: 'ItemCase1/QrKwYOzBzIX1ilzkfuCuiFdyCRU9jBm5pASbp_z2Sb6ATFNaaB1Zr1XfNGehXeHTYhldZNO8x4_l0ueW2t4MZ62W.png', name: '–°–∏–≥–∞—Ä–∞', value: 23.50 },
                { icon: 'ItemCase1/R1v8ymGGn2ZBo6cI96QvcWu5Yh2FsyiAmDW_WTGMfz7CMvELAOFCf7I7Ns2XGdKv1AxHTvrioJ6h-ALjrzjxb7Ra.png', name: '–ö–æ–ª—å—Ü–æ', value: 17.00 },
                { icon: 'ItemCase1/XQTRb7Jx7OBjYfqnitHsZGV9pmln2Nhr9n5oYkJvZsF_dtkAYxPHS8Npi_qa6Pxcx0o368YwkcY9uRHmabTE5-LS.png', name: '–ë–∞–±–æ—á–∫–∞', value: 11.40 },
                { icon: 'ItemCase1/Y6HIRzDSCdUNCqWtHRsCpePjILr5QyrOnOD0T9PtrYjgu3Ff3XVbLGxLT1snsWyNNMzfDvTlhms0y1_Wwev6tz9-.png', name: '–ó–µ–ª—å–µ', value: 8.64 },
                { icon: 'ItemCase1/YLHOesDBQxjSVcanvj-iKz2mgFXRfweB38vb951G5LvwfJ8ytmlfe3PFUk3k_AgekpyW9A3uIpzEjM87k6_aUVS1.png', name: '–¶–≤–µ—Ç–æ–∫', value: 7.90 }
            ]
        };
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º window.cases —Å—Ä–∞–∑—É
        window.cases = {
            1: {
                icon: case1Config.icon,
                price: case1Config.price,
                prizes: case1Config.items
            }
        };
        var cases = window.cases; // –î–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
        
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã –ú–∏–Ω—ã
        let minesGameState = {
            grid: [],
            mines: [],
            opened: [],
            gameActive: false,
            betAmount: 0.1,
            currentMultiplier: 1.0,
            minesCount: 5,
            gridSize: 25
        };
        
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã Dice
        let diceGameState = {
            betAmount: 0.1,
            threshold: 50,
            rollType: 'under',
            autoPlay: false,
            autoPlayInterval: null,
            isRolling: false
        };
        
        console.log('‚úÖ –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã');
        
        // –ì–õ–û–ë–ê–õ–¨–ù–´–ï –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò - –û–ü–†–ï–î–ï–õ–Ø–ï–ú –°–†–ê–ó–£ –í –ù–ê–ß–ê–õ–ï –°–ö–†–ò–ü–¢–ê
        // –≠—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è inline onclick
        window.handleCaseClick = function(caseNum) {
            console.log('üîµ –ö–ª–∏–∫ –ø–æ –∫–µ–π—Å—É:', caseNum, '—Ç–∏–ø:', typeof caseNum);
            try {
                // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —á–∏—Å–ª–æ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
                var num = parseInt(caseNum);
                if (isNaN(num)) {
                    console.error('caseNum –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —á–∏—Å–ª–æ–º:', caseNum);
                    alert('–û—à–∏–±–∫–∞: –ù–µ–≤–µ—Ä–Ω—ã–π –Ω–æ–º–µ—Ä –∫–µ–π—Å–∞');
                    return;
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ cases –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –∏ –Ω–µ –ø—É—Å—Ç–∞—è
                if (typeof window.cases === 'undefined' || !window.cases || Object.keys(window.cases).length === 0) {
                    console.error('window.cases –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –∏–ª–∏ –ø—É—Å—Ç–∞—è:', window.cases);
                    alert('–û—à–∏–±–∫–∞: –î–∞–Ω–Ω—ã–µ –∫–µ–π—Å–æ–≤ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
                    return;
                }
                
                console.log('window.cases:', window.cases);
                console.log('–ò—â–µ–º –∫–µ–π—Å —Å –Ω–æ–º–µ—Ä–æ–º:', num);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞
                if (typeof window.showCaseDetail === 'function') {
                    window.showCaseDetail(num);
                } else if (typeof showCaseDetail === 'function') {
                    showCaseDetail(num);
                } else {
                    alert('–û—à–∏–±–∫–∞: showCaseDetail –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
                    console.error('showCaseDetail –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞');
                }
            } catch(err) {
                console.error('–û—à–∏–±–∫–∞ handleCaseClick:', err);
                alert('–û—à–∏–±–∫–∞: ' + err.message);
            }
        };
        
        window.handleCrashBetClick = function(e) {
            console.log('üîµ –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ –∫—Ä–∞—à–∞');
            try {
                // –ò—â–µ–º —Ñ—É–Ω–∫—Ü–∏—é makeBet, –∫–æ—Ç–æ—Ä–∞—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –¥–ª—è –∫—Ä–∞—à–∞
                if (typeof window.makeBet === 'function') {
                    window.makeBet();
                } else if (typeof makeBet === 'function') {
                    makeBet();
                } else {
                    console.error('makeBet –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –ø—ã—Ç–∞–µ–º—Å—è —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É...');
                    const btn = document.getElementById('makeBetBtn');
                    if (btn) {
                        // –°–æ–∑–¥–∞–µ–º —Å–æ–±—ã—Ç–∏–µ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –µ–≥–æ
                        const clickEvent = new MouseEvent('click', {
                            bubbles: true,
                            cancelable: true,
                            view: window
                        });
                        btn.dispatchEvent(clickEvent);
                    } else {
                        alert('–û—à–∏–±–∫–∞: –ö–Ω–æ–ø–∫–∞ —Å—Ç–∞–≤–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                    }
                }
            } catch(err) {
                console.error('–û—à–∏–±–∫–∞ handleCrashBetClick:', err);
                alert('–û—à–∏–±–∫–∞: ' + err.message);
            }
        };
        
        window.handleMinesStart = function(e) {
            console.log('üîµ –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ –º–∏–Ω—ã');
            try {
                if (typeof window.startMinesGame === 'function') {
                    window.startMinesGame();
                } else if (typeof startMinesGame === 'function') {
                    startMinesGame();
                } else {
                    alert('–û—à–∏–±–∫–∞: startMinesGame –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
                    console.error('startMinesGame –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞');
                }
            } catch(err) {
                console.error('–û—à–∏–±–∫–∞ handleMinesStart:', err);
                alert('–û—à–∏–±–∫–∞: ' + err.message);
            }
        };
        
        window.handleDiceStart = function(e) {
            console.log('üîµ –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ dice');
            try {
                if (typeof window.startDiceGame === 'function') {
                    window.startDiceGame();
                } else if (typeof startDiceGame === 'function') {
                    startDiceGame();
                } else {
                    alert('–û—à–∏–±–∫–∞: startDiceGame –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
                    console.error('startDiceGame –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞');
                }
            } catch(err) {
                console.error('–û—à–∏–±–∫–∞ handleDiceStart:', err);
                alert('–û—à–∏–±–∫–∞: ' + err.message);
            }
        };
        
        window.handleTopUp = function(e) {
            console.log('üîµ –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ –ø–æ–ø–æ–ª–Ω–∏—Ç—å');
            try {
                if (typeof window.openTopUpModal === 'function') {
                    window.openTopUpModal();
                } else if (typeof openTopUpModal === 'function') {
                    openTopUpModal();
                } else {
                    alert('–û—à–∏–±–∫–∞: openTopUpModal –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
                    console.error('openTopUpModal –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞');
                }
            } catch(err) {
                console.error('–û—à–∏–±–∫–∞ handleTopUp:', err);
                alert('–û—à–∏–±–∫–∞: ' + err.message);
            }
        };
        
        window.handleWithdraw = function(e) {
            console.log('üîµ –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ –≤—ã–≤–µ—Å—Ç–∏');
            try {
                if (typeof window.openWithdrawModal === 'function') {
                    window.openWithdrawModal();
                } else if (typeof openWithdrawModal === 'function') {
                    openWithdrawModal();
                } else {
                    alert('–û—à–∏–±–∫–∞: openWithdrawModal –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
                    console.error('openWithdrawModal –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞');
                }
            } catch(err) {
                console.error('–û—à–∏–±–∫–∞ handleWithdraw:', err);
                alert('–û—à–∏–±–∫–∞: ' + err.message);
            }
        };
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –º–Ω–æ–∂–∏—Ç–µ–ª–µ–π
        window.handleMultiplierClick = function(mult, e) {
            if (e) {
                e.preventDefault();
                e.stopPropagation();
            }
            console.log('üîµ –ö–ª–∏–∫ –ø–æ –º–Ω–æ–∂–∏—Ç–µ–ª—é:', mult);
            try {
                if (mult === 'auto') {
                    selectedMultiplier = null;
                } else {
                    selectedMultiplier = parseFloat(mult);
                }
                document.querySelectorAll('.multiplier-btn').forEach(b => b.classList.remove('active'));
                const btn = e?.target?.closest('.multiplier-btn');
                if (btn) {
                    btn.classList.add('active');
                }
                console.log('‚úÖ selectedMultiplier —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:', selectedMultiplier);
            } catch(err) {
                console.error('–û—à–∏–±–∫–∞ handleMultiplierClick:', err);
            }
        };
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Ç–∏–ø–∞ —Å—Ç–∞–≤–∫–∏
        window.handleBetTypeClick = function(type, e) {
            if (e) {
                e.preventDefault();
                e.stopPropagation();
            }
            console.log('üîµ –ö–ª–∏–∫ –ø–æ —Ç–∏–ø—É —Å—Ç–∞–≤–∫–∏:', type);
            try {
                betType = type;
                document.querySelectorAll('.bet-type-btn').forEach(b => b.classList.remove('active'));
                const btn = e?.target?.closest('.bet-type-btn');
                if (btn) {
                    btn.classList.add('active');
                }
                
                const amountInput = document.getElementById('betAmountInput');
                const itemSelect = document.getElementById('betItemSelect');
                
                if (betType === 'balance') {
                    if (amountInput) {
                        amountInput.style.display = 'block';
                        amountInput.style.visibility = 'visible';
                    }
                    if (itemSelect) {
                        itemSelect.style.display = 'none';
                        itemSelect.style.visibility = 'hidden';
                    }
                } else {
                    if (amountInput) {
                        amountInput.style.display = 'none';
                        amountInput.style.visibility = 'hidden';
                    }
                    if (itemSelect) {
                        itemSelect.style.display = 'block';
                        itemSelect.style.visibility = 'visible';
                        if (typeof updateBetItemSelect === 'function') {
                            updateBetItemSelect();
                        }
                    }
                }
                console.log('‚úÖ betType —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:', betType);
            } catch(err) {
                console.error('–û—à–∏–±–∫–∞ handleBetTypeClick:', err);
            }
        };
        
        
        
        // –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        let tg = null;
        let isTelegram = false;
        
        try {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ Telegram Web App API
            if (typeof window !== 'undefined' && window.Telegram && window.Telegram.WebApp) {
                tg = window.Telegram.WebApp;
                console.log('‚úÖ Telegram Web App API –Ω–∞–π–¥–µ–Ω');
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ API –¥–æ—Å—Ç—É–ø–µ–Ω, —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
                try {
                    if (tg && typeof tg.ready === 'function') {
            tg.ready();
                        console.log('‚úÖ Telegram Web App –≥–æ—Ç–æ–≤');
                    }
                } catch (err) {
                    console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ tg.ready():', err.message);
                }
                
                try {
                    if (tg && typeof tg.expand === 'function') {
            tg.expand();
                        console.log('‚úÖ Telegram Web App —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç');
                    }
                } catch (err) {
                    console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ tg.expand():', err.message);
                }
                
                try {
                    if (tg && typeof tg.setHeaderColor === 'function') {
            tg.setHeaderColor('#0a0a0a');
                    }
                } catch (err) {
                    console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ tg.setHeaderColor():', err.message);
                }
                
                try {
                    if (tg && typeof tg.setBackgroundColor === 'function') {
            tg.setBackgroundColor('#0a0a0a');
                    }
                } catch (err) {
                    console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ tg.setBackgroundColor():', err.message);
                }
                
            isTelegram = true;
                console.log('‚úÖ Telegram Web App –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                
                // –í—ã–∑—ã–≤–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∫–∏ –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
                if (typeof updateHeaderAvatar === 'function') {
                    setTimeout(updateHeaderAvatar, 500);
                }
            } else {
                console.warn('‚ö†Ô∏è Telegram Web App API –Ω–µ –Ω–∞–π–¥–µ–Ω - –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ —Ä–µ–∂–∏–º–µ –±—Ä–∞—É–∑–µ—Ä–∞');
                console.log('‚ÑπÔ∏è –ï—Å–ª–∏ –≤—ã —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ, —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ. –í Telegram Mini App –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.');
                // –°–æ–∑–¥–∞—ë–º –∑–∞–≥–ª—É—à–∫—É –¥–ª—è —Ä–∞–±–æ—Ç—ã –≤ –±—Ä–∞—É–∑–µ—Ä–µ (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
                tg = {
                    initDataUnsafe: {
                        user: {
                            id: Math.floor(Math.random() * 1000000),
                            first_name: null, // –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–≥–ª—É—à–∫—É, —á—Ç–æ–±—ã –±—ã–ª–æ –≤–∏–¥–Ω–æ, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
                            username: null,
                            photo_url: null
                        }
                    },
                    showAlert: function(text) { alert(text); },
                    showConfirm: function(text, callback) { callback(confirm(text)); },
                    HapticFeedback: {
                        impactOccurred: function(type) { console.log('Haptic:', type); },
                        notificationOccurred: function(type) { console.log('Notification:', type); }
                    },
                    openTelegramLink: function(url) { window.open(url, '_blank'); },
                    openLink: function(url) { window.open(url, '_blank'); }
                };
            }
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Telegram Web App:', error);
            // –°–æ–∑–¥–∞—ë–º –∑–∞–≥–ª—É—à–∫—É –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
            tg = {
                initDataUnsafe: {
                    user: {
                        id: Math.floor(Math.random() * 1000000),
                        first_name: null, // –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–≥–ª—É—à–∫—É
                        username: null,
                        photo_url: null
                    }
                },
                showAlert: function(text) { alert(text); },
                showConfirm: function(text, callback) { callback(confirm(text)); },
                HapticFeedback: {
                    impactOccurred: function(type) { console.log('Haptic:', type); },
                    notificationOccurred: function(type) { console.log('Notification:', type); }
                },
                openTelegramLink: function(url) { window.open(url, '_blank'); },
                openLink: function(url) { window.open(url, '_blank'); }
            };
        }

        // ========== –ó–ê–©–ò–¢–ê –§–†–û–ù–¢–ï–ù–î–ê ==========
        
        // –ó–∞—â–∏—â—ë–Ω–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –±–∞–ª–∞–Ω—Å–∞
        let _balance = 100.00; // –¢–µ—Å—Ç–æ–≤—ã–π –±–∞–ª–∞–Ω—Å
        let balanceLocked = false;
        let isServerValidated = false;
        
        // –ì–µ—Ç—Ç–µ—Ä/—Å–µ—Ç—Ç–µ—Ä –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ —Å –∑–∞—â–∏—Ç–æ–π
        Object.defineProperty(window, 'balance', {
            get: function() { return _balance; },
            set: function(val) {
                console.warn('‚ö†Ô∏è –ü—Ä—è–º–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ balance –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ API.');
                return false;
            },
            configurable: false
        });
        
        // –§—É–Ω–∫—Ü–∏—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –±–∞–ª–∞–Ω—Å–∞ —Ç–æ–ª—å–∫–æ —Å —Å–µ—Ä–≤–µ—Ä–∞
        function setBalanceFromServer(newBalance) {
            const validated = parseFloat(newBalance);
            if (!isNaN(validated) && validated >= 0 && validated <= 1000000) {
                _balance = validated;
                updateBalanceDisplay();
                isServerValidated = true;
                return true;
            }
            console.error('‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞:', newBalance);
            return false;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
        function changeBalance(amount, source = 'unknown') {
            if (balanceLocked) {
                console.warn('‚ö†Ô∏è –ò–∑–º–µ–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ');
                return false;
            }
            
            const validated = parseFloat(amount);
            if (isNaN(validated) || Math.abs(validated) > 1000000) {
                console.error('‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:', amount);
                return false;
            }
            
            const newBalance = _balance + validated;
            if (newBalance < 0 || newBalance > 1000000) {
                console.error('‚ùå –ë–∞–ª–∞–Ω—Å –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ –ø—Ä–µ–¥–µ–ª—ã:', newBalance);
                return false;
            }
            
            _balance = newBalance;
            updateBalanceDisplay();
            console.log(`‚úÖ –ë–∞–ª–∞–Ω—Å –∏–∑–º–µ–Ω—ë–Ω –Ω–∞ ${validated} –∏–∑ ${source}. –ù–æ–≤—ã–π –±–∞–ª–∞–Ω—Å: ${_balance}`);
            return true;
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
        function updateBalanceDisplay() {
            try {
                const balanceEl = document.getElementById('balance');
                const crashBalanceEl = document.getElementById('crashBalance');
                const minesBalanceEl = document.getElementById('minesBalance');
                const diceBalanceEl = document.getElementById('diceBalance');
                
                const balanceValue = _balance.toFixed(2);
                
                if (balanceEl) {
                    balanceEl.textContent = balanceValue;
                    console.log('‚úÖ –ë–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª–µ–Ω –≤ header:', balanceValue);
                }
                if (crashBalanceEl) {
                    crashBalanceEl.textContent = balanceValue;
                    console.log('‚úÖ –ë–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª–µ–Ω –≤ –∫—Ä–∞—à–µ:', balanceValue);
                }
                if (minesBalanceEl) {
                    minesBalanceEl.textContent = balanceValue;
                    console.log('‚úÖ –ë–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª–µ–Ω –≤ –º–∏–Ω–∞—Ö:', balanceValue);
                }
                if (diceBalanceEl) {
                    diceBalanceEl.textContent = balanceValue;
                    console.log('‚úÖ –ë–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª–µ–Ω –≤ dice:', balanceValue);
                }
                
                console.log('üí∞ –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å:', _balance);
            } catch(err) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞:', err);
            }
        }
        
        // –°–¥–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –≥–ª–æ–±–∞–ª—å–Ω–æ–π
        window.updateBalanceDisplay = updateBalanceDisplay;
        
        // –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π
        const protectedFunctions = {
            setBalanceFromServer,
            changeBalance,
            updateBalanceDisplay
        };
        Object.freeze(protectedFunctions);
        
        let currentCase = null;
        let currentPrizes = [];
        let isOpening = false;
        let currentTab = 'cases';
        
        // API —ç–Ω–¥–ø–æ–∏–Ω—Ç (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä)
        const API_BASE_URL = 'http://localhost:3000/api'; // –õ–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤—ã–∏–≥—Ä—ã—à–µ–π –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        let globalPrizes = [];
        
        // –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–≤—ã–∏–≥—Ä–∞–Ω–Ω—ã–µ –ø–æ–¥–∞—Ä–∫–∏)
        let userInventory = [];
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram (–∑–∞—â–∏—â—ë–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è)
        function getUserId() {
            if (!tg || !tg.initDataUnsafe) {
                console.warn('‚ö†Ô∏è Telegram Web App –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                return null;
            }
            
            const user = tg.initDataUnsafe.user;
            if (!user || !user.id) {
                console.warn('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                return null;
            }
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è userId (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º)
            const userId = String(user.id);
            if (!/^\d+$/.test(userId)) {
                console.error('‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç userId:', userId);
                return null;
            }
            
            return userId;
        }
        
        // –ó–∞—â–∏—â—ë–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤
        function makeProtectedRequest(url, options = {}) {
            const userId = getUserId();
            if (!userId) {
                return Promise.reject(new Error('User ID –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω'));
            }
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è URL (–∑–∞—â–∏—Ç–∞ –æ—Ç –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ –∏ SSRF)
            if (!url || typeof url !== 'string' || !url.startsWith(API_BASE_URL)) {
                console.error('‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π URL –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞:', url);
                return Promise.reject(new Error('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π URL'));
            }
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞ (–∑–∞—â–∏—Ç–∞ –æ—Ç XSS)
            if (options.body) {
                try {
                    const parsed = typeof options.body === 'string' ? JSON.parse(options.body) : options.body;
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ–ø–∞—Å–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
                    const bodyStr = JSON.stringify(parsed);
                    if (bodyStr.includes('<script') || bodyStr.includes('javascript:') || bodyStr.includes('onerror=')) {
                        console.error('‚ùå –û–±–Ω–∞—Ä—É–∂–µ–Ω –æ–ø–∞—Å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –≤ —Ç–µ–ª–µ –∑–∞–ø—Ä–æ—Å–∞');
                        return Promise.reject(new Error('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ'));
                    }
                } catch (e) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞:', e);
                    return Promise.reject(new Error('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ'));
                }
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º userId –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
            const headers = {
                'Content-Type': 'application/json',
                'X-User-ID': userId,
                ...options.headers
            };
            
            return fetch(url, {
                ...options,
                headers
            }).catch(error => {
                console.error('‚ùå –û—à–∏–±–∫–∞ API –∑–∞–ø—Ä–æ—Å–∞:', error);
                throw error;
            });
        }
        
        // –ó–∞—â–∏—Ç–∞ –æ—Ç XSS - —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞
        function sanitizeText(text) {
            if (typeof text !== 'string') return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // –ó–∞—â–∏—Ç–∞ –æ—Ç –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–π —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å
        (function() {
            const originalConsole = window.console;
            const protectedKeys = ['balance', '_balance', 'changeBalance', 'setBalanceFromServer'];
            
            protectedKeys.forEach(key => {
                Object.defineProperty(window, key, {
                    get: function() {
                        if (key === 'balance') return _balance;
                        return undefined;
                    },
                    set: function() {
                        console.warn('‚ö†Ô∏è –ü—Ä—è–º–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∑–∞—â–∏—â—ë–Ω–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ');
                    },
                    configurable: false
                });
            });
        })();
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function getUsername() {
            const user = tg?.initDataUnsafe?.user;
            return user?.username || user?.first_name || 'Unknown';
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ñ–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function getUserPhotoUrl() {
            const user = tg?.initDataUnsafe?.user;
            return user?.photo_url || null;
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Å–µ—Ä–≤–µ—Ä–∞ (–±–∞–ª–∞–Ω—Å –∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å)
        async function loadUserData() {
            const userId = getUserId();
            if (!userId) {
                console.log('User ID not available, using local storage');
                loadInventory();
                return;
            }
            
            try {
                const response = await makeProtectedRequest(`${API_BASE_URL}/users/${userId}`);
                
                if (response.ok) {
                    const data = await response.json();
                    if (data) {
                        // –ó–∞–≥—Ä—É–∂–∞–µ–º –±–∞–ª–∞–Ω—Å —Å —Å–µ—Ä–≤–µ—Ä–∞ (–∑–∞—â–∏—â—ë–Ω–Ω–æ)
                        if (data.balance !== undefined) {
                            setBalanceFromServer(data.balance);
                        }
                        
                        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
                        if (data.inventory && Array.isArray(data.inventory)) {
                            userInventory = data.inventory;
                            updateInventory();
                        } else {
                            loadInventory();
                        }
                    }
                } else {
                    console.log('Failed to load user data, using local storage');
                    loadInventory();
                }
            } catch (error) {
                console.error('Error loading user data:', error);
                loadInventory();
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä (–±–∞–ª–∞–Ω—Å –∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å)
        async function saveUserData() {
            const userId = getUserId();
            if (!userId) {
                console.warn('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å userId –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
                saveInventory();
                return;
            }
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è: –±–∞–ª–∞–Ω—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–≥—Ä—É–∂–µ–Ω —Å —Å–µ—Ä–≤–µ—Ä–∞
            if (!isServerValidated && _balance > 10000) {
                console.warn('‚ö†Ô∏è –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ –±–æ–ª—å—à–æ–π –±–∞–ª–∞–Ω—Å –±–µ–∑ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å–µ—Ä–≤–µ—Ä–∞');
            }
            
            try {
                // –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
                if (_balance < 0 || _balance > 1000000 || !Array.isArray(userInventory)) {
                    console.error('‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
                    return;
                }
                
                const userData = {
                    userId: userId,
                    username: getUsername(),
                    balance: _balance, // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞—â–∏—â—ë–Ω–Ω—ã–π –±–∞–ª–∞–Ω—Å
                    inventory: userInventory,
                    updatedAt: Date.now()
                };
                
                // –í–∞–ª–∏–¥–∞—Ü–∏—è userId –≤ URL (–∑–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–¥–º–µ–Ω—ã)
                const validatedUserId = getUserId();
                if (validatedUserId !== userId) {
                    console.error('‚ùå –ü–æ–ø—ã—Ç–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å –¥—Ä—É–≥–∏–º userId');
                    return;
                }
                
                const response = await makeProtectedRequest(`${API_BASE_URL}/users/${userId}`, {
                    method: 'POST',
                    body: JSON.stringify(userData)
                });
                
                if (response.ok) {
                    console.log('User data saved successfully');
                    // –¢–∞–∫–∂–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ –¥–ª—è –æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–∞
                    saveInventory();
                } else {
                    console.error('Failed to save user data to server');
                    saveInventory();
                }
            } catch (error) {
                console.error('Error saving user data:', error);
                // –ü—Ä–∏ –æ—à–∏–±–∫–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
                saveInventory();
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è –∏–∑ localStorage
        function loadInventory() {
            try {
                const stored = localStorage.getItem('userInventory');
                const storedBalance = localStorage.getItem('userBalance');
                
                if (stored) {
                    userInventory = JSON.parse(stored);
                } else {
                    userInventory = [];
                }
                
                if (storedBalance) {
                    setBalanceFromServer(parseFloat(storedBalance) || 100.00);
                }
                
                updateInventory();
            } catch (e) {
                console.error('Failed to load inventory:', e);
                userInventory = [];
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è –≤ localStorage
        function saveInventory() {
            try {
                // –í–∞–ª–∏–¥–∞—Ü–∏—è –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
                if (!Array.isArray(userInventory)) {
                    console.error('‚ùå –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –º–∞—Å—Å–∏–≤–æ–º');
                    userInventory = [];
                }
                
                localStorage.setItem('userInventory', JSON.stringify(userInventory));
                localStorage.setItem('userBalance', _balance.toString()); // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞—â–∏—â—ë–Ω–Ω—ã–π –±–∞–ª–∞–Ω—Å
            } catch (e) {
                console.error('Failed to save inventory:', e);
            }
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–∞—Ä–∫–∞ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
        function addToInventory(prize) {
            userInventory.push({
                icon: prize.icon,
                name: prize.name,
                value: prize.value,
                timestamp: Date.now(),
                id: Date.now() + Math.random()
            });
            saveInventory();
            saveUserData(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            updateInventory();
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ü–µ–Ω—ã —Å –∏–∫–æ–Ω–∫–æ–π –≤–∞–ª—é—Ç—ã
        function formatPrice(value) {
            return `<span class="currency-icon"></span>${value.toFixed(2)}`;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤—ã–∏–≥—Ä—ã—à–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        async function sendPrizeToServer(prize) {
            try {
                const user = tg?.initDataUnsafe?.user;
                const userId = user?.id || null;
                const username = user?.username || user?.first_name || 'Unknown';
                
                const response = await fetch(`${API_BASE_URL}/prizes`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        userId: userId,
                        username: username,
                        icon: prize.icon,
                        name: prize.name,
                        value: prize.value,
                        timestamp: Date.now()
                    })
                });
                
                if (response.ok) {
                    console.log('Prize sent to server successfully');
                    return true;
                } else {
                    console.error('Failed to send prize to server');
                    return false;
                }
            } catch (error) {
                console.error('Error sending prize to server:', error);
                // –ü—Ä–∏ –æ—à–∏–±–∫–µ –¥–æ–±–∞–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ (fallback)
                addPrizeLocally(prize);
                return false;
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –≤—ã–∏–≥—Ä—ã—à–µ–π —Å —Å–µ—Ä–≤–µ—Ä–∞
        async function fetchGlobalPrizes() {
            try {
                const response = await fetch(`${API_BASE_URL}/prizes?limit=50`);
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.prizes && Array.isArray(data.prizes)) {
                        globalPrizes = data.prizes;
                        return true;
                    }
                } else {
                    console.error('Failed to fetch prizes from server');
                    loadPrizesFromLocalStorage();
                    return false;
                }
            } catch (error) {
                console.error('Error fetching prizes from server:', error);
                loadPrizesFromLocalStorage();
                return false;
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–∞—Ä–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ (fallback)
        function addPrizeLocally(prize) {
            globalPrizes.push({
                icon: prize.icon,
                name: prize.name,
                value: prize.value,
                timestamp: Date.now()
            });
            
            if (globalPrizes.length > 50) {
                globalPrizes.shift();
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–µ–∂–¥—É –≤–∫–ª–∞–¥–∫–∞–º–∏
            try {
                localStorage.setItem('globalPrizes', JSON.stringify(globalPrizes));
            } catch (e) {
                console.error('Failed to save to localStorage:', e);
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–¥–∞—Ä–∫–æ–≤ –∏–∑ localStorage
        function loadPrizesFromLocalStorage() {
            try {
                const stored = localStorage.getItem('globalPrizes');
                if (stored) {
                    globalPrizes = JSON.parse(stored);
                } else {
                    // –ù–∞—á–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –ø–æ–¥–∞—Ä–∫–æ–≤
                    globalPrizes = [
                        { icon: 'ItemCase1/_Jne2Jf3nM6erEUU5TEnvU7PWFOiElGs2WJc0zQ250JHxRd6md_v1huDDCpZRSesDCZP53pWDPEnqfojbzsYqjbD.png', name: '–õ–æ–ª–∏ –ø–æ–ø', value: 82.17 },
                        { icon: 'ItemCase1/4dOUEOHs9WSNk5pRBkEnCptGIs16lB5xe4E7mh3sWF6XAkHcwQvINscw7cXwhK5IUXv5eOdct9_vxDZtoaMTm8GJ.png', name: '–ë–∞–±–æ—á–∫–∞', value: 75.66 },
                        { icon: 'ItemCase1/GsJZ-oPiqQHoyerbmc-z_L_NTi8cBWgKmS9ueEOwk5_PHeYbWeRwn6Jxic2d1Yhl8IZwt0rBUg5ZfvrkYkYp0UrO.png', name: '–ó–µ–ª—å–µ', value: 69.30 },
                        { icon: 'ItemCase1/qlq8mJd7J1-60XWhd29rLbtjBfzeXSPLMVgzkcBDTNfHL50TBMHG2B0h2jB1bAd-rJWlHO1NtkI0zAsWF4BgcVHn.png', name: '–®–ª–µ–º', value: 25.27 },
                        { icon: 'ItemCase1/QrKwYOzBzIX1ilzkfuCuiFdyCRU9jBm5pASbp_z2Sb6ATFNaaB1Zr1XfNGehXeHTYhldZNO8x4_l0ueW2t4MZ62W.png', name: '–°–∏–≥–∞—Ä–∞', value: 23.50 }
                    ];
                }
            } catch (e) {
                console.error('Failed to load from localStorage:', e);
            }
        }

        // –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
        function safeInit() {
            try {
                console.log('üîß –ù–∞—á–∏–Ω–∞—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                const criticalElements = [
                    'mainPage', 
                    'profilePage', 
                    'crashPage', 
                    'minesPage', 
                    'dicePage',
                    'balance',
                    'crashBalance'
                ];
                
                const missingElements = criticalElements.filter(id => !document.getElementById(id));
                if (missingElements.length > 0) {
                    console.error('‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã:', missingElements);
                    alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
                    return;
                }
                
                console.log('‚úÖ –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞–π–¥–µ–Ω—ã');
                
                // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ–±—ã—á–Ω—É—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
                if (typeof initApp === 'function') {
                    initApp();
                } else {
                    console.warn('‚ö†Ô∏è –§—É–Ω–∫—Ü–∏—è initApp –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                }
                
                // –¢–∞–∫–∂–µ –≤—ã–∑—ã–≤–∞–µ–º initEventHandlers –µ—Å–ª–∏ –æ–Ω–∞ –¥–æ—Å—Ç—É–ø–Ω–∞
                if (typeof initEventHandlers === 'function') {
                    setTimeout(() => {
                        console.log('üîÑ –í—ã–∑–æ–≤ initEventHandlers –∏–∑ safeInit...');
                        initEventHandlers();
                    }, 150);
                }
            } catch (error) {
                console.error('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: ' + error.message);
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ DOM
        function initializeApp() {
            try {
                safeInit();
                setTimeout(function() {
                    if (typeof initEventHandlers === 'function') {
                        initEventHandlers();
                    }
                }, 200);
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
            }
        }
        
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
        function initEventHandlers() {
            // –ù–∞–≤–∏–≥–∞—Ü–∏—è —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ inline onclick –∏ –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ç–∞–±–æ–≤
            if (typeof initTabs === 'function') {
                initTabs();
            }
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ –∫–µ–π—Å–æ–≤
            if (typeof initCaseCards === 'function') {
                initCaseCards();
            }
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–û—Ç–∫—Ä—ã—Ç—å"
            if (typeof initOpenButton === 'function') {
                initOpenButton();
            }
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏
            if (typeof initSubscribeButton === 'function') {
                initSubscribeButton();
            }
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
            if (typeof initInventoryHandlers === 'function') {
                initInventoryHandlers();
            }
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ –ø—Ä–æ—Ñ–∏–ª—è
            if (typeof initProfileHandlers === 'function') {
                initProfileHandlers();
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –∏ –≤—ã–≤–æ–¥–∞
            if (typeof initTopUpHandlers === 'function') {
                initTopUpHandlers();
            }
            
            if (typeof initWithdrawHandlers === 'function') {
                initWithdrawHandlers();
            }
        }
        
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ –∫–µ–π—Å–æ–≤
        function initCaseCards() {
            try {
                const cards = document.querySelectorAll('.case-card');
                console.log(`‚úÖ –ù–∞–π–¥–µ–Ω–æ ${cards.length} –∫–∞—Ä—Ç–æ—á–µ–∫ –∫–µ–π—Å–æ–≤`);
                
                // –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏
                cards.forEach(card => {
                    const newCard = card.cloneNode(true);
                    const caseNum = parseInt(newCard.dataset.case || '1');
                    card.parentNode.replaceChild(newCard, card);
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º inline onclick –ø—Ä—è–º–æ –≤ HTML –∞—Ç—Ä–∏–±—É—Ç
                    newCard.setAttribute('onclick', 'window.handleCaseClick(' + caseNum + ');');
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —á–µ—Ä–µ–∑ onclick –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏
                    newCard.onclick = function(e) {
                        if (e) {
                            e.preventDefault();
                            e.stopPropagation();
                            e.stopImmediatePropagation();
                        }
                        console.log('üîµ –ö–ª–∏–∫ –ø–æ –∫–µ–π—Å—É —á–µ—Ä–µ–∑ onclick:', caseNum);
                        window.handleCaseClick(caseNum);
                        return false;
                    };
                    
                    // –¢–∞–∫–∂–µ —á–µ—Ä–µ–∑ addEventListener
                    newCard.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        e.stopImmediatePropagation();
                        console.log('üîµ –ö–ª–∏–∫ –ø–æ –∫–µ–π—Å—É —á–µ—Ä–µ–∑ addEventListener:', caseNum);
                        window.handleCaseClick(caseNum);
                    }, { capture: true });
                });
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞—Ä—Ç–æ—á–µ–∫:', error);
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏ "–û—Ç–∫—Ä—ã—Ç—å"
        function initOpenButton() {
            try {
                const openBtn = document.getElementById('openBtn');
                if (openBtn) {
                    const newBtn = openBtn.cloneNode(true);
                    openBtn.parentNode.replaceChild(newBtn, openBtn);
                    
                    newBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log('–ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ –û—Ç–∫—Ä—ã—Ç—å');
                        
                        if (typeof window.openCase === 'function') {
                            window.openCase();
                        } else {
                            console.error('–§—É–Ω–∫—Ü–∏—è openCase –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                            if (typeof openCaseFunc === 'function') {
                                openCaseFunc();
                            }
                        }
                    });
                    console.log('‚úÖ –ö–Ω–æ–ø–∫–∞ "–û—Ç–∫—Ä—ã—Ç—å" –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
                } else {
                    console.warn('‚ö†Ô∏è –ö–Ω–æ–ø–∫–∞ "–û—Ç–∫—Ä—ã—Ç—å" –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                }
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–Ω–æ–ø–∫–∏ "–û—Ç–∫—Ä—ã—Ç—å":', error);
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏
        function initSubscribeButton() {
            try {
                const subscribeBtn = document.querySelector('.subscribe-btn');
                if (subscribeBtn) {
                    const newBtn = subscribeBtn.cloneNode(true);
                    subscribeBtn.parentNode.replaceChild(newBtn, subscribeBtn);
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —á–µ—Ä–µ–∑ onclick –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏
                    newBtn.onclick = function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        e.stopImmediatePropagation();
                        console.log('‚úÖ –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ –ø–æ–¥–ø–∏—Å–∫–∏ (onclick)');
                        
                        try {
                            if (tg && tg.openTelegramLink) {
                                tg.openTelegramLink('https://t.me/YourChannel');
                                if (tg.HapticFeedback) {
                                    tg.HapticFeedback.impactOccurred('medium');
                                }
                            } else {
                                window.open('https://t.me/YourChannel', '_blank');
                            }
                        } catch (err) {
                            console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Å—ã–ª–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏:', err);
                            window.open('https://t.me/YourChannel', '_blank');
                        }
                        return false;
                    };
                    
                    // –¢–∞–∫–∂–µ —á–µ—Ä–µ–∑ addEventListener –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏
                    newBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        e.stopImmediatePropagation();
                        console.log('‚úÖ –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ –ø–æ–¥–ø–∏—Å–∫–∏ (addEventListener)');
                        
                        if (tg && tg.openTelegramLink) {
                            tg.openTelegramLink('https://t.me/YourChannel');
                            if (tg.HapticFeedback) {
                                tg.HapticFeedback.impactOccurred('medium');
                            }
                        } else {
                            window.open('https://t.me/YourChannel', '_blank');
                        }
                    }, { capture: true });
                    
                    console.log('‚úÖ –ö–Ω–æ–ø–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
                } else {
                    console.warn('‚ö†Ô∏è –ö–Ω–æ–ø–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                }
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–Ω–æ–ø–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏:', error);
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
        function initInventoryHandlers() {
            try {
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ü—Ä–æ–¥–∞—Ç—å –≤—Å–µ"
                const sellAllBtn = document.getElementById('sellAllBtn');
                if (sellAllBtn && typeof sellAllItems === 'function') {
                    const newBtn = sellAllBtn.cloneNode(true);
                    sellAllBtn.parentNode.replaceChild(newBtn, sellAllBtn);
                    newBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log('–ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ "–ü—Ä–æ–¥–∞—Ç—å –≤—Å–µ"');
                        sellAllItems();
                    });
                    console.log('‚úÖ –ö–Ω–æ–ø–∫–∞ "–ü—Ä–æ–¥–∞—Ç—å –≤—Å–µ" –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
                } else {
                    console.warn('‚ö†Ô∏è –ö–Ω–æ–ø–∫–∞ "–ü—Ä–æ–¥–∞—Ç—å –≤—Å–µ" –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –∏–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è sellAllItems –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞');
                }
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–ª–æ—Ç–æ–≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è:', error);
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∫–Ω–æ–ø–æ–∫ –ø—Ä–æ—Ñ–∏–ª—è
        function initProfileHandlers() {
            try {
                console.log('üîß –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –ø—Ä–æ—Ñ–∏–ª—è...');
                
                // –ö–Ω–æ–ø–∫–∞ "–ü–æ–ø–æ–ª–Ω–∏—Ç—å" - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–ø—Ä—è–º—É—é
                const topUpBtn = document.getElementById('topUpBtn');
                if (topUpBtn) {
                    // –£–¥–∞–ª—è–µ–º –≤—Å–µ —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —á–µ—Ä–µ–∑ –∫–ª–æ–Ω
                    const newBtn = topUpBtn.cloneNode(true);
                    topUpBtn.parentNode.replaceChild(newBtn, topUpBtn);
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
                    const topUpHandler = function(e) {
                        if (e) {
                            e.preventDefault();
                            e.stopPropagation();
                            e.stopImmediatePropagation();
                        }
                        console.log('‚úÖ –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ "–ü–æ–ø–æ–ª–Ω–∏—Ç—å" –≤ –ø—Ä–æ—Ñ–∏–ª–µ');
                        
                        try {
                            if (typeof openTopUpModal === 'function') {
                                openTopUpModal();
                            } else {
                                console.error('‚ùå –§—É–Ω–∫—Ü–∏—è openTopUpModal –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                                alert('–û—à–∏–±–∫–∞: —Ñ—É–Ω–∫—Ü–∏—è openTopUpModal –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                            }
                        } catch (err) {
                            console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ openTopUpModal:', err);
                            alert('–û—à–∏–±–∫–∞: ' + err.message);
                        }
                        return false;
                    };
                    
                    newBtn.onclick = topUpHandler;
                    newBtn.addEventListener('click', topUpHandler, { capture: true });
                    window.handleTopUp = topUpHandler;
                    
                    console.log('‚úÖ –ö–Ω–æ–ø–∫–∞ "–ü–æ–ø–æ–ª–Ω–∏—Ç—å" –≤ –ø—Ä–æ—Ñ–∏–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
                } else {
                    console.warn('‚ö†Ô∏è –ö–Ω–æ–ø–∫–∞ "–ü–æ–ø–æ–ª–Ω–∏—Ç—å" –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                }
                
                // –ö–Ω–æ–ø–∫–∞ "–í—ã–≤–µ—Å—Ç–∏" - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–ø—Ä—è–º—É—é
                const withdrawBtn = document.getElementById('withdrawBtn');
                if (withdrawBtn) {
                    // –£–¥–∞–ª—è–µ–º –≤—Å–µ —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —á–µ—Ä–µ–∑ –∫–ª–æ–Ω
                    const newBtn = withdrawBtn.cloneNode(true);
                    withdrawBtn.parentNode.replaceChild(newBtn, withdrawBtn);
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
                    const withdrawHandler = function(e) {
                        if (e) {
                            e.preventDefault();
                            e.stopPropagation();
                            e.stopImmediatePropagation();
                        }
                        console.log('‚úÖ –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ "–í—ã–≤–µ—Å—Ç–∏" –≤ –ø—Ä–æ—Ñ–∏–ª–µ');
                        
                        try {
                            if (typeof openWithdrawModal === 'function') {
                                openWithdrawModal();
                            } else {
                                console.error('‚ùå –§—É–Ω–∫—Ü–∏—è openWithdrawModal –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                                alert('–û—à–∏–±–∫–∞: —Ñ—É–Ω–∫—Ü–∏—è openWithdrawModal –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                            }
                        } catch (err) {
                            console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ openWithdrawModal:', err);
                            alert('–û—à–∏–±–∫–∞: ' + err.message);
                        }
                        return false;
                    };
                    
                    newBtn.onclick = withdrawHandler;
                    newBtn.addEventListener('click', withdrawHandler, { capture: true });
                    window.handleWithdraw = withdrawHandler;
                    
                    console.log('‚úÖ –ö–Ω–æ–ø–∫–∞ "–í—ã–≤–µ—Å—Ç–∏" –≤ –ø—Ä–æ—Ñ–∏–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
                } else {
                    console.warn('‚ö†Ô∏è –ö–Ω–æ–ø–∫–∞ "–í—ã–≤–µ—Å—Ç–∏" –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                }
                
                console.log('‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã');
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –ø—Ä–æ—Ñ–∏–ª—è:', error);
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            console.log('‚úÖ DOMContentLoaded - –Ω–∞—á–∏–Ω–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é');
            
            // –°–†–ê–ó–£ –æ–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å
            setTimeout(function() {
                if (typeof updateBalanceDisplay === 'function') {
                    console.log('üí∞ –û–±–Ω–æ–≤–ª—è—é –±–∞–ª–∞–Ω—Å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ...');
                    updateBalanceDisplay();
                } else {
                    console.error('‚ùå updateBalanceDisplay –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
                }
            }, 100);
            const mainPage = document.getElementById('mainPage');
            const detailPage = document.getElementById('caseDetailPage');
            const profilePage = document.getElementById('profilePage');
            
            if (!mainPage || !detailPage || !profilePage) {
                console.error('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã!');
                return;
            }
            
            mainPage.style.display = 'block';
            mainPage.classList.remove('hidden');
            detailPage.style.display = 'none';
            detailPage.classList.remove('active');
            profilePage.style.display = 'none';
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –°–†–ê–ó–£ –∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑
            console.log('üöÄ –ù–∞—á–∏–Ω–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é...');
            
            function doInit() {
                console.log('üîß –í—ã–∑—ã–≤–∞—é initEventHandlers...');
                if (typeof initEventHandlers === 'function') {
                    initEventHandlers();
                } else {
                    console.error('‚ùå initEventHandlers –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
                }
                
                console.log('üîß –í—ã–∑—ã–≤–∞—é initCaseCards...');
                if (typeof initCaseCards === 'function') {
                    initCaseCards();
                } else {
                    console.error('‚ùå initCaseCards –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
                }
                
                console.log('üîß –í—ã–∑—ã–≤–∞—é initOpenButton...');
                if (typeof initOpenButton === 'function') {
                    initOpenButton();
                } else {
                    console.error('‚ùå initOpenButton –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
                }
                
                // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –∏ –≤—ã–≤–æ–¥–∞
                if (typeof initTopUpHandlers === 'function') {
                    initTopUpHandlers();
                }
                if (typeof initWithdrawHandlers === 'function') {
                    initWithdrawHandlers();
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –∫–µ–π—Å–æ–≤
                const cards = document.querySelectorAll('.case-card');
                console.log('üìã –ù–∞–π–¥–µ–Ω–æ –∫–∞—Ä—Ç–æ—á–µ–∫ –∫–µ–π—Å–æ–≤:', cards.length);
                cards.forEach((card, i) => {
                    const caseNum = card.dataset.case;
                    console.log(`üìã –ö–µ–π—Å ${i}: data-case="${caseNum}", onclick="${card.getAttribute('onclick')}"`);
                });
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–Ω–æ–ø–∫–∏
                const makeBetBtn = document.getElementById('makeBetBtn');
                const minesStartBtn = document.getElementById('minesStartBtn');
                const diceStartBtn = document.getElementById('diceStartBtn');
                console.log('üìã makeBetBtn:', makeBetBtn ? '–Ω–∞–π–¥–µ–Ω–∞' : '–ù–ï –ù–ê–ô–î–ï–ù–ê');
                console.log('üìã minesStartBtn:', minesStartBtn ? '–Ω–∞–π–¥–µ–Ω–∞' : '–ù–ï –ù–ê–ô–î–ï–ù–ê');
                console.log('üìã diceStartBtn:', diceStartBtn ? '–Ω–∞–π–¥–µ–Ω–∞' : '–ù–ï –ù–ê–ô–î–ï–ù–ê');
            }
            
            // –í—ã–∑—ã–≤–∞–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ —Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏
            doInit();
            setTimeout(doInit, 100);
            setTimeout(doInit, 300);
            setTimeout(doInit, 500);
            setTimeout(doInit, 1000);
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–¥–∞—Ä–∫–∏ —Å —Å–µ—Ä–≤–µ—Ä–∞ –∏–ª–∏ –∏–∑ localStorage
            fetchGlobalPrizes();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–±–∞–ª–∞–Ω—Å –∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å) —Å —Å–µ—Ä–≤–µ—Ä–∞
            loadUserData();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø—Ä–æ—Ñ–∏–ª—è
            updateProfileInfo();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–≤–∞—Ç–∞—Ä–∫—É –∏ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Ö–µ–¥–µ—Ä–µ (—Å –∑–∞–¥–µ—Ä–∂–∫–æ–π –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏ Telegram API)
            setTimeout(() => {
                updateHeaderAvatar();
                // –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É –Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ API –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω
                setTimeout(updateHeaderAvatar, 1000);
            }, 100);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ–¥–∞—Ä–∫–æ–≤ –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã
            setInterval(() => {
                fetchGlobalPrizes();
            }, 3000);
            
            // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ localStorage (–¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–µ–∂–¥—É –≤–∫–ª–∞–¥–∫–∞–º–∏)
            window.addEventListener('storage', (e) => {
                if (e.key === 'globalPrizes') {
                    loadPrizesFromLocalStorage();
                }
                if (e.key === 'userInventory') {
                    loadInventory();
                }
            });
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ
        function initApp() {
            try {
                console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
                
                updateBalanceDisplay();
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                loadUserData().catch(err => {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', err);
                });
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø—Ä–∏–∑—ã
                fetchGlobalPrizes().catch(err => {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏–∑–æ–≤:', err);
                });
                
                console.log('‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ');
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:', error);
            }
        }

        // –°–∫—Ä—ã–≤–∞–µ–º –Ω–∞–¥–ø–∏—Å—å "5 TON Demo"
        const tonBalance = document.querySelector('.ton-balance');
        if (tonBalance) {
            tonBalance.style.display = 'none';
            tonBalance.style.visibility = 'hidden';
            tonBalance.style.opacity = '0';
            tonBalance.style.height = '0';
            tonBalance.style.margin = '0';
            tonBalance.style.padding = '0';
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∫–∏ –∏ –∏–º–µ–Ω–∏ –≤ —à–∞–ø–∫–µ
        function updateHeaderAvatar() {
            try {
                console.log('üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∫–∏ –∏ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...');
                
                // –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram
                let user = null;
                
                if (tg && tg.initDataUnsafe && tg.initDataUnsafe.user) {
                    user = tg.initDataUnsafe.user;
                    console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram:', user);
                } else {
                    console.warn('‚ö†Ô∏è Telegram Web App API –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏–ª –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                    console.log('tg:', tg);
                    console.log('tg?.initDataUnsafe:', tg?.initDataUnsafe);
                }
                
                const usernameEl = document.getElementById('username');
                const avatarEl = document.querySelector('.avatar');
                
        if (user) {
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    if (usernameEl) {
                        const displayName = user.first_name || user.username || user.last_name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
                        usernameEl.textContent = displayName;
                        console.log('‚úÖ –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–æ:', displayName);
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∞–≤–∞—Ç–∞—Ä–∫—É
                    if (avatarEl) {
                        if (user.photo_url) {
                            // –°–æ–∑–¥–∞–µ–º img —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –∞–≤–∞—Ç–∞—Ä–∫–∏
                            const img = document.createElement('img');
                            img.src = user.photo_url;
                            img.style.width = '100%';
                            img.style.height = '100%';
                            img.style.objectFit = 'cover';
                            img.style.borderRadius = '50%';
                            img.onerror = function() {
                                console.warn('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                                avatarEl.innerHTML = 'üë§';
                            };
                            img.onload = function() {
                                console.log('‚úÖ –§–æ—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∑–∞–≥—Ä—É–∂–µ–Ω–æ');
                            };
                            avatarEl.innerHTML = '';
                            avatarEl.appendChild(img);
                        } else {
                            // –ï—Å–ª–∏ —Ñ–æ—Ç–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–º–æ–¥–∑–∏
                            avatarEl.innerHTML = 'üë§';
                            console.log('‚ÑπÔ∏è –§–æ—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —ç–º–æ–¥–∑–∏');
                        }
                    }
                } else {
                    // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã, –æ—Å—Ç–∞–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                    if (usernameEl) {
                        usernameEl.textContent = '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
                    }
                    if (avatarEl && !avatarEl.querySelector('img')) {
                        avatarEl.innerHTML = 'üë§';
                    }
                    console.warn('‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é');
                }
                
                // –¢–∞–∫–∂–µ –æ–±–Ω–æ–≤–ª—è–µ–º –∏–º—è –≤ –ø—Ä–æ—Ñ–∏–ª–µ
                const profileUsernameEl = document.getElementById('profileUsername');
                if (profileUsernameEl && user) {
                    const displayName = user.first_name || user.username || user.last_name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
                    profileUsernameEl.textContent = displayName;
                }
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–∫–∏:', error);
            }
        }
        
        // –í—ã–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        // updateHeaderAvatar –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω–∞ –≤ DOMContentLoaded

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–∞–±–æ–≤ (—É–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤ initEventHandlers)
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ –∫–µ–π—Å–æ–≤ —Ç–∞–∫–∂–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è –≤ initCaseCards

        window.openCase = function() {
            console.log('üîµ openCase –≤—ã–∑–≤–∞–Ω–∞');
            console.log('currentCase:', currentCase);
            console.log('isOpening:', isOpening);
            console.log('_balance:', _balance);
            
            if (!currentCase) {
                console.error('‚ùå currentCase –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞!');
                if (tg) {
                    tg.showAlert('–û—à–∏–±–∫–∞: –ö–µ–π—Å –Ω–µ –≤—ã–±—Ä–∞–Ω');
                } else {
                    alert('–û—à–∏–±–∫–∞: –ö–µ–π—Å –Ω–µ –≤—ã–±—Ä–∞–Ω');
                }
                return;
            }
            
            if (isOpening) {
                console.warn('‚ö†Ô∏è –ö–µ–π—Å —É–∂–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è');
                return;
            }
            
            if (currentCase && !isOpening) {
                const openCaseFunc = function() {
                    if (isOpening) return;
                    console.log('‚úÖ –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è openCaseFunc');
                    
                    const price = currentCase.price || 0;
                    console.log('üí∞ –¶–µ–Ω–∞ –∫–µ–π—Å–∞:', price);
                    console.log('üí∞ –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å:', _balance);
                    
                    if (_balance < price) {
                        console.error('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–ª–∞–Ω—Å–∞!');
                        if (tg) {
                            tg.showAlert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–ª–∞–Ω—Å–∞! –ù—É–∂–Ω–æ: ' + price + ', –µ—Å—Ç—å: ' + _balance.toFixed(2));
                            tg.HapticFeedback.notificationOccurred('error');
                        } else {
                            alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–ª–∞–Ω—Å–∞! –ù—É–∂–Ω–æ: ' + price + ', –µ—Å—Ç—å: ' + _balance.toFixed(2));
                        }
                        isOpening = false;
                        return;
                    }

                    isOpening = true;
                    if (!changeBalance(-price, 'openCase')) {
                        isOpening = false;
                        return;
                    }
                    saveInventory(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –±–∞–ª–∞–Ω—Å –ª–æ–∫–∞–ª—å–Ω–æ
                    saveUserData(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –±–∞–ª–∞–Ω—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                    
                    const detailIcon = document.getElementById('detailIcon');
                    const rouletteContainer = document.getElementById('rouletteContainer');
                    const openBtn = document.getElementById('openBtn');
                    
                    // –ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –ø—Ä–∏ –Ω–∞—á–∞–ª–µ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
                    openBtn.classList.remove('show');
                    openBtn.style.cssText = 'display: none !important;';
                    openBtn.disabled = true;
                    
                    // –°–∫—Ä—ã–≤–∞–µ–º –∏–∫–æ–Ω–∫—É —Ç–æ–ª—å–∫–æ –≤–æ –≤—Ä–µ–º—è —Ä—É–ª–µ—Ç–∫–∏
                    detailIcon.style.display = 'none';
                    
                    // –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–µ–º —Ä—É–ª–µ—Ç–∫—É, –ø–æ—Ç–æ–º –ø–æ–∫–∞–∑—ã–≤–∞–µ–º
                    createRoulette();
                    
                    // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–∏–¥–∏–º
                    rouletteContainer.style.display = 'block';
                    rouletteContainer.classList.add('active');

                    if (tg) {
                        tg.HapticFeedback.impactOccurred('heavy');
                    }
                    
                    // –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –æ—Ç—Ä–∏—Å–æ–≤–∫—É —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø–µ—Ä–µ–¥ –∞–Ω–∏–º–∞—Ü–∏–µ–π
                    setTimeout(() => {
                        // –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –ø—Ä–∏–∑ –∏–∑ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö
                        const randomPrize = currentPrizes[Math.floor(Math.random() * currentPrizes.length)];
                        const rouletteTrack = document.getElementById('rouletteTrack');
                        const giftItems = rouletteTrack.querySelectorAll('.gift-item');
                        
                        // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –≤–∏–¥–Ω—ã –°–†–ê–ó–£
                        giftItems.forEach(item => {
                            item.style.opacity = '1';
                            item.style.visibility = 'visible';
                            item.style.display = 'flex';
                        });
                        
                        const itemWidth = 150 + 20; // 150px —à–∏—Ä–∏–Ω–∞ + 20px gap
                        const containerWidth = rouletteContainer.offsetWidth;
                        
                        // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ –ø–æ–¥–∞—Ä–∫–∏ —Å –Ω—É–∂–Ω—ã–º –∏–∫–æ–Ω–æ–º (–∏–∫–æ–Ω–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø—Ä–∏–∑–∞)
                        const matchingIndices = [];
                        for (let i = 0; i < giftItems.length; i++) {
                            if (giftItems[i].dataset.icon === randomPrize.icon && 
                                giftItems[i].dataset.name === randomPrize.name) {
                                matchingIndices.push(i);
                            }
                        }
                        
                        // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –∏–Ω–¥–µ–∫—Å –∏–∑ —Å–µ—Ä–µ–¥–∏–Ω—ã –º–∞—Å—Å–∏–≤–∞ –¥–ª—è –ø–ª–∞–≤–Ω–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
                        let targetIndex;
                        if (matchingIndices.length > 0) {
                            const midPoint = Math.floor(giftItems.length / 2);
                            const candidates = matchingIndices.filter(idx => 
                                idx > midPoint - giftItems.length / 4 && 
                                idx < midPoint + giftItems.length / 4
                            );
                            targetIndex = candidates.length > 0 
                                ? candidates[Math.floor(Math.random() * candidates.length)]
                                : matchingIndices[Math.floor(matchingIndices.length / 2)];
                        } else {
                            // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ, –≤—ã–±–∏—Ä–∞–µ–º –∏–∑ —Å–µ—Ä–µ–¥–∏–Ω—ã
                            targetIndex = Math.floor(giftItems.length / 2);
                        }
                        
                        // –†–∞—Å—á–µ—Ç –ø–æ–∑–∏—Ü–∏–π
                        // –¢—Ä–µ–∫ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ —á–µ—Ä–µ–∑ left: 50% –∏ transform: translate(-50%, -50%)
                        // –ü–æ—ç—Ç–æ–º—É –ø–æ–∑–∏—Ü–∏—è 0 = —Ü–µ–Ω—Ç—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
                        // –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è = –¥–≤–∏–∂–µ–Ω–∏–µ –≤–ª–µ–≤–æ, –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ = –≤–ø—Ä–∞–≤–æ
                        
                        // –¶–µ–ª–µ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è: —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫
                        const targetItemCenter = targetIndex * itemWidth + itemWidth / 2;
                        const totalTrackWidth = giftItems.length * itemWidth;
                        const targetItemOffset = targetItemCenter - totalTrackWidth / 2;
                        
                        // –ù–∞—á–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è: –¥–æ–±–∞–≤–ª—è–µ–º –º–Ω–æ–≥–æ –ø—Ä–æ–∫—Ä—É—Ç–æ–∫ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞
                        const spins = 15;
                        const extraDistance = spins * currentPrizes.length * itemWidth;
                        const startPosition = targetItemOffset + extraDistance;
                        
                        // –§–∏–Ω–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è: —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫
                        const finalPosition = targetItemOffset;
                        
                        const spinDuration = 4000;
                        
                        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é
                        rouletteTrack.style.left = '50%';
                        rouletteTrack.style.top = '50%';
                        rouletteTrack.style.transform = `translate(calc(-50% + ${startPosition}px), -50%)`;
                        rouletteTrack.style.transition = 'none';
                        rouletteTrack.style.display = 'flex';
                        rouletteTrack.style.visibility = 'visible';
                        rouletteTrack.style.opacity = '1';
                        rouletteTrack.style.position = 'absolute';
                        rouletteTrack.style.marginTop = '0';
                        rouletteTrack.style.marginBottom = '0';
                        
                        let startTime = Date.now();
                        const animateRoulette = () => {
                            const elapsed = Date.now() - startTime;
                            const progress = Math.min(elapsed / spinDuration, 1);
                            
                            // –ü—Ä–æ—Å—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–º–µ–¥–ª–µ–Ω–∏—è
                            const ease = 1 - Math.pow(1 - progress, 3);
                            const currentOffset = startPosition + (finalPosition - startPosition) * ease;
                            
                            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—é - —Ç—Ä–µ–∫ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω, —Å–º–µ—â–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–æ X, Y –≤—Å–µ–≥–¥–∞ -50%
                            rouletteTrack.style.transform = `translate(calc(-50% + ${currentOffset}px), -50%)`;
                            rouletteTrack.style.top = '50%';
                            rouletteTrack.style.marginTop = '0';
                            rouletteTrack.style.marginBottom = '0';
                            
                            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –∏ –í–°–ï–ì–î–ê –¥–µ–ª–∞–µ–º –≤—Å–µ –≤–∏–¥–∏–º—ã–º–∏
                            giftItems.forEach((item, index) => {
                                // –í–ê–ñ–ù–û: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –¥–µ–ª–∞–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –≤–∏–¥–∏–º—ã–º–∏ –Ω–∞ –∫–∞–∂–¥–æ–º –∫–∞–¥—Ä–µ
                                item.style.cssText = `
                                    opacity: 1 !important;
                                    visibility: visible !important;
                                    display: flex !important;
                                    transition: none !important;
                                    flex-shrink: 0 !important;
                                    width: 150px !important;
                                    min-width: 150px !important;
                                    max-width: 150px !important;
                                    height: 150px !important;
                                    position: relative !important;
                                    top: 0 !important;
                                    margin: 0 !important;
                                    padding: 0 !important;
                                    vertical-align: top !important;
                                `;
                                
                                // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ —Ç–æ–∂–µ –≤–∏–¥–∏–º—ã
                                const images = item.querySelectorAll('img');
                                images.forEach(img => {
                                    img.style.cssText = `
                                        opacity: 1 !important;
                                        visibility: visible !important;
                                        display: block !important;
                                        width: 80px !important;
                                        height: 80px !important;
                                    `;
                                });
                                
                                // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ —Ç–µ–∫—Å—Ç —Ç–æ–∂–µ –≤–∏–¥–∏–º
                                const textElements = item.querySelectorAll('.gift-name');
                                textElements.forEach(text => {
                                    text.style.cssText = `
                                        opacity: 1 !important;
                                        visibility: visible !important;
                                    `;
                                });
                                
                                // –†–∞—Å—á–µ—Ç –ø–æ–∑–∏—Ü–∏–∏ —ç–ª–µ–º–µ–Ω—Ç–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ü–µ–Ω—Ç—Ä–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
                                // –¢—Ä–µ–∫ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω, –ø–æ—ç—Ç–æ–º—É —Ü–µ–Ω—Ç—Ä —Ç—Ä–µ–∫–∞ = —Ü–µ–Ω—Ç—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
                                // –ü–æ–∑–∏—Ü–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞ = –µ–≥–æ offset –æ—Ç –Ω–∞—á–∞–ª–∞ —Ç—Ä–µ–∫–∞ - –ø–æ–ª–æ–≤–∏–Ω–∞ —à–∏—Ä–∏–Ω—ã —Ç—Ä–µ–∫–∞ + —Ç–µ–∫—É—â–µ–µ —Å–º–µ—â–µ–Ω–∏–µ
                                const itemOffset = index * itemWidth + itemWidth / 2;
                                const totalTrackWidth = giftItems.length * itemWidth;
                                const itemCenter = itemOffset - totalTrackWidth / 2 + currentOffset;
                                const distance = Math.abs(itemCenter);
                                
                                if (distance < itemWidth / 2) {
                                    item.classList.add('selected');
                                } else {
                                    item.classList.remove('selected');
                                }
                            });
                            
                            if (progress < 1) {
                                requestAnimationFrame(animateRoulette);
                            } else {
                                // –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –±—ã–ª –≤—ã–¥–µ–ª–µ–Ω –≤ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–æ–º–µ–Ω—Ç –∞–Ω–∏–º–∞—Ü–∏–∏
                                // (—Ç–æ—Ç, —É –∫–æ—Ç–æ—Ä–æ–≥–æ –∫–ª–∞—Å—Å 'selected' –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)
                                let selectedItem = null;
                                
                                // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —ç–ª–µ–º–µ–Ω—Ç —Å –∫–ª–∞—Å—Å–æ–º selected
                                giftItems.forEach(item => {
                                    if (item.classList.contains('selected')) {
                                        selectedItem = item;
                                    }
                                });
                                
                                // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–∞—Å—á–µ—Ç –ø–æ –ø–æ–∑–∏—Ü–∏–∏
                                if (!selectedItem) {
                                    let minDistance = Infinity;
                                    const centerX = 0;
                                    
                                    giftItems.forEach((item, index) => {
                                        const itemOffset = index * itemWidth + itemWidth / 2;
                                        const totalTrackWidth = giftItems.length * itemWidth;
                                        const itemCenter = itemOffset - totalTrackWidth / 2 + finalPosition;
                                        const distance = Math.abs(itemCenter - centerX);
                                        
                                        if (distance < minDistance) {
                                            minDistance = distance;
                                            selectedItem = item;
                                        }
                                    });
                                }
                                
                                // –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –Ω–µ –Ω–∞—à–ª–∏, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ü–µ–ª–µ–≤–æ–π —ç–ª–µ–º–µ–Ω—Ç
                                if (!selectedItem) {
                                    selectedItem = giftItems[targetIndex];
                                }
                                
                                setTimeout(() => {
                                    giftItems.forEach(item => item.classList.remove('selected'));
                                    
                                    if (selectedItem) {
                                        selectedItem.classList.add('selected');
                                        
                                        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏–∑–∞ –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –∏–∑ —ç–ª–µ–º–µ–Ω—Ç–∞
                                        const actualPrize = {
                                            icon: selectedItem.dataset.icon || '',
                                            name: selectedItem.dataset.name || '',
                                            value: parseFloat(selectedItem.dataset.value) || 0
                                        };
                                        
                                        // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –ø—É—Å—Ç—ã–µ, –±–µ—Ä–µ–º –∏–∑ randomPrize
                                        if (!actualPrize.name || !actualPrize.icon) {
                                            actualPrize.icon = randomPrize.icon;
                                            actualPrize.name = randomPrize.name;
                                            actualPrize.value = randomPrize.value;
                                        }
                                        
                                        console.log('=== PRIZE SELECTION ===');
                                        console.log('Selected item dataset:', {
                                            icon: selectedItem.dataset.icon,
                                            name: selectedItem.dataset.name,
                                            value: selectedItem.dataset.value
                                        });
                                        console.log('Final prize:', actualPrize.name);
                                        console.log('Target prize:', randomPrize.name);
                                        
                                        setTimeout(() => {
                                            showPrizeModal(actualPrize);
                                            
                                            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–∫–æ–Ω–∫—É –∫–µ–π—Å–∞
                                            if (currentCase && (currentCase.icon.includes('.png') || currentCase.icon.includes('.jpg') || currentCase.icon.includes('.jpeg'))) {
                                                const img = document.createElement('img');
                                                img.src = currentCase.icon;
                                                img.alt = 'Case';
                                                img.style.width = '100%';
                                                img.style.maxWidth = '300px';
                                                img.style.height = 'auto';
                                                img.style.objectFit = 'contain';
                                                img.style.display = 'block';
                                                img.onerror = function() {
                                                    detailIcon.textContent = 'üîê';
                                                };
                                                detailIcon.innerHTML = '';
                                                detailIcon.appendChild(img);
                                            }
                                            detailIcon.style.display = 'flex';
                                            
                                            rouletteContainer.classList.remove('active');
                                            isOpening = false;
                                            
                                            if (tg) {
                                                tg.HapticFeedback.notificationOccurred('success');
                                            }
                                        }, 500);
                                    }
                                }, 300);
                            }
                        };
                        
                        requestAnimationFrame(animateRoulette);
                    }, 300);
                };
                openCaseFunc();
            }
        };

        function createRoulette() {
            const rouletteTrack = document.getElementById('rouletteTrack');
            rouletteTrack.innerHTML = '';
            
            // –°–æ–∑–¥–∞–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π –¥–ª—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
            // –ü–æ–≤—Ç–æ—Ä—è–µ–º –ø–æ–¥–∞—Ä–∫–∏ –æ—á–µ–Ω—å –º–Ω–æ–≥–æ —Ä–∞–∑ –≤ —Ç–æ–π –∂–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
            const repeatCount = 50; // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –¥–æ 50 –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
            const extendedPrizes = [];
            for (let i = 0; i < repeatCount; i++) {
                extendedPrizes.push(...currentPrizes);
            }
            
            extendedPrizes.forEach((prize, index) => {
                const giftItem = document.createElement('div');
                giftItem.className = 'gift-item';
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∏–∫–æ–Ω–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
                const iconStr = String(prize.icon || '');
                if (iconStr.toLowerCase().includes('.png') || iconStr.toLowerCase().includes('.jpg') || iconStr.toLowerCase().includes('.jpeg')) {
                    const img = document.createElement('img');
                    img.src = prize.icon;
                    img.alt = prize.name;
                    
                    // –ñ–µ—Å—Ç–∫–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è - –≤—Å–µ–≥–¥–∞ –≤–∏–¥–∏–º–æ–µ
                    img.style.cssText = `
                        width: 80px !important;
                        height: 80px !important;
                        object-fit: contain !important;
                        display: block !important;
                        visibility: visible !important;
                        opacity: 1 !important;
                        pointer-events: auto !important;
                        transition: none !important;
                        position: relative !important;
                    `;
                    
                    img.onload = function() {
                        this.style.opacity = '1';
                        this.style.visibility = 'visible';
                        this.style.display = 'block';
                        console.log('Gift image loaded:', this.src);
                    };
                    
                    img.onerror = function() {
                        console.error('Failed to load gift image:', this.src);
                        this.style.display = 'none';
                    };
                    
                    const nameDiv = document.createElement('div');
                    nameDiv.className = 'gift-name';
                    nameDiv.textContent = prize.name;
                    nameDiv.style.cssText = `
                        opacity: 1 !important;
                        visibility: visible !important;
                    `;
                    
                    giftItem.appendChild(img);
                    giftItem.appendChild(nameDiv);
                } else {
                    giftItem.innerHTML = `
                        ${prize.icon || '?'}
                        <div class="gift-name">${prize.name}</div>
                    `;
                }
                
                giftItem.dataset.icon = prize.icon;
                giftItem.dataset.name = prize.name;
                giftItem.dataset.value = prize.value;
                
                // –ñ–µ—Å—Ç–∫–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –≤–∏–¥–∏–º–æ—Å—Ç–∏
                giftItem.style.cssText = `
                    flex-shrink: 0 !important;
                    visibility: visible !important;
                    opacity: 1 !important;
                    display: flex !important;
                    pointer-events: auto !important;
                    transition: none !important;
                    position: relative !important;
                    z-index: 2 !important;
                    width: 150px !important;
                    min-width: 150px !important;
                    max-width: 150px !important;
                    height: 150px !important;
                `;
                
                rouletteTrack.appendChild(giftItem);
            });
            
            // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ —Ç—Ä–µ–∫ –≤–∏–¥–∏–º
            rouletteTrack.style.cssText = `
                display: flex !important;
                visibility: visible !important;
                opacity: 1 !important;
            `;
        }

        function showCaseDetail(caseNum) {
            window.showCaseDetail = showCaseDetail; // –î–µ–ª–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω–æ–π
            if (isOpening) return;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ cases –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞
            var casesObj = window.cases || cases;
            console.log('showCaseDetail –≤—ã–∑–≤–∞–Ω–∞, caseNum:', caseNum, '—Ç–∏–ø:', typeof caseNum);
            console.log('casesObj:', casesObj);
            console.log('casesObj –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–ª—é—á–∏:', casesObj ? Object.keys(casesObj) : 'undefined');
            
            if (!casesObj) {
                console.error('cases –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞');
                alert('–û—à–∏–±–∫–∞: –î–∞–Ω–Ω—ã–µ –∫–µ–π—Å–æ–≤ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã. –ü–æ–¥–æ–∂–¥–∏—Ç–µ —Å–µ–∫—É–Ω–¥—É –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
                return;
            }
            
            // –ü—Ä–æ–±—É–µ–º –∏ –∫–∞–∫ —á–∏—Å–ª–æ, –∏ –∫–∞–∫ —Å—Ç—Ä–æ–∫—É
            var caseData = casesObj[caseNum] || casesObj[String(caseNum)] || casesObj[parseInt(caseNum)];
            
            if (!caseData) {
                console.error('–ö–µ–π—Å –Ω–µ –Ω–∞–π–¥–µ–Ω, caseNum:', caseNum, '–¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–ª—é—á–∏:', Object.keys(casesObj));
                alert('–û—à–∏–±–∫–∞: –ö–µ–π—Å ' + caseNum + ' –Ω–µ –Ω–∞–π–¥–µ–Ω. –î–æ—Å—Ç—É–ø–Ω—ã–µ: ' + Object.keys(casesObj).join(', '));
                return;
            }
            
            currentCase = caseData;
            if (!currentCase) {
                console.error('‚ùå currentCase –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö');
                return;
            }
            
            console.log('‚úÖ currentCase —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞:', currentCase);
            console.log('‚úÖ –¶–µ–Ω–∞ –∫–µ–π—Å–∞:', currentCase.price);

            isOpening = false;
            
            const mainPage = document.getElementById('mainPage');
            const detailPage = document.getElementById('caseDetailPage');
            const modal = document.getElementById('prizeModal');
            const profilePage = document.getElementById('profilePage');
            
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∫—Ä–æ–º–µ –¥–µ—Ç–∞–ª–µ–π –∫–µ–π—Å–∞
            // –°–∫—Ä—ã–≤–∞–µ–º mainPage
            if (mainPage) {
            mainPage.style.display = 'none';
                mainPage.style.visibility = 'hidden';
                mainPage.style.opacity = '0';
                mainPage.style.pointerEvents = 'none';
            mainPage.classList.add('hidden');
            }
            
            // –°–∫—Ä—ã–≤–∞–µ–º profilePage
            if (profilePage) {
                profilePage.style.display = 'none';
                profilePage.style.visibility = 'hidden';
                profilePage.style.opacity = '0';
                profilePage.style.pointerEvents = 'none';
            }
            
            // –°–∫—Ä—ã–≤–∞–µ–º –¥—Ä—É–≥–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–≥—Ä
            const crashPage = document.getElementById('crashPage');
            const minesPage = document.getElementById('minesPage');
            const dicePage = document.getElementById('dicePage');
            
            if (crashPage) {
                crashPage.style.display = 'none';
                crashPage.style.visibility = 'hidden';
                crashPage.style.opacity = '0';
                crashPage.style.pointerEvents = 'none';
            }
            if (minesPage) {
                minesPage.style.display = 'none';
                minesPage.style.visibility = 'hidden';
                minesPage.style.opacity = '0';
                minesPage.style.pointerEvents = 'none';
            }
            if (dicePage) {
                dicePage.style.display = 'none';
                dicePage.style.visibility = 'hidden';
                dicePage.style.opacity = '0';
                dicePage.style.pointerEvents = 'none';
            }
            
            // –°–∫—Ä—ã–≤–∞–µ–º header
            const header = document.querySelector('.header');
            if (header) {
                header.style.display = 'none';
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º detailPage
            if (detailPage) {
            detailPage.style.display = 'block';
                detailPage.style.visibility = 'visible';
                detailPage.style.opacity = '1';
                detailPage.style.pointerEvents = 'auto';
            detailPage.classList.add('active');
                detailPage.style.position = 'fixed';
                detailPage.style.top = '0';
                detailPage.style.left = '0';
                detailPage.style.right = '0';
                detailPage.style.bottom = '0';
                detailPage.style.zIndex = '1000';
            }
            
            modal.style.display = 'none';
            modal.classList.remove('active');
            
            const detailIcon = document.getElementById('detailIcon');
            if (currentCase.icon.includes('.jpg') || currentCase.icon.includes('.png') || currentCase.icon.includes('.jpeg')) {
                // –î–µ–∫–æ–¥–∏—Ä—É–µ–º –ø—É—Ç—å –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
                let imgPath = currentCase.icon;
                // –ï—Å–ª–∏ –ø—É—Ç—å —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ –Ω–∞–ø—Ä—è–º—É—é
                detailIcon.innerHTML = '';
                const img = document.createElement('img');
                img.src = imgPath;
                img.alt = `Case ${caseNum}`;
                img.style.width = '100%';
                img.style.maxWidth = '300px';
                img.style.height = 'auto';
                img.style.objectFit = 'contain';
                img.style.display = 'block';
                img.onload = function() {
                    console.log('Image loaded successfully:', this.src);
                };
                img.onerror = function() {
                    console.error('Failed to load detail image:', this.src);
                    // –ü–æ–ø—Ä–æ–±—É–µ–º –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å –ø—É—Ç—å
                    try {
                        const decodedPath = decodeURIComponent(imgPath);
                        if (decodedPath !== imgPath) {
                            this.src = decodedPath;
                        } else {
                            detailIcon.textContent = 'üîê';
                        }
                    } catch(e) {
                        detailIcon.textContent = 'üîê';
                    }
                };
                detailIcon.appendChild(img);
            } else {
                detailIcon.textContent = currentCase.icon || 'üîê';
            }
            detailIcon.style.display = 'flex';
            document.getElementById('detailPrice').innerHTML = formatPrice(currentCase.price);
            
            const rouletteContainer = document.getElementById('rouletteContainer');
            rouletteContainer.classList.remove('active');
            
            const prizesGrid = document.getElementById('prizesGrid');
            prizesGrid.innerHTML = '';
            currentPrizes = currentCase.prizes;
            
            currentPrizes.forEach(prize => {
                const prizeItem = document.createElement('div');
                prizeItem.className = 'prize-item';
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∏–∫–æ–Ω–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
                const iconDiv = document.createElement('div');
                iconDiv.className = 'prize-icon';
                
                const iconStr = String(prize.icon || '');
                if (iconStr.toLowerCase().includes('.png') || iconStr.toLowerCase().includes('.jpg') || iconStr.toLowerCase().includes('.jpeg')) {
                    const img = document.createElement('img');
                    
                    // –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –ø—É—Ç–∏
                    const tryLoadImage = (src) => {
                        img.src = src;
                        img.alt = prize.name || 'Prize';
                        img.style.width = '60px';
                        img.style.height = '60px';
                        img.style.objectFit = 'contain';
                        img.style.display = 'block';
                        
                        img.onload = function() {
                            console.log('Prize image loaded:', this.src);
                        };
                        
                        img.onerror = function() {
                            console.error('Failed to load prize image:', this.src);
                            // –ü—Ä–æ–±—É–µ–º –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å –ø—É—Ç—å
                            try {
                                const decodedPath = decodeURIComponent(src);
                                if (decodedPath !== src) {
                                    this.src = decodedPath;
                                    return;
                                }
                            } catch(e) {}
                            
                            // –ü—Ä–æ–±—É–µ–º –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å –ø—É—Ç—å
                            try {
                                const encodedPath = encodeURI(src);
                                if (encodedPath !== src) {
                                    this.src = encodedPath;
                                    return;
                                }
                            } catch(e) {}
                            
                            // –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–ª–æ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ
                            this.style.display = 'none';
                            const textNode = document.createTextNode(prize.name || '?');
                            if (this.parentElement) {
                                this.parentElement.appendChild(textNode);
                            }
                        };
                        
                        iconDiv.appendChild(img);
                    };
                    
                    tryLoadImage(prize.icon);
                } else {
                    iconDiv.textContent = prize.icon || '?';
                }
                
                prizeItem.appendChild(iconDiv);
                
                const valueDiv = document.createElement('div');
                valueDiv.className = 'prize-value';
                valueDiv.innerHTML = formatPrice(prize.value);
                prizeItem.appendChild(valueDiv);
                
                prizeItem.dataset.icon = prize.icon;
                prizeItem.dataset.name = prize.name;
                prizeItem.dataset.value = prize.value;
                prizeItem.classList.remove('win');
                prizesGrid.appendChild(prizeItem);
            });

            const openBtn = document.getElementById('openBtn');
            if (openBtn) {
                console.log('‚úÖ –ù–∞–π–¥–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ openBtn, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏');
                openBtn.disabled = false;
                openBtn.classList.add('show');
                openBtn.style.cssText = 'display: flex !important; visibility: visible !important; opacity: 1 !important; position: fixed !important; bottom: 100px !important; left: 20px !important; right: 20px !important; z-index: 99999 !important; pointer-events: auto !important; cursor: pointer !important;';
                openBtn.innerHTML = '–û—Ç–∫—Ä—ã—Ç—å <span>üöÄ</span>';
                
                // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —á–µ—Ä–µ–∑ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
                const newBtn = openBtn.cloneNode(true);
                openBtn.parentNode.replaceChild(newBtn, openBtn);
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
                newBtn.onclick = function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    e.stopImmediatePropagation();
                    console.log('üîµ –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ "–û—Ç–∫—Ä—ã—Ç—å"');
                    console.log('currentCase:', currentCase);
                    console.log('isOpening:', isOpening);
                    if (currentCase && !isOpening) {
                        window.openCase();
                    } else {
                        console.error('‚ùå –ù–µ–ª—å–∑—è –æ—Ç–∫—Ä—ã—Ç—å: currentCase =', currentCase, ', isOpening =', isOpening);
                        if (tg) {
                            tg.showAlert('–û—à–∏–±–∫–∞: –ö–µ–π—Å –Ω–µ –≤—ã–±—Ä–∞–Ω –∏–ª–∏ —É–∂–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è');
                        } else {
                            alert('–û—à–∏–±–∫–∞: –ö–µ–π—Å –Ω–µ –≤—ã–±—Ä–∞–Ω –∏–ª–∏ —É–∂–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è');
                        }
                    }
                };
                
                newBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    e.stopImmediatePropagation();
                    console.log('üîµ addEventListener –∫–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ "–û—Ç–∫—Ä—ã—Ç—å"');
                    if (currentCase && !isOpening) {
                        window.openCase();
                    }
                }, true);
                
                console.log('‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–∫–∏ "–û—Ç–∫—Ä—ã—Ç—å" —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã');
            } else {
                console.error('‚ùå Open button not found!');
            }

            document.querySelectorAll('.prize-item').forEach(item => {
                item.classList.remove('win', 'spinning-prizes');
            });

            if (tg) {
                tg.HapticFeedback.impactOccurred('medium');
            }
        }

        function goBack() {
            const mainPage = document.getElementById('mainPage');
            const detailPage = document.getElementById('caseDetailPage');
            const modal = document.getElementById('prizeModal');
            const openBtn = document.getElementById('openBtn');
            
            // –°–∫—Ä—ã–≤–∞–µ–º detailPage
            if (detailPage) {
            detailPage.style.display = 'none';
                detailPage.style.visibility = 'hidden';
                detailPage.style.opacity = '0';
                detailPage.style.pointerEvents = 'none';
            detailPage.classList.remove('active');
                detailPage.style.zIndex = '-1';
            }
            
            // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–û—Ç–∫—Ä—ã—Ç—å" –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –Ω–∞–∑–∞–¥
            if (openBtn) {
                openBtn.classList.remove('show');
                openBtn.style.display = 'none';
                openBtn.style.visibility = 'hidden';
                openBtn.style.opacity = '0';
                openBtn.style.pointerEvents = 'none';
                openBtn.disabled = true;
                openBtn.innerHTML = '–û—Ç–∫—Ä—ã—Ç—å <span>üöÄ</span>';
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º mainPage –∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º
            if (mainPage) {
                // –°–Ω–∞—á–∞–ª–∞ —É–¥–∞–ª—è–µ–º –∫–ª–∞—Å—Å hidden, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            mainPage.classList.remove('hidden');
            
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ —Å—Ç–∏–ª–∏ —Å !important —á–µ—Ä–µ–∑ setProperty –¥–ª—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞
                mainPage.style.setProperty('display', 'block', 'important');
                mainPage.style.setProperty('visibility', 'visible', 'important');
                mainPage.style.setProperty('opacity', '1', 'important');
                mainPage.style.setProperty('pointer-events', 'auto', 'important');
                mainPage.style.position = 'relative';
                mainPage.style.width = '100%';
                mainPage.style.minHeight = '100vh';
                
                // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ mainPage
                const casesCarousel = document.getElementById('casesCarousel');
                if (casesCarousel) {
                    casesCarousel.style.setProperty('display', 'flex', 'important');
                    casesCarousel.style.setProperty('visibility', 'visible', 'important');
                    casesCarousel.style.setProperty('opacity', '1', 'important');
                    casesCarousel.style.pointerEvents = 'auto';
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –∫–µ–π—Å—ã
                const caseCards = document.querySelectorAll('.case-card');
                caseCards.forEach(card => {
                    card.style.display = 'flex';
                    card.style.visibility = 'visible';
                    card.style.opacity = '1';
                    card.style.pointerEvents = 'auto';
                });
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–∞–±—ã
                const tabs = document.querySelectorAll('.tab');
                tabs.forEach(tab => {
                    tab.style.display = 'block';
                    tab.style.visibility = 'visible';
                    tab.style.opacity = '1';
                });
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é –≤–Ω–∏–∑—É
                const navBar = document.querySelector('.nav-bar');
                if (navBar) {
                    navBar.style.display = 'flex';
                    navBar.style.visibility = 'visible';
                    navBar.style.opacity = '1';
                }
                
                // –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–µ–π—Å—ã –ø–æ—Å–ª–µ –≤–æ–∑–≤—Ä–∞—Ç–∞
                setTimeout(function() {
                    if (typeof initCaseCards === 'function') {
                        initCaseCards();
                    }
                    if (typeof initOpenButton === 'function') {
                        initOpenButton();
                    }
                    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
                    if (typeof updateBalanceDisplay === 'function') {
                        updateBalanceDisplay();
                    }
                }, 100);
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º header
            const header = document.querySelector('.header');
            if (header) {
                header.style.display = 'flex';
            }
            
            // –°–∫—Ä—ã–≤–∞–µ–º modal
            if (modal) {
            modal.style.display = 'none';
            modal.classList.remove('active');
            }
            
            document.querySelectorAll('.prize-item').forEach(item => {
                item.classList.remove('win', 'spinning-prizes');
            });
            
            isOpening = false;
            currentCase = null;
            
            if (tg) {
                tg.HapticFeedback.impactOccurred('light');
            }
        }
        
        window.goBack = goBack;


        async function showPrizeModal(prize) {
            // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–∞—Ä–æ–∫ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            addToInventory(prize);
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤—ã–∏–≥—Ä—ã—à –Ω–∞ —Å–µ—Ä–≤–µ—Ä (–∏–ª–∏ –¥–æ–±–∞–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ –ø—Ä–∏ –æ—à–∏–±–∫–µ)
            const sent = await sendPrizeToServer(prize);
            
            // –ï—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä, –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
            if (sent) {
                setTimeout(() => {
                    fetchGlobalPrizes();
                }, 500);
            }
            
            const modalPrizeIcon = document.getElementById('modalPrizeIcon');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∏–∫–æ–Ω–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
            const iconStr = String(prize.icon || '');
            if (iconStr.toLowerCase().includes('.png') || iconStr.toLowerCase().includes('.jpg') || iconStr.toLowerCase().includes('.jpeg')) {
                const img = document.createElement('img');
                img.src = prize.icon;
                img.alt = prize.name;
                img.style.width = '120px';
                img.style.height = '120px';
                img.style.objectFit = 'contain';
                img.onerror = function() {
                    console.error('Failed to load modal prize image:', this.src);
                    modalPrizeIcon.textContent = prize.name || '?';
                };
                modalPrizeIcon.innerHTML = '';
                modalPrizeIcon.appendChild(img);
            } else {
                modalPrizeIcon.textContent = prize.icon || '?';
            }
            
            document.getElementById('modalPrizeName').textContent = prize.name;
            document.getElementById('modalPrizeValue').innerHTML = formatPrice(prize.value);
            document.getElementById('prizeModal').classList.add('active');
            
            // –ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–û—Ç–∫—Ä—ã—Ç—å" —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–µ—Ç–∞–ª–µ–π –∫–æ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            const openBtn = document.getElementById('openBtn');
            if (openBtn) {
                openBtn.classList.remove('show');
                openBtn.style.display = 'none';
                openBtn.style.visibility = 'hidden';
                openBtn.style.opacity = '0';
                openBtn.style.pointerEvents = 'none';
                openBtn.style.cssText += 'display: none !important; visibility: hidden !important; opacity: 0 !important; pointer-events: none !important;';
            }
        }

        function closePrizeModal() {
            document.getElementById('prizeModal').classList.remove('active');
            document.querySelectorAll('.prize-item').forEach(item => {
                item.classList.remove('win');
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–û—Ç–∫—Ä—ã—Ç—å" –æ–±—Ä–∞—Ç–Ω–æ –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            const openBtn = document.getElementById('openBtn');
            const detailPage = document.getElementById('caseDetailPage');
            const detailIcon = document.getElementById('detailIcon');
            
            if (openBtn && detailPage && detailPage.classList.contains('active')) {
                openBtn.disabled = false;
                openBtn.classList.add('show');
                openBtn.style.cssText = 'display: flex !important; visibility: visible !important; opacity: 1 !important;';
                openBtn.innerHTML = '–û—Ç–∫—Ä—ã—Ç—å <span>üöÄ</span>';
            }
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–∫–æ–Ω–∫—É –∫–µ–π—Å–∞ –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            if (detailIcon && currentCase) {
                if (currentCase.icon.includes('.jpg') || currentCase.icon.includes('.png') || currentCase.icon.includes('.jpeg')) {
                    const imgPath = currentCase.icon;
                    detailIcon.innerHTML = '';
                    const img = document.createElement('img');
                    img.src = imgPath;
                    img.alt = 'Case';
                    img.style.width = '100%';
                    img.style.maxWidth = '300px';
                    img.style.height = 'auto';
                    img.style.objectFit = 'contain';
                    img.style.display = 'block';
                    img.onload = function() {
                        console.log('Image loaded successfully:', this.src);
                    };
                    img.onerror = function() {
                        console.error('Failed to load detail image:', this.src);
                        // –ü–æ–ø—Ä–æ–±—É–µ–º –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å –ø—É—Ç—å
                        try {
                            const decodedPath = decodeURIComponent(imgPath);
                            if (decodedPath !== imgPath) {
                                this.src = decodedPath;
                            } else {
                                detailIcon.textContent = 'üîê';
                            }
                        } catch(e) {
                            detailIcon.textContent = 'üîê';
                        }
                    };
                    detailIcon.appendChild(img);
                } else {
                    detailIcon.textContent = currentCase.icon || 'üîê';
                }
                detailIcon.style.display = 'flex';
            }
            
            if (tg) {
                tg.HapticFeedback.impactOccurred('light');
            }
        }

        function openNextCase() {
            closePrizeModal();
            if (tg) {
                tg.HapticFeedback.impactOccurred('medium');
            }
        }
        
        window.openNextCase = openNextCase;

        document.querySelector('.subscribe-btn').addEventListener('click', () => {
            if (tg) {
                tg.openTelegramLink('https://t.me/YourChannel');
                tg.HapticFeedback.impactOccurred('medium');
            } else {
                window.open('https://t.me/YourChannel', '_blank');
            }
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "+" –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –±–∞–ª–∞–Ω—Å–µ - –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ initTopUpHandlers

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è
        function updateProfileInfo() {
            const user = tg?.initDataUnsafe?.user;
            const profileUsername = document.getElementById('profileUsername');
            const profileAvatar = document.getElementById('profileAvatarImg');
            const profileAvatarContainer = document.getElementById('profileAvatar');
            
            if (user) {
                if (profileUsername) {
                    profileUsername.textContent = user.first_name || user.username || 'User';
                }
                
                if (profileAvatarContainer) {
                    if (user.photo_url) {
                        // –ï—Å–ª–∏ –µ—Å—Ç—å —Ñ–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è, —Å–æ–∑–¥–∞–µ–º –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ–º img —ç–ª–µ–º–µ–Ω—Ç
                        if (!profileAvatar) {
                            const img = document.createElement('img');
                            img.id = 'profileAvatarImg';
                            img.alt = 'Avatar';
                            img.style.width = '100%';
                            img.style.height = '100%';
                            img.style.objectFit = 'cover';
                            img.style.borderRadius = '50%';
                            profileAvatarContainer.appendChild(img);
                        }
                        const img = profileAvatar || document.getElementById('profileAvatarImg');
                        if (img) {
                            img.src = user.photo_url;
                            img.style.display = 'block';
                            img.onerror = function() {
                                // –ï—Å–ª–∏ —Ñ–æ—Ç–æ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–º–æ–¥–∑–∏
                                this.style.display = 'none';
                                if (!profileAvatarContainer.querySelector('span')) {
                                    const fallback = document.createElement('span');
                                    fallback.textContent = 'üë§';
                                    fallback.style.fontSize = '60px';
                                    profileAvatarContainer.appendChild(fallback);
                                }
                            };
                        }
            } else {
                        // –ï—Å–ª–∏ —Ñ–æ—Ç–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–º–æ–¥–∑–∏
                        profileAvatarContainer.innerHTML = '';
                        const fallback = document.createElement('span');
                        fallback.textContent = 'üë§';
                        fallback.style.fontSize = '60px';
                        profileAvatarContainer.appendChild(fallback);
                    }
                }
            }
        }
        
        // –¢–∞–∫–∂–µ –æ–±–Ω–æ–≤–ª—è–µ–º –∞–≤–∞—Ç–∞—Ä–∫—É –≤ —à–∞–ø–∫–µ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è
        updateProfileInfo();
        updateHeaderAvatar();
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
        function updateInventory() {
            const inventoryGrid = document.getElementById('inventoryGrid');
            const inventoryCount = document.getElementById('inventoryCount');
            
            if (!inventoryGrid) return;
            
            inventoryGrid.innerHTML = '';
            
            if (inventoryCount) {
                inventoryCount.textContent = userInventory.length;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–∞–∫—Å–∏–º—É–º 9 –ø—Ä–µ–¥–º–µ—Ç–æ–≤ (3x3), + —Å–ª–æ—Ç –¥–ª—è –ø–µ—Ä–µ–ª–∏—Å—Ç—ã–≤–∞–Ω–∏—è
            const itemsToShow = userInventory.slice(0, 8);
            
            itemsToShow.forEach(item => {
                const slot = document.createElement('div');
                slot.className = 'inventory-slot has-item';
                
                const iconStr = String(item.icon || '');
                if (iconStr.toLowerCase().includes('.png') || iconStr.toLowerCase().includes('.jpg') || iconStr.toLowerCase().includes('.jpeg')) {
                    const img = document.createElement('img');
                    img.src = item.icon;
                    img.alt = item.name;
                    img.onerror = function() {
                        slot.innerHTML = '<span class="empty-icon">üéÅ</span>';
                    };
                    slot.appendChild(img);
                } else {
                    slot.innerHTML = `<span class="empty-icon">${item.icon || 'üéÅ'}</span>`;
                }
                
                const valueBadge = document.createElement('div');
                valueBadge.className = 'item-value';
                valueBadge.innerHTML = formatPrice(item.value);
                slot.appendChild(valueBadge);
                
                slot.addEventListener('click', () => {
                    showInventoryItemModal(item);
                });
                
                inventoryGrid.appendChild(slot);
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Å—Ç—ã–µ —Å–ª–æ—Ç—ã –∏–ª–∏ —Å–ª–æ—Ç –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            const remaining = userInventory.length - itemsToShow.length;
            const slotsNeeded = 9 - itemsToShow.length;
            
            for (let i = 0; i < slotsNeeded; i++) {
                const slot = document.createElement('div');
                slot.className = 'inventory-slot';
                
                if (i === slotsNeeded - 1 && remaining > 0) {
                    slot.innerHTML = '<span class="next-icon">‚Üí</span>';
                    slot.addEventListener('click', () => {
            if (tg) {
                            tg.showAlert('–°–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
                        }
                    });
                } else {
                    slot.innerHTML = '<span class="empty-icon">üéÅ</span>';
                }
                
                inventoryGrid.appendChild(slot);
            }
        }
        
        // –ü—Ä–æ–¥–∞–∂–∞ –≤—Å–µ—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤
        function sellAllItems() {
            if (userInventory.length === 0) {
                if (tg) {
                    tg.showAlert('–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç');
                } else {
                    alert('–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç');
                }
                return;
            }
            
            const totalValue = userInventory.reduce((sum, item) => sum + item.value, 0);
            
            if (tg) {
                tg.showConfirm(`–ü—Ä–æ–¥–∞—Ç—å –≤—Å–µ –ø—Ä–µ–¥–º–µ—Ç—ã –∑–∞ ${formatPrice(totalValue)}?`, (confirmed) => {
                    if (confirmed) {
                        if (changeBalance(totalValue, 'sellAll')) {
                            userInventory = [];
                            saveInventory(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –±–∞–ª–∞–Ω—Å –ª–æ–∫–∞–ª—å–Ω–æ
                            saveUserData(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                            updateInventory();
                            tg.HapticFeedback.notificationOccurred('success');
                        }
                    }
                });
            } else {
                if (confirm(`–ü—Ä–æ–¥–∞—Ç—å –≤—Å–µ –ø—Ä–µ–¥–º–µ—Ç—ã –∑–∞ ${totalValue.toFixed(2)}?`)) {
                    if (changeBalance(totalValue, 'sellAll')) {
                        userInventory = [];
                        saveInventory(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –±–∞–ª–∞–Ω—Å –ª–æ–∫–∞–ª—å–Ω–æ
                        saveUserData(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                        updateInventory();
                    }
                }
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ç–∞–±–æ–≤
        function initTabs() {
            try {
                const tabs = document.querySelectorAll('.tab');
                if (tabs.length > 0) {
                    console.log(`‚úÖ –ù–∞–π–¥–µ–Ω–æ ${tabs.length} —Ç–∞–±–æ–≤`);
                    tabs.forEach(tab => {
                        const newTab = tab.cloneNode(true);
                        tab.parentNode.replaceChild(newTab, tab);
                        
                        newTab.addEventListener('click', function(e) {
                            e.preventDefault();
                            e.stopPropagation();
                            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                            newTab.classList.add('active');
                            currentTab = newTab.dataset.tab;
                            console.log('–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω —Ç–∞–±:', currentTab);
                        });
                    });
                }
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–∞–±–æ–≤:', error);
            }
        }
        
        // –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ–ø–µ—Ä—å —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞ - –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è
        function openTopUpModal() {
            window.openTopUpModal = openTopUpModal; // –î–µ–ª–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω–æ–π
            console.log('openTopUpModal –≤—ã–∑–≤–∞–Ω–∞');
            const modal = document.getElementById('topUpModal');
            console.log('–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞–π–¥–µ–Ω–æ:', modal);
            if (modal) {
                modal.classList.add('active');
                modal.style.display = 'flex';
                modal.style.zIndex = '10000';
                console.log('–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ—Ç–∫—Ä—ã—Ç–æ');
                if (tg) {
                    tg.HapticFeedback.impactOccurred('medium');
                }
            } else {
                console.error('–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ topUpModal –Ω–µ –Ω–∞–π–¥–µ–Ω–æ!');
            }
        }

        function closeTopUpModal() {
            const modal = document.getElementById('topUpModal');
            if (modal) {
                modal.classList.remove('active');
                modal.style.display = 'none';
                if (tg) {
                tg.HapticFeedback.impactOccurred('light');
                }
            }
        }
        
        function openWithdrawModal() {
            window.openWithdrawModal = openWithdrawModal; // –î–µ–ª–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω–æ–π
            console.log('openWithdrawModal –≤—ã–∑–≤–∞–Ω–∞');
            const modal = document.getElementById('withdrawModal');
            console.log('–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–≤–æ–¥–∞ –Ω–∞–π–¥–µ–Ω–æ:', modal);
            if (modal) {
                modal.classList.add('active');
                modal.style.display = 'flex';
                modal.style.zIndex = '10000';
                console.log('–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–≤–æ–¥–∞ –æ—Ç–∫—Ä—ã—Ç–æ');
                if (tg) {
                    tg.HapticFeedback.impactOccurred('medium');
                }
            } else {
                console.error('–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ withdrawModal –Ω–µ –Ω–∞–π–¥–µ–Ω–æ!');
            }
        }

        function closeWithdrawModal() {
            const modal = document.getElementById('withdrawModal');
            if (modal) {
                modal.classList.remove('active');
                modal.style.display = 'none';
                if (tg) {
                    tg.HapticFeedback.impactOccurred('light');
                }
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
        function initTopUpHandlers() {
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ü–æ–ø–æ–ª–Ω–∏—Ç—å" - –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ —Å–ø–æ—Å–æ–±–∞
            // –ù–ï —Ç—Ä–æ–≥–∞–µ–º –∫–Ω–æ–ø–∫—É –≤ –ø—Ä–æ—Ñ–∏–ª–µ, –æ–Ω–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤ initProfileHandlers
            const topUpBtn = document.getElementById('topUpBtn');
            if (topUpBtn && !topUpBtn.hasAttribute('data-handler-set')) {
                console.log('–ù–∞–π–¥–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ topUpBtn, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞');
                
                // –ü–æ–º–µ—á–∞–µ–º, —á—Ç–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
                topUpBtn.setAttribute('data-handler-set', 'true');
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ–≥–æ –µ—â–µ –Ω–µ—Ç
                topUpBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    e.stopImmediatePropagation();
                    console.log('‚úÖ –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ –ü–æ–ø–æ–ª–Ω–∏—Ç—å - –æ—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ');
                    if (typeof openTopUpModal === 'function') {
                        openTopUpModal();
                    } else {
                        console.error('–§—É–Ω–∫—Ü–∏—è openTopUpModal –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                    }
                    return false;
                }, { capture: true, once: false });
                
                console.log('–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
            } else if (!topUpBtn) {
                console.warn('–ö–Ω–æ–ø–∫–∞ topUpBtn –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –æ–Ω–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø—Ä–æ—Ñ–∏–ª—è)');
            }

            // –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram Wallet
            const telegramWalletBtn = document.getElementById('telegramWalletBtn');
            if (telegramWalletBtn) {
                telegramWalletBtn.addEventListener('click', async (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    closeTopUpModal();
                    
                    try {
                        const userId = getUserId();
                        if (!userId) {
                            throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                        }

                        // –û—Ç–∫—Ä—ã–≤–∞–µ–º –±–æ—Ç–∞ –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ Telegram Wallet
                        // –°—É–º–º–∞ –±—É–¥–µ—Ç –≤—ã–±—Ä–∞–Ω–∞ –≤ –±–æ—Ç–µ
                        const botUsername = 'Znakomstva13_bot';
                        const botUrl = `https://t.me/${botUsername}?start=wallet_${userId}`;
                        
                        if (tg) {
                            if (tg.openTelegramLink) {
                                tg.openTelegramLink(botUrl);
                            } else {
                                tg.openLink(botUrl);
                            }
                            tg.HapticFeedback.impactOccurred('medium');
                            
                            setTimeout(() => {
                                if (tg.showAlert) {
                                    tg.showAlert('–û—Ç–ø—Ä–∞–≤—å—Ç–µ –±–æ—Ç—É /pay –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ Telegram Wallet');
                                }
                            }, 500);
                        } else {
                            window.open(botUrl, '_blank');
                            alert('–ë–æ—Ç –æ—Ç–∫—Ä—ã—Ç. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –±–æ—Ç—É /pay –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ Telegram Wallet.');
                        }
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞:', error);
                        if (tg && tg.showAlert) {
                            tg.showAlert('–û—à–∏–±–∫–∞: ' + error.message);
                        }
                    }
                });
            }

            // –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞
            const telegramBotBtn = document.getElementById('telegramBotBtn');
            if (telegramBotBtn) {
                telegramBotBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    closeTopUpModal();
                    
                    const botUsername = 'Znakomstva13_bot';
                    const userId = getUserId();
                    const botUrl = `https://t.me/${botUsername}?start=cryptobot_${userId}`;
                    
                    console.log('–û—Ç–∫—Ä—ã–≤–∞–µ–º –±–æ—Ç–∞ –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ CryptoBot:', botUrl, 'User ID:', userId);
                    
                    if (tg) {
                        if (tg.openTelegramLink) {
                            tg.openTelegramLink(botUrl);
                        } else {
                            tg.openLink(botUrl);
                        }
                        tg.HapticFeedback.impactOccurred('medium');
                        
                        setTimeout(() => {
                            if (tg.showAlert) {
                                tg.showAlert('–û—Ç–ø—Ä–∞–≤—å—Ç–µ –±–æ—Ç—É /pay –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ CryptoBot');
                            }
                        }, 500);
                    } else {
                        window.open(botUrl, '_blank');
                        alert('–ë–æ—Ç –æ—Ç–∫—Ä—ã—Ç. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –±–æ—Ç—É /pay –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ CryptoBot.');
                    }
                });
            }
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ "+" —Ä—è–¥–æ–º —Å –±–∞–ª–∞–Ω—Å–æ–º
            // –û—Å–Ω–æ–≤–Ω–æ–π –±–∞–ª–∞–Ω—Å –≤ —Ö–µ–¥–µ—Ä–µ
            const mainBalancePlusBtn = document.querySelector('.balance-section button');
            if (mainBalancePlusBtn) {
                // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
                const newMainBtn = mainBalancePlusBtn.cloneNode(true);
                mainBalancePlusBtn.parentNode.replaceChild(newMainBtn, mainBalancePlusBtn);
                
                newMainBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    e.stopImmediatePropagation();
                    console.log('–ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ + –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –±–∞–ª–∞–Ω—Å–µ');
                    openTopUpModal();
                    return false;
                }, true);
            }
            
            // –ë–∞–ª–∞–Ω—Å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∫—Ä–∞—à–∞
            const crashBalancePlusBtn = document.getElementById('crashBalance')?.parentElement?.querySelector('button');
            if (crashBalancePlusBtn) {
                // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
                const newCrashBtn = crashBalancePlusBtn.cloneNode(true);
                crashBalancePlusBtn.parentNode.replaceChild(newCrashBtn, crashBalancePlusBtn);
                
                newCrashBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    e.stopImmediatePropagation();
                    console.log('–ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ + –≤ –±–∞–ª–∞–Ω—Å–µ –∫—Ä–∞—à–∞');
                    openTopUpModal();
                    return false;
                }, true);
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ - –¥–µ–ª–∞–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ø—ã—Ç–æ–∫
        function initTopUpHandlersWithRetry(retries = 3) {
            const topUpBtn = document.getElementById('topUpBtn');
            if (!topUpBtn && retries > 0) {
                setTimeout(() => initTopUpHandlersWithRetry(retries - 1), 100);
                return;
            }
            
            if (topUpBtn) {
                initTopUpHandlers();
                console.log('–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã');
            } else {
                console.error('–ö–Ω–æ–ø–∫–∞ topUpBtn –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –ø–æ—Å–ª–µ –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫');
            }
        }
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                setTimeout(initTopUpHandlersWithRetry, 100);
            });
        } else {
            setTimeout(initTopUpHandlersWithRetry, 100);
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –≤—ã–≤–æ–¥–∞
        function initWithdrawHandlers() {
            const withdrawBtn = document.getElementById('withdrawBtn');
            if (withdrawBtn) {
                const newWithdrawBtn = withdrawBtn.cloneNode(true);
                withdrawBtn.parentNode.replaceChild(newWithdrawBtn, withdrawBtn);
                newWithdrawBtn.onclick = null;
                newWithdrawBtn.removeEventListener('click', () => {});
                newWithdrawBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    e.stopImmediatePropagation();
                    console.log('–ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ –í—ã–≤–µ—Å—Ç–∏ - –æ—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ');
                    openWithdrawModal();
                    return false;
                }, true);
            }
            
            // –í—ã–≤–æ–¥ —á–µ—Ä–µ–∑ Telegram Wallet
            const withdrawTelegramWalletBtn = document.getElementById('withdrawTelegramWalletBtn');
            if (withdrawTelegramWalletBtn) {
                withdrawTelegramWalletBtn.addEventListener('click', async (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    closeWithdrawModal();
                    
                    try {
                        const userId = getUserId();
                        if (!userId) {
                            throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                        }
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–ª–∞–Ω—Å
                        if (_balance <= 0) {
                            if (tg && tg.showAlert) {
                                tg.showAlert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –≤—ã–≤–æ–¥–∞');
                            } else {
                                alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –≤—ã–≤–æ–¥–∞');
                            }
                            return;
                        }
                        
                        // –û—Ç–∫—Ä—ã–≤–∞–µ–º –±–æ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞ —á–µ—Ä–µ–∑ Telegram Wallet
                        const botUsername = 'Znakomstva13_bot';
                        const botUrl = `https://t.me/${botUsername}?start=withdraw_wallet_${userId}`;
                        
                        if (tg) {
                            if (tg.openTelegramLink) {
                                tg.openTelegramLink(botUrl);
                            } else {
                                tg.openLink(botUrl);
                            }
                            tg.HapticFeedback.impactOccurred('medium');
                            
                            setTimeout(() => {
                                if (tg.showAlert) {
                                    tg.showAlert('–û—Ç–ø—Ä–∞–≤—å—Ç–µ –±–æ—Ç—É /withdraw –¥–ª—è –≤—ã–≤–æ–¥–∞ —á–µ—Ä–µ–∑ Telegram Wallet');
                                }
                            }, 500);
                        } else {
                            window.open(botUrl, '_blank');
                            alert('–ë–æ—Ç –æ—Ç–∫—Ä—ã—Ç. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –±–æ—Ç—É /withdraw –¥–ª—è –≤—ã–≤–æ–¥–∞ —á–µ—Ä–µ–∑ Telegram Wallet.');
                        }
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞:', error);
                        if (tg && tg.showAlert) {
                            tg.showAlert('–û—à–∏–±–∫–∞: ' + error.message);
                        }
                    }
                });
            }
            
            // –í—ã–≤–æ–¥ —á–µ—Ä–µ–∑ CryptoBot
            const withdrawTelegramBotBtn = document.getElementById('withdrawTelegramBotBtn');
            if (withdrawTelegramBotBtn) {
                withdrawTelegramBotBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    closeWithdrawModal();
                    
                    const botUsername = 'Znakomstva13_bot';
                    const userId = getUserId();
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–ª–∞–Ω—Å
                    if (_balance <= 0) {
                        if (tg && tg.showAlert) {
                            tg.showAlert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –≤—ã–≤–æ–¥–∞');
                        } else {
                            alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –≤—ã–≤–æ–¥–∞');
                        }
                        return;
                    }
                    
                    const botUrl = `https://t.me/${botUsername}?start=withdraw_cryptobot_${userId}`;
                    
                    console.log('–û—Ç–∫—Ä—ã–≤–∞–µ–º –±–æ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞ —á–µ—Ä–µ–∑ CryptoBot:', botUrl, 'User ID:', userId);
                    
                    if (tg) {
                        if (tg.openTelegramLink) {
                            tg.openTelegramLink(botUrl);
                        } else {
                            tg.openLink(botUrl);
                        }
                        tg.HapticFeedback.impactOccurred('medium');
                        
                        setTimeout(() => {
                            if (tg.showAlert) {
                                tg.showAlert('–û—Ç–ø—Ä–∞–≤—å—Ç–µ –±–æ—Ç—É /withdraw –¥–ª—è –≤—ã–≤–æ–¥–∞ —á–µ—Ä–µ–∑ CryptoBot');
                            }
                        }, 500);
                    } else {
                        window.open(botUrl, '_blank');
                        alert('–ë–æ—Ç –æ—Ç–∫—Ä—ã—Ç. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –±–æ—Ç—É /withdraw –¥–ª—è –≤—ã–≤–æ–¥–∞ —á–µ—Ä–µ–∑ CryptoBot.');
                    }
                });
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤—ã–≤–æ–¥–∞
        function initWithdrawHandlersWithRetry(retries = 3) {
            const withdrawBtn = document.getElementById('withdrawBtn');
            if (!withdrawBtn && retries > 0) {
                setTimeout(() => initWithdrawHandlersWithRetry(retries - 1), 100);
                return;
            }
            
            if (withdrawBtn) {
                initWithdrawHandlers();
                console.log('–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤—ã–≤–æ–¥–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã');
            }
        }
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                setTimeout(initWithdrawHandlersWithRetry, 150);
            });
        } else {
            setTimeout(initWithdrawHandlersWithRetry, 150);
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ü—Ä–æ–¥–∞—Ç—å –≤—Å–µ"
        const sellAllBtn = document.getElementById('sellAllBtn');
        if (sellAllBtn) {
            sellAllBtn.addEventListener('click', sellAllItems);
        }
        
        // –¢–µ–∫—É—â–∏–π –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç –∏–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
        let selectedInventoryItem = null;
        
        // –ü–æ–∫–∞–∑ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–µ–¥–º–µ—Ç–∞ –∏–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
        function showInventoryItemModal(item) {
            selectedInventoryItem = item;
            const modal = document.getElementById('inventoryItemModal');
            const modalIcon = document.getElementById('inventoryModalIcon');
            const modalName = document.getElementById('inventoryModalName');
            const modalPrice = document.getElementById('inventoryModalPrice');
            
            if (!modal || !modalIcon || !modalName || !modalPrice) return;
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ
            modalName.textContent = item.name;
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–µ–Ω—É
            modalPrice.innerHTML = formatPrice(item.value);
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–∫–æ–Ω–∫—É
            modalIcon.innerHTML = '';
            const iconStr = String(item.icon || '');
            if (iconStr.toLowerCase().includes('.png') || iconStr.toLowerCase().includes('.jpg') || iconStr.toLowerCase().includes('.jpeg')) {
                const img = document.createElement('img');
                img.src = item.icon;
                img.alt = item.name;
                img.onerror = function() {
                    modalIcon.innerHTML = '<span style="font-size: 80px;">üéÅ</span>';
                };
                modalIcon.appendChild(img);
            } else {
                modalIcon.innerHTML = `<span style="font-size: 80px;">${item.icon || 'üéÅ'}</span>`;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            modal.classList.add('active');
            
            if (tg) {
                tg.HapticFeedback.impactOccurred('light');
            }
        }
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–µ–¥–º–µ—Ç–∞ –∏–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
        function closeInventoryModal() {
            const modal = document.getElementById('inventoryItemModal');
            if (modal) {
                modal.classList.remove('active');
            }
            selectedInventoryItem = null;
            
            if (tg) {
                tg.HapticFeedback.impactOccurred('light');
            }
        }
        
        window.closeInventoryModal = closeInventoryModal;

        // –ò–ì–†–ê –ú–ò–ù–´
        // minesGameState —É–∂–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –≤ –Ω–∞—á–∞–ª–µ —Å–∫—Ä–∏–ø—Ç–∞
        
        function initMinesGame() {
            const grid = document.getElementById('minesGrid');
            if (!grid) return;
            
            grid.innerHTML = '';
            minesGameState.grid = [];
            minesGameState.opened = [];
            minesGameState.gameActive = false;
            minesGameState.currentMultiplier = 1.0;
            
            for (let i = 0; i < minesGameState.gridSize; i++) {
                const cell = document.createElement('div');
                cell.className = 'mines-cell';
                cell.dataset.index = i;
                cell.textContent = '?';
                grid.appendChild(cell);
                minesGameState.grid.push({ isMine: false, revealed: false, index: i });
            }
            
            document.getElementById('minesOpenedCount').textContent = '0';
            document.getElementById('minesMultiplier').textContent = 'x1.00';
            document.getElementById('minesWinnings').textContent = '0.00';
            document.getElementById('minesTotalCount').textContent = minesGameState.minesCount;
            document.getElementById('minesCashOutBtn').disabled = true;
            document.getElementById('minesStartBtn').textContent = '–ù–∞—á–∞—Ç—å –∏–≥—Ä—É';
            document.getElementById('minesStartBtn').disabled = false;
            document.getElementById('minesBetAmount').disabled = false;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É –≤—ã–±–æ—Ä–∞ –º–∏–Ω
            document.querySelectorAll('.mines-count-btn').forEach(btn => {
                if (parseInt(btn.dataset.count) === minesGameState.minesCount) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            // –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–ª–µ—Ç–æ–∫
            setupMinesCellHandlers();
            
            // –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
            const minesStartBtn = document.getElementById('minesStartBtn');
            if (minesStartBtn) {
                const newBtn = minesStartBtn.cloneNode(true);
                minesStartBtn.parentNode.replaceChild(newBtn, minesStartBtn);
                newBtn.onclick = startMinesGame;
                newBtn.addEventListener('click', startMinesGame);
                window.handleMinesStart = function(e) {
                    if (e) {
                        e.preventDefault();
                        e.stopPropagation();
                    }
                    startMinesGame();
                };
            }
            
            const minesCashOutBtn = document.getElementById('minesCashOutBtn');
            if (minesCashOutBtn) {
                const newBtn = minesCashOutBtn.cloneNode(true);
                minesCashOutBtn.parentNode.replaceChild(newBtn, minesCashOutBtn);
                newBtn.addEventListener('click', cashOutMines);
            }
            
            // –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ –≤—ã–±–æ—Ä–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –º–∏–Ω
            document.querySelectorAll('.mines-count-btn').forEach(btn => {
                const newBtn = btn.cloneNode(true);
                btn.parentNode.replaceChild(newBtn, btn);
                newBtn.addEventListener('click', function() {
                    minesGameState.minesCount = parseInt(newBtn.dataset.count);
                    document.querySelectorAll('.mines-count-btn').forEach(b => b.classList.remove('active'));
                    newBtn.classList.add('active');
                    updateMinesMultiplier();
                });
            });
        }
        
        function setupMinesCellHandlers() {
            const minesGrid = document.getElementById('minesGrid');
            if (!minesGrid) return;
            
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ
            const cells = minesGrid.querySelectorAll('.mines-cell');
            cells.forEach(cell => {
                const newCell = cell.cloneNode(true);
                cell.parentNode.replaceChild(newCell, cell);
                newCell.addEventListener('click', function() {
                    if (minesGameState.gameActive) {
                        const index = parseInt(this.dataset.index);
                        openMinesCell(index);
                    }
                });
            });
        }

        function startMinesGame() {
            window.startMinesGame = startMinesGame; // –î–µ–ª–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω–æ–π
            if (minesGameState.gameActive) return;
            
            minesGameState.betAmount = parseFloat(document.getElementById('minesBetAmount').value) || 0.1;
            
            if (_balance < minesGameState.betAmount) {
                if (tg) {
                    tg.showAlert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!');
                } else {
                    alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!');
                }
                return;
            }
            
            if (!changeBalance(-minesGameState.betAmount, 'minesBet')) {
                return;
            }
            saveInventory();
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –º–∏–Ω—ã
            minesGameState.mines = [];
            minesGameState.opened = [];
            minesGameState.currentMultiplier = 1.0;
            minesGameState.gameActive = true;
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ –∫–ª–µ—Ç–∫–∏
            minesGameState.grid.forEach(cell => {
                cell.isMine = false;
                cell.revealed = false;
            });
            
            const gridSize = minesGameState.gridSize;
            while (minesGameState.mines.length < minesGameState.minesCount) {
                const randomIndex = Math.floor(Math.random() * gridSize);
                if (!minesGameState.mines.includes(randomIndex)) {
                    minesGameState.mines.push(randomIndex);
                    minesGameState.grid[randomIndex].isMine = true;
                }
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–Ω–æ–∂–∏—Ç–µ–ª—è –≤ –Ω–∞—á–∞–ª–µ –∏–≥—Ä—ã
            updateMinesMultiplier();
            
            document.getElementById('minesStartBtn').textContent = '–ò–≥—Ä–∞ –∏–¥–µ—Ç...';
            document.getElementById('minesStartBtn').disabled = true;
            document.getElementById('minesBetAmount').disabled = true;
            document.getElementById('minesCashOutBtn').disabled = false;
            
            // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –º–∏–Ω –≤–æ –≤—Ä–µ–º—è –∏–≥—Ä—ã
            document.querySelectorAll('.mines-count-btn').forEach(btn => {
                btn.disabled = true;
                btn.style.opacity = '0.5';
            });
            
            updateMinesDisplay();
            setupMinesCellHandlers();
        }

        function openMinesCell(index) {
            if (!minesGameState.gameActive) return;
            if (minesGameState.opened.includes(index)) return;
            
            const cell = minesGameState.grid[index];
            if (cell.isMine) {
                // –ü—Ä–æ–∏–≥—Ä—ã—à
                endMinesGame(false);
                revealAllMines();
                if (tg) {
                    tg.showAlert('–ú–ò–ù–ê! –í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏!');
                    tg.HapticFeedback.notificationOccurred('error');
                } else {
                    alert('–ú–ò–ù–ê! –í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏!');
                }
                return;
            }
            
            minesGameState.opened.push(index);
            cell.revealed = true;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –º–Ω–æ–∂–∏—Ç–µ–ª—å (—á–µ–º –±–æ–ª—å—à–µ –º–∏–Ω, —Ç–µ–º –±–æ–ª—å—à–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ)
            const openedCount = minesGameState.opened.length;
            let multiplierIncrease;
            if (minesGameState.minesCount === 3) {
                multiplierIncrease = 0.15; // +0.15 –∑–∞ –∫–ª–µ—Ç–∫—É –¥–ª—è 3 –º–∏–Ω
            } else if (minesGameState.minesCount === 5) {
                multiplierIncrease = 0.2; // +0.2 –∑–∞ –∫–ª–µ—Ç–∫—É –¥–ª—è 5 –º–∏–Ω
            } else if (minesGameState.minesCount === 10) {
                multiplierIncrease = 0.3; // +0.3 –∑–∞ –∫–ª–µ—Ç–∫—É –¥–ª—è 10 –º–∏–Ω
            } else {
                multiplierIncrease = 0.1;
            }
            minesGameState.currentMultiplier = 1.0 + (openedCount * multiplierIncrease);
            
            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            updateMinesDisplay();
            
            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º –º–Ω–æ–∂–∏—Ç–µ–ª—å
            const multiplierEl = document.getElementById('minesMultiplier');
            const winningsEl = document.getElementById('minesWinnings');
            if (multiplierEl) {
                multiplierEl.textContent = `x${minesGameState.currentMultiplier.toFixed(2)}`;
            }
            if (winningsEl) {
                const winnings = minesGameState.betAmount * minesGameState.currentMultiplier;
                winningsEl.textContent = winnings.toFixed(2);
            }
            
            if (tg) {
                tg.HapticFeedback.impactOccurred('light');
            }
        }

        function cashOutMines() {
            if (!minesGameState.gameActive) return;
            
            const winnings = minesGameState.betAmount * minesGameState.currentMultiplier;
            changeBalance(winnings, 'minesWin');
            saveInventory();
            
            endMinesGame(true);
            
            if (tg) {
                tg.showAlert(`–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${winnings.toFixed(2)}!`);
                tg.HapticFeedback.notificationOccurred('success');
            } else {
                alert(`–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${winnings.toFixed(2)}!`);
            }
        }

        function endMinesGame(won) {
            minesGameState.gameActive = false;
            document.getElementById('minesCashOutBtn').disabled = true;
            document.getElementById('minesStartBtn').textContent = '–ù–æ–≤–∞—è –∏–≥—Ä–∞';
            document.getElementById('minesStartBtn').disabled = false;
            document.getElementById('minesBetAmount').disabled = false;
            
            // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –º–∏–Ω
            document.querySelectorAll('.mines-count-btn').forEach(btn => {
                btn.disabled = false;
                btn.style.opacity = '1';
            });
            
            if (!won) {
                revealAllMines();
            }
        }

        function revealAllMines() {
            minesGameState.mines.forEach(mineIndex => {
                const cellElement = document.querySelector(`.mines-cell[data-index="${mineIndex}"]`);
                if (cellElement) {
                    cellElement.classList.add('mine');
                    cellElement.textContent = 'üí£';
                }
            });
        }

        function updateMinesDisplay() {
            const cells = document.querySelectorAll('.mines-cell');
            cells.forEach((cellElement, index) => {
                const cell = minesGameState.grid[index];
                if (minesGameState.opened.includes(index)) {
                    cellElement.classList.add('opened', 'safe');
                    cellElement.textContent = '‚úì';
                } else {
                    cellElement.classList.remove('opened', 'safe', 'mine');
                    if (!minesGameState.gameActive) {
                        cellElement.textContent = '?';
                    } else {
                        cellElement.textContent = '?';
                    }
                }
            });
            
            document.getElementById('minesOpenedCount').textContent = minesGameState.opened.length;
        }

        function updateMinesMultiplier() {
            const multiplierEl = document.getElementById('minesMultiplier');
            const winningsEl = document.getElementById('minesWinnings');
            
            if (multiplierEl) {
                multiplierEl.textContent = `x${minesGameState.currentMultiplier.toFixed(2)}`;
            }
            
            if (winningsEl) {
                const winnings = minesGameState.betAmount * minesGameState.currentMultiplier;
                winningsEl.textContent = winnings.toFixed(2);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', () => {
            const minesStartBtn = document.getElementById('minesStartBtn');
            const minesCashOutBtn = document.getElementById('minesCashOutBtn');
            const minesGrid = document.getElementById('minesGrid');
            
            if (minesStartBtn) {
                minesStartBtn.addEventListener('click', startMinesGame);
            }
            
            if (minesCashOutBtn) {
                minesCashOutBtn.addEventListener('click', cashOutMines);
            }
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–æ–≤ –ø–æ –∫–ª–µ—Ç–∫–∞–º (–¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π)
            if (minesGrid) {
                minesGrid.addEventListener('click', (e) => {
                    const cell = e.target.closest('.mines-cell');
                    if (cell && minesGameState.gameActive && !cell.classList.contains('opened')) {
                        const index = parseInt(cell.dataset.index);
                        if (!isNaN(index)) {
                            openMinesCell(index);
                        }
                    }
                });
            }
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ –≤—ã–±–æ—Ä–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –º–∏–Ω
            document.querySelectorAll('.mines-count-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    if (minesGameState.gameActive) {
                        if (tg) {
                            tg.showAlert('–ù–µ–ª—å–∑—è –∏–∑–º–µ–Ω–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∏–Ω –≤–æ –≤—Ä–µ–º—è –∏–≥—Ä—ã!');
                        } else {
                            alert('–ù–µ–ª—å–∑—è –∏–∑–º–µ–Ω–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∏–Ω –≤–æ –≤—Ä–µ–º—è –∏–≥—Ä—ã!');
                        }
                        return;
                    }
                    
                    document.querySelectorAll('.mines-count-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    minesGameState.minesCount = parseInt(btn.dataset.count);
                    document.getElementById('minesTotalCount').textContent = minesGameState.minesCount;
                });
            });
        });
        
        // –ò–ì–†–ê DICE
        // diceGameState —É–∂–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –≤ –Ω–∞—á–∞–ª–µ —Å–∫—Ä–∏–ø—Ç–∞
        
        function initDiceGame() {
            const thresholdSlider = document.getElementById('diceThreshold');
            const thresholdValue = document.getElementById('diceThresholdValue');
            const rollUnderBtn = document.getElementById('diceRollUnderBtn');
            const rollOverBtn = document.getElementById('diceRollOverBtn');
            const autoToggle = document.getElementById('diceAutoToggle');
            const autoStatus = document.getElementById('diceAutoStatus');
            const startBtn = document.getElementById('diceStartBtn');
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å–ª–∞–π–¥–µ—Ä–∞
            if (thresholdSlider && thresholdValue) {
                thresholdValue.textContent = diceGameState.threshold;
                thresholdSlider.value = diceGameState.threshold;
                
                // –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–ª–∞–π–¥–µ—Ä–∞
                const newSlider = thresholdSlider.cloneNode(true);
                thresholdSlider.parentNode.replaceChild(newSlider, thresholdSlider);
                
                newSlider.addEventListener('input', (e) => {
                    diceGameState.threshold = parseInt(e.target.value);
                    thresholdValue.textContent = diceGameState.threshold;
                    updateDiceMultiplier();
                });
            }
            
            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∏–ø–∞ —Å—Ç–∞–≤–∫–∏ - Roll Under
            if (rollUnderBtn) {
                const newBtn = rollUnderBtn.cloneNode(true);
                rollUnderBtn.parentNode.replaceChild(newBtn, rollUnderBtn);
                newBtn.addEventListener('click', () => {
                    diceGameState.rollType = 'under';
                    newBtn.classList.add('active');
                    const rollOver = document.getElementById('diceRollOverBtn');
                    if (rollOver) rollOver.classList.remove('active');
                    updateDiceMultiplier();
                });
            }
            
            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∏–ø–∞ —Å—Ç–∞–≤–∫–∏ - Roll Over
            if (rollOverBtn) {
                const newBtn = rollOverBtn.cloneNode(true);
                rollOverBtn.parentNode.replaceChild(newBtn, rollOverBtn);
                newBtn.addEventListener('click', () => {
                    diceGameState.rollType = 'over';
                    newBtn.classList.add('active');
                    const rollUnder = document.getElementById('diceRollUnderBtn');
                    if (rollUnder) rollUnder.classList.remove('active');
                    updateDiceMultiplier();
                });
            }
            
            // –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –∞–≤—Ç–æ-–∏–≥—Ä—ã
            if (autoToggle) {
                const newToggle = autoToggle.cloneNode(true);
                autoToggle.parentNode.replaceChild(newToggle, autoToggle);
                newToggle.checked = diceGameState.autoPlay;
                newToggle.addEventListener('change', (e) => {
                    diceGameState.autoPlay = e.target.checked;
                    if (autoStatus) autoStatus.textContent = diceGameState.autoPlay ? 'ON' : 'OFF';
                    
                    if (diceGameState.autoPlay && !diceGameState.isRolling) {
                        startDiceGame();
                    } else if (!diceGameState.autoPlay) {
                        stopAutoPlay();
                    }
                });
            }
            
            // –ö–Ω–æ–ø–∫–∞ START
            if (startBtn) {
                const newBtn = startBtn.cloneNode(true);
                startBtn.parentNode.replaceChild(newBtn, startBtn);
                const diceHandler = () => {
                    if (!diceGameState.isRolling) {
                        startDiceGame();
                    }
                };
                newBtn.onclick = diceHandler;
                newBtn.addEventListener('click', diceHandler);
                window.handleDiceStart = function(e) {
                    if (e) {
                        e.preventDefault();
                        e.stopPropagation();
                    }
                    diceHandler();
                };
            }
            
            updateDiceMultiplier();
        }

        function updateDiceMultiplier() {
            // –ú–Ω–æ–∂–∏—Ç–µ–ª—å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –≤—ã–∏–≥—Ä—ã—à–∞
            // –î–ª—è Roll Under: –º–Ω–æ–∂–∏—Ç–µ–ª—å = 99 / threshold
            // –î–ª—è Roll Over: –º–Ω–æ–∂–∏—Ç–µ–ª—å = 99 / (99 - threshold)
            let multiplier;
            if (diceGameState.rollType === 'under') {
                multiplier = 99 / diceGameState.threshold;
            } else {
                multiplier = 99 / (99 - diceGameState.threshold);
            }
            
            const multiplierEl = document.getElementById('diceMultiplier');
            if (multiplierEl) {
                multiplierEl.textContent = `x${multiplier.toFixed(2)}`;
            }
            
            const winningsEl = document.getElementById('diceWinnings');
            if (winningsEl) {
                const winnings = diceGameState.betAmount * multiplier;
                winningsEl.textContent = winnings.toFixed(2);
            }
        }

        function startDiceGame() {
            window.startDiceGame = startDiceGame; // –î–µ–ª–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω–æ–π
            if (diceGameState.isRolling) return;
            
            diceGameState.betAmount = parseFloat(document.getElementById('diceBetAmount').value) || 0.1;
            
            if (_balance < diceGameState.betAmount) {
                if (tg) {
                    tg.showAlert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!');
                } else {
                    alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!');
                }
                if (diceGameState.autoPlay) {
                    document.getElementById('diceAutoToggle').checked = false;
                    diceGameState.autoPlay = false;
                    document.getElementById('diceAutoStatus').textContent = 'OFF';
                }
                return;
            }
            
            if (!changeBalance(-diceGameState.betAmount, 'diceBet')) {
                return;
            }
            saveInventory();
            
            diceGameState.isRolling = true;
            const startBtn = document.getElementById('diceStartBtn');
            if (startBtn) {
                startBtn.disabled = true;
                startBtn.textContent = 'ROLLING...';
            }
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –±—Ä–æ—Å–∫–∞
            const resultValue = document.getElementById('diceResultValue');
            const resultText = document.getElementById('diceResultText');
            let rollCount = 0;
            const rollInterval = setInterval(() => {
                rollCount++;
                const randomValue = Math.floor(Math.random() * 100);
                if (resultValue) {
                    resultValue.textContent = randomValue;
                    resultValue.classList.remove('win', 'lose');
                }
                
                if (rollCount > 10) {
                    clearInterval(rollInterval);
                    
                    // –§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                    const finalRoll = Math.floor(Math.random() * 100);
                    
                    let won = false;
                    if (diceGameState.rollType === 'under') {
                        won = finalRoll < diceGameState.threshold;
                    } else {
                        won = finalRoll > diceGameState.threshold;
                    }
                    
                    if (resultValue) {
                        resultValue.textContent = finalRoll;
                        resultValue.classList.add(won ? 'win' : 'lose');
                    }
                    
                    if (resultText) {
                        resultText.textContent = won ? '–í–´–ò–ì–†–´–®!' : '–ü–†–û–ò–ì–†–´–®';
                        resultText.style.color = won ? '#00ff00' : '#ff0000';
                    }
                    
                    if (won) {
                        const multiplier = diceGameState.rollType === 'under' 
                            ? 99 / diceGameState.threshold 
                            : 99 / (99 - diceGameState.threshold);
                        const winnings = diceGameState.betAmount * multiplier;
                        changeBalance(winnings, 'diceWin');
                        saveInventory();
                        
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–≥—Ä—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                        saveDiceGameToServer({
                            userId: getUserId(),
                            username: getUsername(),
                            result: finalRoll,
                            threshold: diceGameState.threshold,
                            rollType: diceGameState.rollType,
                            betAmount: diceGameState.betAmount,
                            multiplier: multiplier,
                            winnings: winnings,
                            won: true
                        });
                        
                        if (tg) {
                            tg.showAlert(`–í—ã–∏–≥—Ä—ã—à ${winnings.toFixed(2)}!`);
                            tg.HapticFeedback.notificationOccurred('success');
                        }
                    } else {
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–∏–≥—Ä—ã—à–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                        saveDiceGameToServer({
                            userId: getUserId(),
                            username: getUsername(),
                            result: finalRoll,
                            threshold: diceGameState.threshold,
                            rollType: diceGameState.rollType,
                            betAmount: diceGameState.betAmount,
                            multiplier: 0,
                            winnings: 0,
                            won: false
                        });
                        
                        if (tg) {
                            tg.showAlert('–ü—Ä–æ–∏–≥—Ä—ã—à!');
                            tg.HapticFeedback.notificationOccurred('error');
                        }
                    }
                    
                    diceGameState.isRolling = false;
                    if (startBtn) {
                        startBtn.disabled = false;
                        startBtn.textContent = 'START';
                    }
                    
                    // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –∞–≤—Ç–æ-–∏–≥—Ä—É –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–∞
                    if (diceGameState.autoPlay) {
                        setTimeout(() => {
                            startDiceGame();
                        }, 1500);
                    } else {
                        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                        setTimeout(() => {
                            if (resultValue) {
                                resultValue.textContent = '?';
                                resultValue.classList.remove('win', 'lose');
                            }
                            if (resultText) {
                                resultText.textContent = '–ù–∞–∂–º–∏—Ç–µ START';
                                resultText.style.color = 'rgba(255, 255, 255, 0.8)';
                            }
                        }, 3000);
                    }
                }
            }, 50);
        }

        function stopAutoPlay() {
            diceGameState.autoPlay = false;
            diceGameState.isRolling = false;
            const startBtn = document.getElementById('diceStartBtn');
            if (startBtn) {
                startBtn.disabled = false;
                startBtn.textContent = 'START';
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∏–≥—Ä—ã Dice –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        async function saveDiceGameToServer(gameData) {
            try {
                const userId = getUserId();
                if (!userId) {
                    return;
                }
                
                const response = await fetch(`${API_BASE_URL}/dice/games`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        ...gameData,
                        userId: userId,
                        timestamp: Date.now()
                    })
                });
                
                if (!response.ok) {
                    console.log('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–≥—Ä—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä');
                }
            } catch (error) {
                console.log('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∏–≥—Ä—ã:', error);
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–Ω–æ–∂–∏—Ç–µ–ª—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞–≤–∫–∏
        document.addEventListener('DOMContentLoaded', () => {
            const diceBetAmount = document.getElementById('diceBetAmount');
            if (diceBetAmount) {
                diceBetAmount.addEventListener('input', () => {
                    diceGameState.betAmount = parseFloat(diceBetAmount.value) || 0.1;
                    updateDiceMultiplier();
                });
            }
        });

        // –ü—Ä–æ–¥–∞–∂–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞
        function sellSelectedItem() {
            if (!selectedInventoryItem) return;
            
            const item = selectedInventoryItem;
            
            if (tg) {
                tg.showConfirm(`–ü—Ä–æ–¥–∞—Ç—å "${item.name}" –∑–∞ üíé ${item.value.toFixed(2)}?`, (confirmed) => {
                    if (confirmed) {
                        if (changeBalance(item.value, 'sellItem')) {
                            // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥–º–µ—Ç –∏–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
                            userInventory = userInventory.filter(invItem => invItem.id !== item.id);
                            saveInventory(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –±–∞–ª–∞–Ω—Å –ª–æ–∫–∞–ª—å–Ω–æ
                            saveUserData(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                            updateInventory();
                            closeInventoryModal();
                            
                            tg.HapticFeedback.notificationOccurred('success');
                        }
                    }
                });
            } else {
                if (confirm(`–ü—Ä–æ–¥–∞—Ç—å "${item.name}" –∑–∞ ${item.value.toFixed(2)}?`)) {
                    if (changeBalance(item.value, 'sellItem')) {
                        // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥–º–µ—Ç –∏–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
                        userInventory = userInventory.filter(invItem => invItem.id !== item.id);
                        saveInventory(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –±–∞–ª–∞–Ω—Å –ª–æ–∫–∞–ª—å–Ω–æ
                        saveUserData(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                        updateInventory();
                        closeInventoryModal();
                    }
                }
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ü—Ä–æ–¥–∞—Ç—å" –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
        const sellItemBtn = document.getElementById('sellItemBtn');
        if (sellItemBtn) {
            sellItemBtn.addEventListener('click', sellSelectedItem);
        }

        // ========== –ö–†–ê–® –ò–ì–†–ê ==========
        let crashMultiplier = 1.00;
        let crashAnimationId = null;
        let crashGameRunning = false;
        let crashPlayers = [];
        let crashGraphPoints = [];
        // –û–±—ä—è–≤–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –∫—Ä–∞—à-–∏–≥—Ä—ã –≥–ª–æ–±–∞–ª—å–Ω–æ
        if (typeof selectedMultiplier === 'undefined') {
            var selectedMultiplier = null;
        }
        if (typeof betType === 'undefined') {
            var betType = 'balance';
        }
        let userBet = null;
        let crashRoundActive = false;
        let crashTarget = 1.00;
        let crashDirection = 1; // 1 = –≤–≤–µ—Ä—Ö, -1 = –≤–Ω–∏–∑ (–∫—Ä–∞—à)

        
        // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –¥–µ–ª–µ–≥–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–Ω–æ–ø–æ–∫ –º–Ω–æ–∂–∏—Ç–µ–ª–µ–π –∏ —Ç–∏–ø–∞ —Å—Ç–∞–≤–∫–∏
        // –£–ë–†–ê–ù–û - –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ inline onclick –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤ initCrashGame
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª inline onclick
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã –ö—Ä–∞—à
        function initCrashGame() {
            console.log('üîß initCrashGame –≤—ã–∑–≤–∞–Ω–∞');
            const canvas = document.getElementById('crashCanvas');
            if (!canvas) {
                console.error('‚ùå canvas –Ω–µ –Ω–∞–π–¥–µ–Ω!');
                return;
            }
            console.log('‚úÖ canvas –Ω–∞–π–¥–µ–Ω');
            
            const ctx = canvas.getContext('2d');
            if (!ctx) {
                console.error('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç canvas!');
                return;
            }
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã canvas - –∏—Å–ø–æ–ª—å–∑—É–µ–º CSS —Ä–∞–∑–º–µ—Ä—ã
            const container = canvas.parentElement;
            const containerWidth = container ? container.offsetWidth : window.innerWidth - 40;
            const containerHeight = 250; // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Ä–∞–∑–º–µ—Ä—ã canvas (–≤ –ø–∏–∫—Å–µ–ª—è—Ö)
            // –£–º–Ω–æ–∂–∞–µ–º –Ω–∞ devicePixelRatio –¥–ª—è —á–µ—Ç–∫–æ—Å—Ç–∏ –Ω–∞ Retina –¥–∏—Å–ø–ª–µ—è—Ö
            const dpr = window.devicePixelRatio || 1;
            canvas.width = containerWidth * dpr;
            canvas.height = containerHeight * dpr;
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º CSS —Ä–∞–∑–º–µ—Ä—ã
            canvas.style.width = containerWidth + 'px';
            canvas.style.height = containerHeight + 'px';
            
            // –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è Retina
            ctx.scale(dpr, dpr);
            
            console.log('‚úÖ Canvas —Ä–∞–∑–º–µ—Ä—ã:', canvas.width / dpr, 'x', canvas.height / dpr, 'DPR:', dpr);
            
            // –û—á–∏—â–∞–µ–º canvas
            ctx.clearRect(0, 0, canvas.width / dpr, canvas.height / dpr);
            
            // –†–∏—Å—É–µ–º —Ñ–æ–Ω
            ctx.fillStyle = 'rgba(20, 20, 30, 1)';
            ctx.fillRect(0, 0, canvas.width / dpr, canvas.height / dpr);
            
            // –ù–ï –æ—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏, —á—Ç–æ–±—ã —Å—Ç–∞–≤–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–ª–∏—Å—å
            // crashPlayers = []; // –£–±—Ä–∞–Ω–æ - —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç–∞–≤–∫–∏ –º–µ–∂–¥—É —Ä–∞—É–Ω–¥–∞–º–∏
            
            // –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
            const makeBetBtn = document.getElementById('makeBetBtn');
            if (makeBetBtn) {
                // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —á–µ—Ä–µ–∑ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
                const newBtn = makeBetBtn.cloneNode(true);
                makeBetBtn.parentNode.replaceChild(newBtn, makeBetBtn);
                
                // –°–æ–∑–¥–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ—É–Ω–∫—Ü–∏–∏ (–¥–µ–ª–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–º)
                window.makeBet = function() {
                    // –ï—Å–ª–∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–∞—è —Å—Ç–∞–≤–∫–∞ –∏ —Ä–∞—É–Ω–¥ –∏–¥–µ—Ç (–≥—Ä–∞—Ñ–∏–∫ —Ä–∞—Å—Ç–µ—Ç), –º–æ–∂–Ω–æ –∑–∞–±—Ä–∞—Ç—å
                    if (userBet && crashRoundActive && crashDirection === 1 && !userBet.cashedOut) {
                        cashOutPlayer(userBet.id);
                        return;
                    }
                    
                    // –ù–µ–ª—å–∑—è —Å—Ç–∞–≤–∏—Ç—å –≤–æ –≤—Ä–µ–º—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ä–∞—É–Ω–¥–∞ (–≥—Ä–∞—Ñ–∏–∫ –∏–¥–µ—Ç)
                    // –ú–æ–∂–Ω–æ —Å—Ç–∞–≤–∏—Ç—å –¢–û–õ–¨–ö–û –≤–æ –≤—Ä–µ–º—è –∫—É–ª–¥–∞—É–Ω–∞ (–∫–æ–≥–¥–∞ crashRoundActive = false)
                    if (crashRoundActive) {
                        if (tg) {
                            tg.showAlert('–°—Ç–∞–≤–∫–∏ –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤–æ –≤—Ä–µ–º—è –∫—É–ª–¥–∞—É–Ω–∞!');
                        } else {
                            alert('–°—Ç–∞–≤–∫–∏ –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤–æ –≤—Ä–µ–º—è –∫—É–ª–¥–∞—É–Ω–∞!');
                        }
                        return;
                    }
                    
                    const amountInput = document.getElementById('betAmountInput');
                    const itemSelect = document.getElementById('betItemSelect');
                    
                    let betAmount = 0;
                    let itemData = null;
                    
                    if (betType === 'balance') {
                        betAmount = parseFloat(amountInput.value);
                        if (!betAmount || betAmount <= 0 || betAmount > _balance) {
                            if (tg) {
                                tg.showAlert('–ù–µ–≤–µ—Ä–Ω–∞—è —Å—É–º–º–∞ —Å—Ç–∞–≤–∫–∏!');
                            } else {
                                alert('–ù–µ–≤–µ—Ä–Ω–∞—è —Å—É–º–º–∞ —Å—Ç–∞–≤–∫–∏!');
                            }
                            return;
                        }
                    } else {
                        const selectedOption = itemSelect.options[itemSelect.selectedIndex];
                        if (!selectedOption || !selectedOption.value) {
                            if (tg) {
                                tg.showAlert('–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç!');
                            } else {
                                alert('–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç!');
                            }
                            return;
                        }
                        itemData = JSON.parse(selectedOption.dataset.item);
                        betAmount = itemData.value;
                    }
                    
                    const user = tg?.initDataUnsafe?.user;
                    const newBet = {
                        id: Date.now(),
                        userId: user?.id || Math.random(),
                        username: user?.first_name || user?.username || '–ò–≥—Ä–æ–∫',
                        avatar: user?.photo_url ? null : 'üë§',
                        betAmount: betAmount,
                        itemName: itemData?.name || null,
                        itemValue: itemData?.value || null,
                        itemId: itemData?.id || null,
                        betMultiplier: selectedMultiplier,
                        autoCash: selectedMultiplier,
                        cashedOut: false,
                        timestamp: Date.now()
                    };
                    
                    if (betType === 'balance') {
                        if (!changeBalance(-betAmount, 'crashBet')) {
                            return;
                        }
                        saveInventory();
                        saveUserData();
                    } else {
                        userInventory = userInventory.filter(item => item.id !== itemData.id);
                        saveInventory();
                        saveUserData();
                        updateBetItemSelect();
                    }
                    
                    userBet = newBet;
                    crashPlayers.push(newBet);
                    updateCrashBetsList();
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç–∞–≤–∫—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                    saveCrashBetToServer(newBet);
                    
                    const makeBetBtn2 = document.getElementById('makeBetBtn');
                    if (makeBetBtn2) {
                        makeBetBtn2.textContent = '–ó–∞–±—Ä–∞—Ç—å';
                        makeBetBtn2.disabled = false;
                    }
                };
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
                newBtn.onclick = window.makeBet;
                newBtn.addEventListener('click', window.makeBet);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
                window.handleCrashBetClick = function(e) {
                    if (e) {
                        e.preventDefault();
                        e.stopPropagation();
                    }
                    if (typeof window.makeBet === 'function') {
                        window.makeBet();
                    }
                };
            }
            
            // –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ —Ç–∏–ø–∞ —Å—Ç–∞–≤–∫–∏
            console.log('üîß –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–Ω–æ–ø–æ–∫ —Ç–∏–ø–∞ —Å—Ç–∞–≤–∫–∏...');
            const betTypeButtons = document.querySelectorAll('.bet-type-btn');
            console.log('–ù–∞–π–¥–µ–Ω–æ –∫–Ω–æ–ø–æ–∫ —Ç–∏–ø–∞ —Å—Ç–∞–≤–∫–∏:', betTypeButtons.length);
            betTypeButtons.forEach(btn => {
                const newBtn = btn.cloneNode(true);
                btn.parentNode.replaceChild(newBtn, btn);
                
                // –°–æ–∑–¥–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞
                const handleBetTypeClick = function(e) {
                    if (e) {
                        e.preventDefault();
                        e.stopPropagation();
                        e.stopImmediatePropagation();
                    }
                    
                    console.log('üîµ –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ —Ç–∏–ø–∞ —Å—Ç–∞–≤–∫–∏:', newBtn.dataset.type);
                    
                    document.querySelectorAll('.bet-type-btn').forEach(b => b.classList.remove('active'));
                    newBtn.classList.add('active');
                    betType = newBtn.dataset.type;
                    
                    console.log('‚úÖ betType —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:', betType);
                    
                    const amountInput = document.getElementById('betAmountInput');
                    const itemSelect = document.getElementById('betItemSelect');
                    
                    if (betType === 'balance') {
                        if (amountInput) {
                            amountInput.style.display = 'block';
                            amountInput.style.visibility = 'visible';
                        }
                        if (itemSelect) {
                            itemSelect.style.display = 'none';
                            itemSelect.style.visibility = 'hidden';
                        }
                    } else {
                        if (amountInput) {
                            amountInput.style.display = 'none';
                            amountInput.style.visibility = 'hidden';
                        }
                        if (itemSelect) {
                            itemSelect.style.display = 'block';
                            itemSelect.style.visibility = 'visible';
                            updateBetItemSelect(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ–¥–∞—Ä–∫–æ–≤
                        }
                    }
                };
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏ onclick –∏ addEventListener
                newBtn.onclick = handleBetTypeClick;
                newBtn.addEventListener('click', handleBetTypeClick, true);
                newBtn.style.cursor = 'pointer';
                newBtn.style.pointerEvents = 'auto';
                newBtn.style.zIndex = '100';
            });
            
            // –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ –º–Ω–æ–∂–∏—Ç–µ–ª—è
            console.log('üîß –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–Ω–æ–ø–æ–∫ –º–Ω–æ–∂–∏—Ç–µ–ª–µ–π...');
            const multiplierButtons = document.querySelectorAll('.multiplier-btn');
            console.log('–ù–∞–π–¥–µ–Ω–æ –∫–Ω–æ–ø–æ–∫ –º–Ω–æ–∂–∏—Ç–µ–ª–µ–π:', multiplierButtons.length);
            multiplierButtons.forEach(btn => {
                const newBtn = btn.cloneNode(true);
                btn.parentNode.replaceChild(newBtn, btn);
                
                // –°–æ–∑–¥–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞
                const handleMultiplierClick = function(e) {
                    if (e) {
                        e.preventDefault();
                        e.stopPropagation();
                        e.stopImmediatePropagation();
                    }
                    
                    console.log('üîµ –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ –º–Ω–æ–∂–∏—Ç–µ–ª—è:', newBtn.dataset.mult);
                    
                    if (newBtn.dataset.mult === 'auto') {
                        selectedMultiplier = null;
                        console.log('‚úÖ selectedMultiplier —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: null (–∞–≤—Ç–æ)');
                    } else {
                        selectedMultiplier = parseFloat(newBtn.dataset.mult);
                        console.log('‚úÖ selectedMultiplier —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:', selectedMultiplier);
                    }
                    
                    document.querySelectorAll('.multiplier-btn').forEach(b => b.classList.remove('active'));
                    newBtn.classList.add('active');
                };
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ - –ë–ï–ó stopImmediatePropagation —á—Ç–æ–±—ã –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
                newBtn.onclick = handleMultiplierClick;
                newBtn.addEventListener('click', handleMultiplierClick);
                
                // –¢–∞–∫–∂–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º touchstart –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
                newBtn.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    handleMultiplierClick(e);
                });
                
                newBtn.style.cursor = 'pointer';
                newBtn.style.pointerEvents = 'auto';
                newBtn.style.zIndex = '100';
                
                console.log('‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –¥–ª—è –∫–Ω–æ–ø–∫–∏:', newBtn.dataset.mult);
            });
            
            console.log('‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ –º–Ω–æ–∂–∏—Ç–µ–ª–µ–π –∏ —Ç–∏–ø–∞ —Å—Ç–∞–≤–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã');
            
            // –£–±–µ–¥–∏–º—Å—è —á—Ç–æ canvas –≤–∏–¥–∏–º
            const crashPage = document.getElementById('crashPage');
            if (crashPage && crashPage.style.display === 'block') {
                console.log('‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∫—Ä–∞—à–∞ –≤–∏–¥–Ω–∞, –∑–∞–ø—É—Å–∫–∞–µ–º —Ä–∞—É–Ω–¥');
                startNewCrashRound(ctx, canvas);
            } else {
                console.log('‚ö†Ô∏è –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∫—Ä–∞—à–∞ –Ω–µ –≤–∏–¥–Ω–∞, –∂–¥–µ–º...');
                // –ï—Å–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –≤–∏–¥–Ω–∞, –∑–∞–ø—É—Å—Ç–∏–º –∫–æ–≥–¥–∞ –æ–Ω–∞ —Å—Ç–∞–Ω–µ—Ç –≤–∏–¥–∏–º–æ–π
                setTimeout(() => {
                    if (document.getElementById('crashPage')?.style.display === 'block') {
                        startNewCrashRound(ctx, canvas);
                    }
                }, 500);
            }
            updateCrashBetsList();
            updateBetItemSelect();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞–≤–∫–∏ –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–∫–æ–≤ —Å —Å–µ—Ä–≤–µ—Ä–∞
            loadCrashBetsFromServer();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Å—Ç–∞–≤–æ–∫ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
            if (window.crashBetsInterval) {
                clearInterval(window.crashBetsInterval);
            }
            window.crashBetsInterval = setInterval(() => {
                if (document.getElementById('crashPage')?.style.display === 'block') {
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Å—Ç–∞–≤–∫–∏ —Å —Å–µ—Ä–≤–µ—Ä–∞
                    loadCrashBetsFromServer();
                    updateCrashBetsList();
                }
            }, 1000);
        }

        // –ù–∞—á–∞–ª–æ –Ω–æ–≤–æ–≥–æ —Ä–∞—É–Ω–¥–∞ –∫—Ä–∞—à–∞ (—Å –∫—É–ª–¥–∞—É–Ω–æ–º –¥–ª—è —Å—Ç–∞–≤–æ–∫)
        function startNewCrashRound(ctx, canvas) {
            // –°–Ω–∞—á–∞–ª–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫—É–ª–¥–∞—É–Ω, —á—Ç–æ–±—ã –ª—é–¥–∏ —É—Å–ø–µ–ª–∏ –ø–æ—Å—Ç–∞–≤–∏—Ç—å —Å—Ç–∞–≤–∫–∏
            showCrashCooldown(10, ctx, canvas);
        }
        
        // –ü–æ–∫–∞–∑ –∫—É–ª–¥–∞—É–Ω–∞ –ø–µ—Ä–µ–¥ –Ω–æ–≤—ã–º —Ä–∞—É–Ω–¥–æ–º (–≤–æ –≤—Ä–µ–º—è –∫—É–ª–¥–∞—É–Ω–∞ –º–æ–∂–Ω–æ —Å—Ç–∞–≤–∏—Ç—å —Å—Ç–∞–≤–∫–∏)
        function showCrashCooldown(seconds, ctx, canvas) {
            const multiplierElement = document.getElementById('currentMultiplier');
            const makeBetBtn = document.getElementById('makeBetBtn');
            
            // –†–∞–∑—Ä–µ—à–∞–µ–º —Å—Ç–∞–≤–∫–∏ –≤–æ –≤—Ä–µ–º—è –∫—É–ª–¥–∞—É–Ω–∞
            crashRoundActive = false; // –†–∞—É–Ω–¥ –µ—â–µ –Ω–µ –Ω–∞—á–∞–ª—Å—è
            crashMultiplier = 1.00;
            
            // –û—á–∏—â–∞–µ–º –≥—Ä–∞—Ñ–∏–∫ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫—É–ª–¥–∞—É–Ω
            crashGraphPoints = [];
            
            // –£–¥–∞–ª—è–µ–º —Ç–æ–ª—å–∫–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ —Å—Ç–∞–≤–∫–∏ –ø—Ä–æ—à–ª–æ–≥–æ —Ä–∞—É–Ω–¥–∞ (—Å—Ç–∞—Ä—à–µ 30 —Å–µ–∫—É–Ω–¥)
            const now = Date.now();
            crashPlayers = crashPlayers.filter(player => {
                // –û—Å—Ç–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ —Å—Ç–∞–≤–∫–∏ (–Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ)
                if (!player.cashedOut) {
                    return true;
                }
                // –û—Å—Ç–∞–≤–ª—è–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ —Å—Ç–∞–≤–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ–¥–∞–≤–Ω–æ –∑–∞–≤–µ—Ä—à–∏–ª–∏—Å—å (–º–µ–Ω—å—à–µ 30 —Å–µ–∫—É–Ω–¥ –Ω–∞–∑–∞–¥)
                const timeSinceCashout = now - (player.cashOutTime || player.timestamp || 0);
                return timeSinceCashout < 30000; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ —Å—Ç–∞–≤–∫–∏ 30 —Å–µ–∫—É–Ω–¥
            });
            
            let remaining = seconds;
            
            const countdown = setInterval(() => {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫—É–ª–¥–∞—É–Ω —Ç–æ–ª—å–∫–æ –Ω–∞ canvas
                if (ctx && canvas && canvas.width > 0 && canvas.height > 0) {
                    // –ü–æ–ª—É—á–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã canvas —Å —É—á–µ—Ç–æ–º devicePixelRatio
                    const dpr = window.devicePixelRatio || 1;
                    const canvasWidth = canvas.width / dpr;
                    const canvasHeight = canvas.height / dpr;
                    
                    // –û—á–∏—â–∞–µ–º canvas
                    ctx.clearRect(0, 0, canvasWidth, canvasHeight);
                    
                    // –†–∏—Å—É–µ–º —Ñ–æ–Ω
                    ctx.fillStyle = 'rgba(20, 20, 30, 1)';
                    ctx.fillRect(0, 0, canvasWidth, canvasHeight);
                    
                    // –†–∏—Å—É–µ–º —Ç–µ–∫—Å—Ç –∫—É–ª–¥–∞—É–Ω–∞
                    ctx.fillStyle = '#ffaa00';
                    ctx.font = 'bold 28px Arial';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(`–°—Ç–∞–≤–∫–∏ –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è`, canvasWidth / 2, canvasHeight / 2 - 20);
                    ctx.fillText(`${remaining}...`, canvasWidth / 2, canvasHeight / 2 + 20);
                    
                    console.log('‚úÖ –ö—É–ª–¥–∞—É–Ω –Ω–∞—Ä–∏—Å–æ–≤–∞–Ω:', remaining);
                } else {
                    console.error('‚ùå Canvas –Ω–µ –≥–æ—Ç–æ–≤ –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è!', {
                        ctx: !!ctx,
                        canvas: !!canvas,
                        width: canvas?.width,
                        height: canvas?.height
                    });
                }
                
                // –û—á–∏—â–∞–µ–º –∏ —Å–∫—Ä—ã–≤–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –º–Ω–æ–∂–∏—Ç–µ–ª—è –≤–æ –≤—Ä–µ–º—è –∫—É–ª–¥–∞—É–Ω–∞ (–ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω–∞ canvas)
                if (multiplierElement) {
                    multiplierElement.textContent = '';
                    multiplierElement.style.display = 'none';
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å—Ç–∞–≤–æ–∫
                const makeBetBtn = document.getElementById('makeBetBtn');
                if (makeBetBtn && userBet && !userBet.cashedOut) {
                    makeBetBtn.textContent = '–°—Ç–∞–≤–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞';
                    makeBetBtn.disabled = true;
                } else if (makeBetBtn && !userBet) {
                    makeBetBtn.textContent = '–°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É';
                    makeBetBtn.disabled = false;
                }
                
                remaining--;
                
                if (remaining < 0) {
                    clearInterval(countdown);
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –º–Ω–æ–∂–∏—Ç–µ–ª—è –æ–±—Ä–∞—Ç–Ω–æ
                    if (multiplierElement) {
                        multiplierElement.style.display = 'block';
                        multiplierElement.textContent = 'x1.00';
                        multiplierElement.style.color = '#00ff00';
                        multiplierElement.style.borderColor = '#00ff00';
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å—Ç–∞–≤–æ–∫
                    if (makeBetBtn && userBet && !userBet.cashedOut && crashRoundActive === false) {
                        makeBetBtn.textContent = '–ó–∞–±—Ä–∞—Ç—å';
                        makeBetBtn.disabled = false;
                    }
                    
                    // –ù–∞—á–∏–Ω–∞–µ–º —Ä–∞—É–Ω–¥
                    crashRoundActive = true;
                    crashMultiplier = 1.00;
                    crashDirection = 1;
                    
                    // –ü–æ–ª—É—á–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã canvas –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–æ—á–µ–∫ –≥—Ä–∞—Ñ–∏–∫–∞
                    const dpr = window.devicePixelRatio || 1;
                    const canvasWidth = canvas.width / dpr;
                    const canvasHeight = canvas.height / dpr;
                    
                    crashGraphPoints = [{ x: 10, y: canvasHeight - 50, multiplier: 1.00 }];
                    
                    console.log('üöÄ –ù–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤—ã–π —Ä–∞—É–Ω–¥ –∫—Ä–∞—à–∞, –≥—Ä–∞—Ñ–∏–∫:', crashGraphPoints.length, '—Ç–æ—á–µ–∫');
                    
                    // –û–¥–∏–Ω–∞–∫–æ–≤—ã–π –∫—Ä–∞—à –¥–ª—è –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤ (–Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞—á–∞–ª–∞ —Ä–∞—É–Ω–¥–∞)
                    const roundStartTime = Date.now();
                    const seed = roundStartTime % 1000000; // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å—Ç–∞—Ç–æ–∫ –æ—Ç –≤—Ä–µ–º–µ–Ω–∏ –∫–∞–∫ seed
                    const random = seed / 1000000; // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ 0-1
                    
                    // –ú–æ–º–µ–Ω—Ç –∫—Ä–∞—à–∞ (–æ—Ç 1.01 –¥–æ 10.0) - –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –¥–ª—è –≤—Å–µ—Ö
                    crashTarget = 1.01 + random * 9.0;
                    
                    console.log('üéØ –¶–µ–ª—å –∫—Ä–∞—à–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞:', crashTarget.toFixed(2));
                    
                    // –í—Ä–µ–º—è –¥–æ –∫—Ä–∞—à–∞ (–æ—Ç 3 –¥–æ 20 —Å–µ–∫—É–Ω–¥) - –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –¥–ª—è –≤—Å–µ—Ö
                    // –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ–º setTimeout –¥–ª—è –∫—Ä–∞—à–∞, —Ç–∞–∫ –∫–∞–∫ –∫—Ä–∞—à –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ–º crashTarget –≤ –∞–Ω–∏–º–∞—Ü–∏–∏
                    // –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤
                    
                    // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é —Ä–æ—Å—Ç–∞ –≥—Ä–∞—Ñ–∏–∫–∞
                    console.log('üé¨ –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –≥—Ä–∞—Ñ–∏–∫–∞...');
                    startCrashAnimation(ctx, canvas);
                }
            }, 1000);
        }

        // –ê–Ω–∏–º–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–∞ –∫—Ä–∞—à–∞
        function startCrashAnimation(ctx, canvas) {
            if (crashAnimationId) {
                cancelAnimationFrame(crashAnimationId);
            }
            
            // –û–¥–∏–Ω–∞–∫–æ–≤–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –¥–ª—è –≤—Å–µ—Ö (–Ω–∞ –æ—Å–Ω–æ–≤–µ crashTarget –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏)
            let speed = 0.012; // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–æ—Å—Ç–∞ –¥–ª—è –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤
            
            const animate = () => {
                // –í—Å–µ–≥–¥–∞ —Ä–∏—Å—É–µ–º canvas (–¥–∞–∂–µ –≤–æ –≤—Ä–µ–º—è –∫—É–ª–¥–∞—É–Ω–∞ –±—É–¥–µ—Ç —á—Ç–æ-—Ç–æ –ø–æ–∫–∞–∑–∞–Ω–æ)
                if (!ctx || !canvas || canvas.width === 0 || canvas.height === 0) {
                    console.error('‚ùå Canvas –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è', {
                        ctx: !!ctx,
                        canvas: !!canvas,
                        width: canvas?.width,
                        height: canvas?.height
                    });
                    return;
                }
                
                // –ü–æ–ª—É—á–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã canvas —Å —É—á–µ—Ç–æ–º devicePixelRatio
                const dpr = window.devicePixelRatio || 1;
                const canvasWidth = canvas.width / dpr;
                const canvasHeight = canvas.height / dpr;
                
                // –û—á–∏—â–∞–µ–º canvas –∏ —Ä–∏—Å—É–µ–º —Ñ–æ–Ω
                ctx.clearRect(0, 0, canvasWidth, canvasHeight);
                ctx.fillStyle = 'rgba(20, 20, 30, 1)';
                ctx.fillRect(0, 0, canvasWidth, canvasHeight);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –º–Ω–æ–∂–∏—Ç–µ–ª—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ä–∞—É–Ω–¥ –∞–∫—Ç–∏–≤–µ–Ω –∏ –≥—Ä–∞—Ñ–∏–∫ —Ä–∞—Å—Ç–µ—Ç
                if (crashRoundActive && crashDirection === 1) {
                    // –î–≤–∏–∂–µ–Ω–∏–µ –≤–≤–µ—Ä—Ö (—Ä–æ—Å—Ç)
                    crashMultiplier += speed;
                    if (crashMultiplier >= crashTarget) {
                        // –î–æ—Å—Ç–∏–≥–ª–∏ —Ü–µ–ª–∏, –Ω–∞—á–∏–Ω–∞–µ–º –∫—Ä–∞—à - —Ä–µ–∑–∫–æ –ø–∞–¥–∞–µ–º
                        crashDirection = -1;
                        crashMultiplier = 0.01;
                        
                        // –í–∏–±—Ä–∞—Ü–∏—è –ø—Ä–∏ –∫—Ä–∞—à–µ
                        if (tg) {
                            try {
                                tg.HapticFeedback.notificationOccurred('error');
                            } catch(e) {
                                console.log('HapticFeedback error:', e);
                            }
                        }
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é —Ç–æ—á–∫—É –ø–µ—Ä–µ–¥ –∫—Ä–∞—à–µ–º
                        const lastX = crashGraphPoints.length > 0 ? crashGraphPoints[crashGraphPoints.length - 1].x : 0;
                        const lastY = crashGraphPoints.length > 0 ? crashGraphPoints[crashGraphPoints.length - 1].y : canvas.height - 50;
                        crashGraphPoints.push({ x: lastX, y: lastY, multiplier: crashTarget });
                        
                        // –°—Ä–∞–∑—É –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫—Ä–∞—à
                        crashRoundActive = false;
                        processCrashRound();
                        
                        // –†–∏—Å—É–µ–º –∫—Ä–∞—Å–Ω—É—é –ª–∏–Ω–∏—é –ø–∞–¥–µ–Ω–∏—è
                        ctx.strokeStyle = '#ff0000';
                        ctx.lineWidth = 3;
                        ctx.beginPath();
                        ctx.moveTo(lastX, lastY);
                        ctx.lineTo(lastX, canvasHeight - 50);
                        ctx.stroke();
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º –º–Ω–æ–∂–∏—Ç–µ–ª—å –Ω–∞ —ç–∫—Ä–∞–Ω–µ
                        const multiplierElement = document.getElementById('currentMultiplier');
                        if (multiplierElement) {
                            multiplierElement.textContent = `x${crashTarget.toFixed(2)}`;
                            multiplierElement.style.color = '#ff0000';
                            multiplierElement.style.borderColor = '#ff0000';
                        }
                        
                        // –ù–∞—á–∏–Ω–∞–µ–º –∫—É–ª–¥–∞—É–Ω 10 —Å–µ–∫—É–Ω–¥
                        setTimeout(() => {
                            showCrashCooldown(10, ctx, canvas);
                        }, 100);
                        
                        // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
                        if (crashAnimationId) {
                            cancelAnimationFrame(crashAnimationId);
                            crashAnimationId = null;
                        }
                        return;
                    }
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ—á–∫—É –Ω–∞ –≥—Ä–∞—Ñ–∏–∫ –≤–æ –≤—Ä–µ–º—è —Ä–æ—Å—Ç–∞
                    const x = 10 + (crashGraphPoints.length * 3); // –ù–∞—á–∏–Ω–∞–µ–º —Å 10px –æ—Ç—Å—Ç—É–ø–∞, —à–∞–≥ 3px
                    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –º–Ω–æ–∂–∏—Ç–µ–ª—å –≤ Y –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—É (1.0 = –Ω–∏–∑, –≤—ã—à–µ = –≤—ã—à–µ –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ)
                    const multiplierPercent = ((crashMultiplier - 1.0) / 9.0) * 100;
                    const y = canvasHeight - 50 - (multiplierPercent / 100) * (canvasHeight - 100);
                    
                    crashGraphPoints.push({ x, y, multiplier: crashMultiplier });
                    
                    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ—á–µ–∫ —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞—Ç—å –≥—Ä–∞—Ñ–∏–∫
                    const maxPoints = Math.floor((canvasWidth - 20) / 3);
                    if (crashGraphPoints.length > maxPoints) {
                        crashGraphPoints = crashGraphPoints.slice(-maxPoints);
                        crashGraphPoints.forEach((point, i) => {
                            point.x = 10 + (i * 3);
                        });
                    }
                    
                    // –†–∏—Å—É–µ–º –∑–µ–ª–µ–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ —Ä–æ—Å—Ç–∞
                    if (crashGraphPoints.length > 1) {
                        ctx.strokeStyle = '#00ff00';
                        ctx.lineWidth = 3;
                        ctx.beginPath();
                        ctx.moveTo(crashGraphPoints[0].x, crashGraphPoints[0].y);
                        for (let i = 1; i < crashGraphPoints.length; i++) {
                            ctx.lineTo(crashGraphPoints[i].x, crashGraphPoints[i].y);
                        }
                        ctx.stroke();
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–Ω–æ–∂–∏—Ç–µ–ª—è
                    const multiplierElement = document.getElementById('currentMultiplier');
                    if (multiplierElement) {
                        multiplierElement.textContent = `x${crashMultiplier.toFixed(2)}`;
                        multiplierElement.style.color = '#00ff00';
                        multiplierElement.style.borderColor = '#00ff00';
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É "–ó–∞–±—Ä–∞—Ç—å" –µ—Å–ª–∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–∞—è —Å—Ç–∞–≤–∫–∞
                    const makeBetBtn = document.getElementById('makeBetBtn');
                    if (makeBetBtn && userBet && !userBet.cashedOut) {
                        makeBetBtn.textContent = '–ó–∞–±—Ä–∞—Ç—å';
                        makeBetBtn.disabled = false;
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—ã–∏–≥—Ä—ã—à–∏
                    checkCrashWins();
                }
                
                // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ä–∞—É–Ω–¥ –∞–∫—Ç–∏–≤–µ–Ω
                if (crashRoundActive) {
                    crashAnimationId = requestAnimationFrame(animate);
                }
            };
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
            if (crashRoundActive) {
                animate();
            } else {
                console.log('‚ö†Ô∏è –†–∞—É–Ω–¥ –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω, –∞–Ω–∏–º–∞—Ü–∏—è –Ω–µ –∑–∞–ø—É—â–µ–Ω–∞');
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞—É–Ω–¥–∞ –∫—Ä–∞—à–∞
        function processCrashRound() {
            // –í—Å–µ –Ω–µ –∑–∞–±—Ä–∞–Ω–Ω—ã–µ —Å—Ç–∞–≤–∫–∏ —Ç–µ—Ä—è—é—Ç—Å—è
            let lostCount = 0;
            crashPlayers.forEach(player => {
                if (!player.cashedOut) {
                    // –°—Ç–∞–≤–∫–∞ –ø–æ—Ç–µ—Ä—è–Ω–∞ - —á–µ–ª–æ–≤–µ–∫ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç
                    player.cashedOut = true;
                    player.winnings = 0;
                    player.cashOutMultiplier = 0;
                    player.cashOutTime = Date.now(); // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º –≤—Ä–µ–º—è –∫—Ä–∞—à–∞
                    lostCount++;
                    
                    // –ï—Å–ª–∏ —ç—Ç–æ —Å—Ç–∞–≤–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                    if (player.id === userBet?.id) {
                        userBet = null;
                        const makeBetBtn = document.getElementById('makeBetBtn');
                        if (makeBetBtn) {
                            makeBetBtn.textContent = '–°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É';
                        }
                    }
                }
            });
            
            if (lostCount > 0 && tg) {
                tg.showAlert(`–ö–†–ê–®! –ü–æ—Ç–µ—Ä—è–Ω–æ ${lostCount} —Å—Ç–∞–≤–æ–∫`);
                tg.HapticFeedback.notificationOccurred('error');
            }
            
            updateCrashBetsList();
            
            // –ù–ï –æ—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤ - —Å—Ç–∞–≤–∫–∏ –æ—Å—Ç–∞—é—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏
            // –ò–≥—Ä–æ–∫–∏ –º–æ–≥—É—Ç –≤–∏–¥–µ—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ —Å—Ç–∞–≤–∫–∏ –¥–æ –Ω–∞—á–∞–ª–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ä–∞—É–Ω–¥–∞
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–∏–≥—Ä—ã—à–µ–π –∏–≥—Ä–æ–∫–æ–≤
        function checkCrashWins() {
            crashPlayers.forEach(player => {
                if (!player.cashedOut && player.autoCash && crashMultiplier >= player.autoCash) {
                    cashOutPlayer(player.id);
                }
            });
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–∫—É—â–∏—Ö –≤—ã–∏–≥—Ä—ã—à–µ–π
            if (crashPlayers.length > 0 && crashPlayers.some(p => !p.cashedOut)) {
                setTimeout(() => updateCrashBetsList(), 1000);
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        async function saveCrashBetToServer(bet) {
            try {
                const response = await fetch(`${API_BASE_URL}/crash/bets`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        ...bet,
                        timestamp: Date.now()
                    })
                });
                
                if (!response.ok) {
                    console.log('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç–∞–≤–∫—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä, —Ä–∞–±–æ—Ç–∞–µ–º –ª–æ–∫–∞–ª—å–Ω–æ');
                }
            } catch (error) {
                console.log('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Å—Ç–∞–≤–∫–∏:', error);
                // –†–∞–±–æ—Ç–∞–µ–º –ª–æ–∫–∞–ª—å–Ω–æ, –µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞–≤–æ–∫ –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–∫–æ–≤ —Å —Å–µ—Ä–≤–µ—Ä–∞
        async function loadCrashBetsFromServer() {
            try {
                const response = await fetch(`${API_BASE_URL}/crash/bets`);
                if (response.ok) {
                    const serverBets = await response.json();
                    
                    // –û–±—ä–µ–¥–∏–Ω—è–µ–º —Å—Ç–∞–≤–∫–∏ —Å —Å–µ—Ä–≤–µ—Ä–∞ —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏
                    const localUserIds = crashPlayers.map(p => p.id);
                    serverBets.forEach(serverBet => {
                        // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∞–≤–∫—É, –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Å–ø–∏—Å–∫–µ
                        if (!localUserIds.includes(serverBet.id)) {
                            crashPlayers.push(serverBet);
                        } else {
                            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å—Ç–∞–≤–∫—É
                            const index = crashPlayers.findIndex(p => p.id === serverBet.id);
                            if (index !== -1) {
                                crashPlayers[index] = { ...crashPlayers[index], ...serverBet };
                            }
                        }
                    });
                }
            } catch (error) {
                console.log('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç–∞–≤–æ–∫:', error);
                // –†–∞–±–æ—Ç–∞–µ–º –ª–æ–∫–∞–ª—å–Ω–æ, –µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
            }
        }
        
        // –í—ã–≤–æ–¥ —Å—Ç–∞–≤–∫–∏
        function cashOutPlayer(playerId) {
            const player = crashPlayers.find(p => p.id === playerId);
            if (!player || player.cashedOut) return;
            
            const betValue = player.itemValue || player.betAmount;
            const winnings = betValue * crashMultiplier;
            player.cashedOut = true;
            player.winnings = winnings;
            player.cashOutMultiplier = crashMultiplier;
            player.cashOutTime = Date.now(); // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º –≤—Ä–µ–º—è –≤—ã–≤–æ–¥–∞
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
            saveCrashBetToServer(player);
            
            // –ï—Å–ª–∏ —ç—Ç–æ —Å—Ç–∞–≤–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –¥–æ–±–∞–≤–ª—è–µ–º –≤—ã–∏–≥—Ä—ã—à –∫ –±–∞–ª–∞–Ω—Å—É
            if (playerId === userBet?.id) {
                changeBalance(winnings, 'crashWin');
                saveInventory();
                saveUserData();
                
                if (tg) {
                    tg.showAlert(`–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${winnings.toFixed(2)}!`);
                    tg.HapticFeedback.notificationOccurred('success');
                }
                
                userBet = null;
                const makeBetBtn = document.getElementById('makeBetBtn');
                if (makeBetBtn) {
                    makeBetBtn.textContent = '–°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É';
                }
            }
            
            updateCrashBetsList();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å—Ç–∞–≤–æ–∫
        function updateCrashBetsList() {
            const betsList = document.getElementById('betsList');
            if (!betsList) return;
            
            betsList.innerHTML = '';
            const headerDiv = document.createElement('div');
            headerDiv.className = 'bets-list-header';
            headerDiv.textContent = `–°—Ç–∞–≤–∫–∏ (${crashPlayers.length})`;
            betsList.appendChild(headerDiv);
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∏–≥—Ä–æ–∫–æ–≤: —Å–Ω–∞—á–∞–ª–∞ –∞–∫—Ç–∏–≤–Ω—ã–µ, –ø–æ—Ç–æ–º –≤—ã–≤–µ–¥–µ–Ω–Ω—ã–µ
            const activePlayers = crashPlayers.filter(p => !p.cashedOut);
            const cashedPlayers = crashPlayers.filter(p => p.cashedOut);
            const sortedPlayers = [...activePlayers, ...cashedPlayers].reverse();
            
            sortedPlayers.forEach(player => {
                const betItem = document.createElement('div');
                betItem.className = 'bet-item';
                
                const avatar = document.createElement('div');
                avatar.className = 'bet-item-avatar';
                const user = tg?.initDataUnsafe?.user;
                if (player.userId === user?.id && user?.photo_url) {
                    const img = document.createElement('img');
                    img.src = user.photo_url;
                    img.style.width = '100%';
                    img.style.height = '100%';
                    img.style.objectFit = 'cover';
                    img.style.borderRadius = '50%';
                    avatar.appendChild(img);
                } else {
                    avatar.textContent = player.avatar || 'üë§';
                }
                betItem.appendChild(avatar);
                
                const info = document.createElement('div');
                info.className = 'bet-item-info';
                
                const username = document.createElement('div');
                username.className = 'bet-item-username';
                username.textContent = player.username;
                info.appendChild(username);
                
                const details = document.createElement('div');
                details.className = 'bet-item-details';
                if (player.itemName) {
                    const betValue = player.itemValue || 0;
                    details.innerHTML = `üéÅ ${player.itemName}<br><span style="font-size: 12px; opacity: 0.8;">–°—Ç–∞–≤–∫–∞: ${betValue.toFixed(2)}</span>`;
                } else {
                    details.innerHTML = `<span class="currency-icon" style="width: 12px; height: 12px; display: inline-block;"></span> ${player.betAmount.toFixed(2)}<br><span style="font-size: 12px; opacity: 0.8;">–ú–Ω–æ–∂–∏—Ç–µ–ª—å: ${(player.cashOutMultiplier || crashMultiplier).toFixed(2)}</span>`;
                }
                info.appendChild(details);
                
                betItem.appendChild(info);
                
                const winnings = document.createElement('div');
                winnings.className = 'bet-item-winnings';
                if (player.cashedOut) {
                    if (player.winnings > 0) {
                        winnings.innerHTML = `<span class="currency-icon" style="width: 14px; height: 14px; display: inline-block;"></span> ${player.winnings.toFixed(2)} ‚úÖ`;
                        winnings.style.color = '#00ff00';
                    } else {
                        winnings.innerHTML = `‚ùå –ü–æ—Ç–µ—Ä—è–Ω–æ`;
                        winnings.style.color = '#ff0000';
                    }
                } else {
                    const betValue = player.itemValue || player.betAmount;
                    const currentWinnings = betValue * crashMultiplier;
                    winnings.innerHTML = `<span class="currency-icon" style="width: 14px; height: 14px; display: inline-block;"></span> ${currentWinnings.toFixed(2)}`;
                    winnings.style.color = '#667eea';
                }
                betItem.appendChild(winnings);
                
                betsList.appendChild(betItem);
            });
            
            document.getElementById('playersCount').textContent = crashPlayers.length;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∞ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –¥–ª—è —Å—Ç–∞–≤–∫–∏
        function updateBetItemSelect() {
            const select = document.getElementById('betItemSelect');
            if (!select) return;
            
            select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç</option>';
            userInventory.forEach(item => {
                const option = document.createElement('option');
                option.value = item.id;
                option.textContent = `${item.name} (${formatPrice(item.value).replace(/<[^>]*>/g, '')})`;
                option.dataset.item = JSON.stringify(item);
                select.appendChild(option);
            });
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ —Ç–∏–ø–∞ —Å—Ç–∞–≤–∫–∏ –∏ –º–Ω–æ–∂–∏—Ç–µ–ª—è —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –≤ initCrashGame

        // –°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ initCrashGame
        // –≠—Ç–æ—Ç –∫–æ–¥ –Ω–∏–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        // –∏ –±—É–¥–µ—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω –≤ initCrashGame –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫—Ä–∞—à–∞
        const makeBetBtn = document.getElementById('makeBetBtn');
        if (makeBetBtn && !makeBetBtn.hasAttribute('data-handler-set')) {
            makeBetBtn.setAttribute('data-handler-set', 'true');
            makeBetBtn.addEventListener('click', () => {
                // –ï—Å–ª–∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–∞—è —Å—Ç–∞–≤–∫–∞ –∏ —Ä–∞—É–Ω–¥ –∏–¥–µ—Ç (–≥—Ä–∞—Ñ–∏–∫ —Ä–∞—Å—Ç–µ—Ç), –º–æ–∂–Ω–æ –∑–∞–±—Ä–∞—Ç—å
                if (userBet && crashRoundActive && crashDirection === 1 && !userBet.cashedOut) {
                    cashOutPlayer(userBet.id);
                    return;
                }
                
                // –ù–µ–ª—å–∑—è —Å—Ç–∞–≤–∏—Ç—å –≤–æ –≤—Ä–µ–º—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ä–∞—É–Ω–¥–∞ (–≥—Ä–∞—Ñ–∏–∫ –∏–¥–µ—Ç)
                // –ú–æ–∂–Ω–æ —Å—Ç–∞–≤–∏—Ç—å –¢–û–õ–¨–ö–û –≤–æ –≤—Ä–µ–º—è –∫—É–ª–¥–∞—É–Ω–∞ (–∫–æ–≥–¥–∞ crashRoundActive = false)
                if (crashRoundActive) {
                    if (tg) {
                        tg.showAlert('–°—Ç–∞–≤–∫–∏ –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤–æ –≤—Ä–µ–º—è –∫—É–ª–¥–∞—É–Ω–∞!');
                    } else {
                        alert('–°—Ç–∞–≤–∫–∏ –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤–æ –≤—Ä–µ–º—è –∫—É–ª–¥–∞—É–Ω–∞!');
                    }
                    return;
                }
                
                const amountInput = document.getElementById('betAmountInput');
                const itemSelect = document.getElementById('betItemSelect');
                
                let betAmount = 0;
                let itemData = null;
                
                if (betType === 'balance') {
                    betAmount = parseFloat(amountInput.value);
                    if (!betAmount || betAmount <= 0 || betAmount > balance) {
                        if (tg) {
                            tg.showAlert('–ù–µ–≤–µ—Ä–Ω–∞—è —Å—É–º–º–∞ —Å—Ç–∞–≤–∫–∏!');
                        } else {
                            alert('–ù–µ–≤–µ—Ä–Ω–∞—è —Å—É–º–º–∞ —Å—Ç–∞–≤–∫–∏!');
                        }
                        return;
                    }
                } else {
                    const selectedOption = itemSelect.options[itemSelect.selectedIndex];
                    if (!selectedOption || !selectedOption.value) {
                        if (tg) {
                            tg.showAlert('–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç!');
                        } else {
                            alert('–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç!');
                        }
                        return;
                    }
                    itemData = JSON.parse(selectedOption.dataset.item);
                    betAmount = itemData.value;
                }
                
                const user = tg?.initDataUnsafe?.user;
                const newBet = {
                    id: Date.now(),
                    userId: user?.id || Math.random(),
                    username: user?.first_name || user?.username || '–ò–≥—Ä–æ–∫',
                    avatar: user?.photo_url ? null : 'üë§',
                    betAmount: betAmount,
                    itemName: itemData?.name || null,
                    itemValue: itemData?.value || null,
                    itemId: itemData?.id || null,
                    betMultiplier: selectedMultiplier,
                    autoCash: selectedMultiplier,
                    cashedOut: false,
                    timestamp: Date.now()
                };
                
                if (betType === 'balance') {
                    if (!changeBalance(-betAmount, 'crashBet')) {
                        return;
                    }
                    saveInventory();
                    saveUserData();
                } else {
                    userInventory = userInventory.filter(item => item.id !== itemData.id);
                    saveInventory();
                    saveUserData();
                    updateBetItemSelect();
                }
                
                userBet = newBet;
                crashPlayers.push(newBet);
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å—Ç–∞–≤–∫—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å –¥—Ä—É–≥–∏–º–∏ –∏–≥—Ä–æ–∫–∞–º–∏
                saveCrashBetToServer(newBet);
                
                updateCrashBetsList();
                
                // –ú–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ä–∞—É–Ω–¥ –∞–∫—Ç–∏–≤–µ–Ω
                if (crashRoundActive) {
                    makeBetBtn.textContent = '–ó–∞–±—Ä–∞—Ç—å';
                } else {
                    makeBetBtn.textContent = '–°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É';
                }
                
                if (tg) {
                    tg.showAlert('–°—Ç–∞–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞! –î–æ–∂–¥–∏—Ç–µ—Å—å –Ω–∞—á–∞–ª–∞ —Ä–∞—É–Ω–¥–∞.');
                    tg.HapticFeedback.impactOccurred('medium');
                }
            });
        }


        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "+" –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∫—Ä–∞—à–∞ - –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ initTopUpHandlers
    </script>
</body>
</html>
