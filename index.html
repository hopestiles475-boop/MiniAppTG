<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>NFT Cases</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--tg-theme-bg-color, #0a0a0a);
            color: var(--tg-theme-text-color, #ffffff);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 20px;
        }

        .profile-section {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .username {
            font-weight: 600;
            font-size: 16px;
            color: #ffffff;
        }

        .balance-section {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 16px;
            border-radius: 20px;
        }
        
        .balance-section, .balance-text {
            color: #ffffff !important;
        }

        .diamond-icon {
            width: 18px;
            height: 18px;
            display: inline-block;
            background-image: url('ton_symbol.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            vertical-align: middle;
        }
        
        .currency-icon {
            width: 16px;
            height: 16px;
            display: inline-block;
            background-image: url('ton_symbol.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            vertical-align: middle;
            margin-right: 2px;
        }

        .balance-text {
            font-weight: 600;
            font-size: 16px;
        }

        .ton-balance {
            display: none !important;
            visibility: hidden !important;
            font-size: 24px;
            font-weight: 700;
            margin: 10px 20px;
            color: #ffffff;
        }

        .demo-badge {
            display: none !important;
            visibility: hidden !important;
            background: #667eea;
            padding: 4px 12px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }

        .subscribe-btn {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 15px 20px;
            padding: 15px 20px;
            border-radius: 16px;
            border: none;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }

        .subscribe-inner {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .subscribe-icon {
            font-size: 24px;
        }

        .subscribe-action {
            background: white;
            color: #667eea;
            padding: 8px 16px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
        }

        .tabs {
            display: flex;
            gap: 10px;
            padding: 0 20px;
            margin-bottom: 15px;
        }

        .tab {
            padding: 10px 20px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: rgba(255, 255, 255, 0.6);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .live-section {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 0 20px;
            margin-bottom: 20px;
        }

        .live-badge {
            background: #00ff00;
            color: #000;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 700;
            white-space: nowrap;
        }

        .live-carousel {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            scrollbar-width: none;
        }

        .live-carousel::-webkit-scrollbar {
            display: none;
        }

        .live-item {
            min-width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: 3px solid transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            position: relative;
            overflow: hidden;
        }

        .live-item img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            padding: 8px;
        }

        .live-item.active {
            border-color: #00ff00;
        }

        .cases-carousel {
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding: 20px;
            padding-bottom: 100px;
            width: 100%;
            box-sizing: border-box;
        }

        .cases-carousel::-webkit-scrollbar {
            display: none;
        }

        .case-card {
            width: 100%;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.15) 0%, rgba(118, 75, 162, 0.15) 100%);
            border-radius: 16px;
            padding: 15px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            box-sizing: border-box;
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 15px;
        }

        .case-card:active {
            transform: scale(0.98);
        }

        .case-icon {
            font-size: 80px;
            text-align: center;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 120px;
            min-width: 120px;
            height: 120px;
            background: transparent;
            border-radius: 12px;
            padding: 10px;
            flex-shrink: 0;
        }

        .case-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            display: block;
        }

        .case-icon:empty {
            display: none;
        }

        /* –°–∫—Ä—ã–≤–∞–µ–º fallback —ç–º–æ–¥–∑–∏ –µ—Å–ª–∏ –µ—Å—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ */
        .case-icon img + * {
            display: none;
        }

        .case-price-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            color: #00d4ff;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .case-price-badge .currency-icon {
            width: 14px;
            height: 14px;
        }

        .case-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding-left: 10px;
        }

        .case-name {
            font-size: 18px;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 5px;
        }

        .case-description {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.6);
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            padding: 15px;
            padding-bottom: 100px;
        }

        .page-btn {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.5);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .page-btn.active {
            background: #667eea;
            color: white;
        }

        #mainPage {
            display: block;
        }

        #mainPage.hidden {
            display: none !important;
        }

        .case-detail-page {
            display: none !important;
            padding: 20px;
            padding-bottom: 120px;
        }

        .case-detail-page.active {
            display: block !important;
        }

        .case-detail-page.active ~ .open-btn,
        .case-detail-page.active + .open-btn {
            display: flex !important;
        }


        .case-detail-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .case-detail-icon {
            font-size: 120px;
            margin: 20px 0;
            background: transparent;
            border-radius: 16px;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 150px;
        }

        .case-detail-icon img {
            width: 100%;
            max-width: 300px;
            min-width: 150px;
            height: auto;
            max-height: 300px;
            object-fit: contain;
            display: block;
        }

        .roulette-container {
            width: 100%;
            height: 200px;
            position: relative;
            overflow: hidden !important;
            margin: 20px 0;
            border-radius: 16px;
            background: rgba(255, 255, 255, 0.05);
            display: none;
            padding: 0;
            box-sizing: border-box;
            min-height: 200px;
        }
        
        .roulette-wrapper {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden !important;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .roulette-container.active {
            display: block;
        }

        .roulette-track {
            display: flex;
            gap: 20px;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            will-change: transform;
            white-space: nowrap;
            width: auto;
            height: 150px;
            align-items: center;
            margin: 0;
            padding: 0;
            box-sizing: content-box;
        }

        .gift-item {
            width: 150px;
            min-width: 150px;
            max-width: 150px;
            height: 150px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.3) 0%, rgba(118, 75, 162, 0.3) 100%);
            border-radius: 16px;
            display: flex !important;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 3px solid rgba(255, 255, 255, 0.2);
            font-size: 80px;
            position: relative;
            flex-shrink: 0;
            visibility: visible !important;
            opacity: 1 !important;
            z-index: 2;
            transition: none !important;
            pointer-events: auto !important;
            margin: 0;
            padding: 0;
            vertical-align: top;
        }

        .gift-item img {
            width: 80px;
            height: 80px;
            object-fit: contain;
            display: block;
        }

        .gift-item.selected {
            border-color: #00ff00;
            background: rgba(0, 255, 0, 0.2);
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.5);
            transform: scale(1.1);
            z-index: 3;
        }

        .gift-name {
            position: absolute;
            bottom: -25px;
            font-size: 12px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.8);
            white-space: nowrap;
        }

        .center-indicator {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 3px;
            height: 180px;
            background: linear-gradient(to bottom, transparent, #00ff00, transparent);
            z-index: 5;
            pointer-events: none;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
        }

        .case-detail-price {
            font-size: 28px;
            font-weight: 700;
            color: #667eea;
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 6px;
            justify-content: center;
        }
        
        .case-detail-price .currency-icon {
            width: 24px;
            height: 24px;
        }

        .whats-inside-title {
            font-size: 20px;
            font-weight: 700;
            margin: 30px 0 20px 0;
            padding: 0 10px;
            color: #ffffff;
        }

        .prizes-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            padding: 0 10px;
            margin-bottom: 30px;
        }

        .prize-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 15px;
            text-align: center;
            border: 2px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
        }

        .prize-item.win {
            border-color: #00ff00;
            background: rgba(0, 255, 0, 0.1);
            animation: winPulse 1s;
        }

        @keyframes winPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .prize-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            margin-bottom: 10px;
        }

        .prize-icon img {
            width: 60px;
            height: 60px;
            object-fit: contain;
            display: block;
        }

        .prize-value {
            font-size: 16px;
            font-weight: 600;
            color: #667eea;
            display: flex;
            align-items: center;
            gap: 4px;
            justify-content: center;
        }
        
        .prize-value .currency-icon {
            width: 16px;
            height: 16px;
        }

        .open-btn {
            position: fixed !important;
            bottom: 100px !important;
            left: 20px !important;
            right: 20px !important;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            color: white !important;
            border: 3px solid rgba(255, 255, 255, 0.3) !important;
            padding: 18px !important;
            border-radius: 16px !important;
            font-size: 18px !important;
            font-weight: 700 !important;
            cursor: pointer !important;
            display: none !important;
            align-items: center !important;
            justify-content: center !important;
            gap: 10px !important;
            z-index: 99999 !important;
            box-shadow: 0 8px 40px rgba(102, 126, 234, 0.8), 0 0 30px rgba(102, 126, 234, 0.6), inset 0 1px 0 rgba(255, 255, 255, 0.3) !important;
            visibility: hidden !important;
            opacity: 0 !important;
            transition: all 0.3s !important;
            backdrop-filter: blur(10px) !important;
        }
        
        /* –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –Ω–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö –∫—Ä–æ–º–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–µ—Ç–∞–ª–µ–π –∫–µ–π—Å–∞ */
        #mainPage:not(.hidden) ~ .open-btn,
        #profilePage[style*="block"] ~ .open-btn,
        #profilePage:not([style*="none"]) ~ .open-btn {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
        }
        
        .open-btn:hover {
            transform: translateY(-2px) !important;
            box-shadow: 0 10px 50px rgba(102, 126, 234, 1), 0 0 40px rgba(102, 126, 234, 0.8), inset 0 1px 0 rgba(255, 255, 255, 0.4) !important;
        }
        
        .open-btn:active {
            transform: translateY(0) !important;
        }

        .open-btn.show {
            display: flex !important;
            visibility: visible !important;
            opacity: 1 !important;
        }

        /* –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–û—Ç–∫—Ä—ã—Ç—å" –∫–æ–≥–¥–∞ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞–∫—Ç–∏–≤–Ω–æ */
        .modal.active ~ .open-btn,
        .modal.active + * + .open-btn,
        body:has(.modal.active) .open-btn {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
        }

        #caseDetailPage.active ~ #openBtn,
        #caseDetailPage.active + #openBtn {
            display: flex !important;
            visibility: visible !important;
            opacity: 1 !important;
        }

        .open-btn:disabled {
            opacity: 0.5 !important;
            cursor: not-allowed !important;
            pointer-events: none !important;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.5) 0%, rgba(118, 75, 162, 0.5) 100%) !important;
            border-color: rgba(255, 255, 255, 0.2) !important;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3) !important;
            transform: none !important;
        }
        
        .open-btn:disabled:hover {
            transform: none !important;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3) !important;
        }

        .spinning {
            animation: spin 0.1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .spinning-prizes {
            animation: shuffle 0.05s linear infinite;
        }

        @keyframes shuffle {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .back-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: #ffffff;
            padding: 10px 20px;
            border-radius: 12px;
            font-size: 14px;
            cursor: pointer;
            margin-bottom: 20px;
        }

        .modal {
            display: none !important;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex !important;
        }

        /* –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–û—Ç–∫—Ä—ã—Ç—å" —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–µ—Ç–∞–ª–µ–π –∫–æ–≥–¥–∞ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞–∫—Ç–∏–≤–Ω–æ */
        .modal.active ~ #openBtn {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            pointer-events: none !important;
        }

        .modal-content {
            background: rgba(26, 26, 46, 0.85);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 40px;
            padding-bottom: 30px;
            text-align: center;
            max-width: 90%;
            width: 100%;
            max-width: 400px;
            animation: scaleIn 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-sizing: border-box;
        }
        
        .modal-content > * {
            width: 100%;
        }
        
        .modal-content .modal-close {
            width: auto !important;
        }

        .inventory-modal-content {
            max-width: 400px;
            width: 90%;
            padding: 30px;
            position: relative;
        }

        .modal-close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: rgba(255, 255, 255, 0.7);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            z-index: 10;
        }

        .modal-close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            color: #ffffff;
        }

        .modal-close-btn:active {
            transform: scale(0.9);
        }

        .inventory-modal-icon {
            width: 150px;
            height: 150px;
            margin: 20px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 20px;
            background: rgba(102, 126, 234, 0.1);
            padding: 20px;
        }

        .inventory-modal-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            display: block;
        }

        .inventory-modal-name {
            font-size: 28px;
            font-weight: 700;
            color: #ffffff;
            text-align: center;
            margin-bottom: 20px;
        }

        .inventory-modal-price {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            margin-bottom: 30px;
        }

        .price-label {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.6);
            font-weight: 500;
        }

        .price-value {
            font-size: 32px;
            font-weight: 700;
            color: #667eea;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .price-value .currency-icon {
            width: 28px;
            height: 28px;
        }

        .inventory-modal-buttons {
            display: flex;
            gap: 12px;
            width: 100%;
        }

        .inventory-modal-btn {
            flex: 1;
            padding: 16px 24px;
            border-radius: 16px;
            border: none;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .inventory-modal-btn.sell-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
        }

        .inventory-modal-btn.sell-btn:active {
            transform: scale(0.98);
            box-shadow: 0 2px 10px rgba(102, 126, 234, 0.3);
        }

        .inventory-modal-btn.close-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            color: rgba(255, 255, 255, 0.8);
        }

        .inventory-modal-btn.close-btn:active {
            transform: scale(0.98);
            background: rgba(255, 255, 255, 0.15);
        }

        @keyframes scaleIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .modal-prize-icon {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-prize-icon img {
            width: 120px;
            height: 120px;
            object-fit: contain;
            display: block;
        }

        .modal-prize-icon-old {
            font-size: 100px;
            margin: 20px 0;
            animation: bounce 0.6s;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-30px); }
        }

        .modal-prize-name {
            font-size: 28px;
            font-weight: 700;
            margin: 20px 0;
            color: #ffffff;
        }

        .modal-prize-value {
            font-size: 24px;
            color: #667eea;
            font-weight: 700;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 6px;
            justify-content: center;
        }
        
        .modal-prize-value .currency-icon {
            width: 20px;
            height: 20px;
        }

        .modal-open-btn {
            display: none !important;
        }
        
        .modal-open-btn:hover {
            transform: translateY(-2px) !important;
            box-shadow: 0 10px 50px rgba(102, 126, 234, 1), 0 0 40px rgba(102, 126, 234, 0.8), inset 0 1px 0 rgba(255, 255, 255, 0.4) !important;
        }
        
        .modal-open-btn:active {
            transform: translateY(0) !important;
        }

        .modal-close {
            background: rgba(255, 255, 255, 0.08) !important;
            color: rgba(255, 255, 255, 0.7) !important;
            border: 2px solid rgba(255, 255, 255, 0.2) !important;
            padding: 10px 25px !important;
            border-radius: 12px !important;
            font-size: 14px !important;
            font-weight: 500 !important;
            cursor: pointer !important;
            width: auto !important;
            min-width: 100px !important;
            max-width: 150px !important;
            margin: 0 auto !important;
            display: block !important;
            box-sizing: border-box !important;
            text-align: center !important;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2) !important;
            transition: all 0.3s !important;
            align-self: center !important;
        }
        
        .modal-close:hover {
            background: rgba(255, 255, 255, 0.15) !important;
            border-color: rgba(255, 255, 255, 0.35) !important;
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3) !important;
        }
        
        .modal-close:active {
            transform: translateY(0);
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(10, 10, 10, 0.98);
            backdrop-filter: blur(20px);
            border-top: 2px solid rgba(255, 255, 255, 0.15);
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            z-index: 100;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.5);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px 20px;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            transition: all 0.3s;
        }

        .nav-item.active {
            color: #667eea;
        }
        
        .nav-item.active .nav-icon {
            transform: scale(1.1);
        }

        .nav-icon {
            font-size: 24px;
        }

        .nav-label {
            font-size: 12px;
            font-weight: 500;
        }

        .profile-page {
            padding: 20px;
            padding-bottom: 120px;
            min-height: 100vh;
        }

        .profile-header {
            text-align: center;
            margin-bottom: 30px;
            margin-top: 20px;
        }

        .profile-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border: 4px solid rgba(255, 255, 255, 0.2);
        }

        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-username {
            font-size: 24px;
            font-weight: 700;
            color: #ffffff;
        }

        .top-up-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            justify-content: center;
        }

        .top-up-btn {
            flex: 1;
            padding: 16px 20px;
            border-radius: 16px;
            border: none;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .top-up-btn.primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .top-up-btn.secondary {
            background: transparent;
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
        }

        .top-up-btn:active {
            transform: scale(0.98);
        }

        .btn-icon {
            font-size: 20px;
        }

        .inventory-section {
            margin-top: 30px;
        }

        .inventory-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .inventory-title {
            font-size: 18px;
            font-weight: 600;
            color: #ffffff;
        }

        .sell-all-btn {
            background: rgba(102, 126, 234, 0.3);
            border: 1px solid rgba(102, 126, 234, 0.5);
            color: #667eea;
            padding: 8px 16px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .sell-all-btn:active {
            transform: scale(0.98);
        }

        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .inventory-slot {
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s;
        }

        .inventory-slot:active {
            transform: scale(0.95);
        }

        .inventory-slot.has-item {
            border-color: rgba(102, 126, 234, 0.5);
            background: rgba(102, 126, 234, 0.1);
        }

        .inventory-slot img {
            width: 80%;
            height: 80%;
            object-fit: contain;
        }

        .inventory-slot .empty-icon {
            font-size: 40px;
            color: rgba(255, 255, 255, 0.3);
        }

        .inventory-slot .next-icon {
            font-size: 30px;
            color: rgba(255, 255, 255, 0.5);
        }

        .inventory-slot .item-value {
            position: absolute;
            bottom: 5px;
            left: 5px;
            right: 5px;
            background: rgba(0, 0, 0, 0.7);
            padding: 4px 6px;
            border-radius: 8px;
            font-size: 10px;
            font-weight: 600;
            color: #00d4ff;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2px;
        }

        .inventory-slot .item-value .currency-icon {
            width: 10px;
            height: 10px;
        }

        .crash-page {
            padding: 20px;
            padding-bottom: 120px;
            min-height: 100vh;
            background: var(--tg-theme-bg-color, #0a0a0a);
        }

        .crash-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .players-count {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(0, 255, 0, 0.2);
            padding: 8px 16px;
            border-radius: 20px;
            color: #00ff00;
            font-weight: 600;
            font-size: 14px;
        }

        .players-icon {
            font-size: 18px;
        }

        .crash-balance {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 16px;
            border-radius: 20px;
        }

        .crash-graph-container {
            width: 100%;
            height: 250px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }

        .crash-graph {
            width: 100%;
            height: 100%;
            position: relative;
        }

        #crashCanvas {
            width: 100%;
            height: 100%;
        }

        .current-multiplier {
            position: absolute;
            top: 15px;
            left: 15px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 20px;
            border-radius: 12px;
            font-size: 24px;
            font-weight: 700;
            color: #00ff00;
            border: 2px solid #00ff00;
        }

        .crash-controls {
            margin-bottom: 20px;
        }

        .multiplier-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .multiplier-btn {
            padding: 10px 16px;
            border-radius: 12px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .multiplier-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: rgba(255, 255, 255, 0.5);
            color: white;
        }

        .multiplier-btn:active {
            transform: scale(0.95);
        }

        .bet-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .bet-type-btn {
            flex: 1;
            padding: 12px 20px;
            border-radius: 12px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: all 0.3s;
        }

        .bet-type-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: rgba(255, 255, 255, 0.5);
            color: white;
        }

        .bet-amount-input,
        .bet-item-select {
            width: 100%;
            padding: 14px 16px;
            border-radius: 12px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            color: white;
            font-size: 16px;
            margin-bottom: 15px;
            box-sizing: border-box;
        }

        .bet-amount-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .bet-amount-input:focus,
        .bet-item-select:focus {
            outline: none;
            border-color: #667eea;
        }

        .make-bet-btn {
            width: 100%;
            padding: 18px;
            border-radius: 16px;
            border: none;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
        }

        .make-bet-btn:active {
            transform: scale(0.98);
        }

        .make-bet-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .bets-list {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
        }

        .bets-list-header {
            font-size: 18px;
            font-weight: 600;
            color: white;
            margin-bottom: 15px;
        }

        .bet-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            margin-bottom: 10px;
        }

        .bet-item-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }

        .bet-item-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .bet-item-username {
            font-size: 14px;
            font-weight: 600;
            color: white;
        }

        .bet-item-details {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .bet-item-winnings {
            font-size: 16px;
            font-weight: 700;
            color: #00ff00;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .bet-item-winnings .currency-icon {
            width: 14px;
            height: 14px;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="profile-section">
            <div class="avatar">üë§</div>
            <div class="username" id="username">User</div>
        </div>
        <div class="balance-section">
            <span class="diamond-icon"></span>
            <span class="balance-text" id="balance">0.00</span>
            <button style="background: transparent; border: none; color: #ffffff; font-size: 18px; cursor: pointer; padding: 0 5px;">+</button>
        </div>
    </div>


    <div id="mainPage">
        <button class="subscribe-btn">
            <div class="subscribe-inner">
                <div class="subscribe-icon"></div>
                <span>–ü–æ–¥–ø–∏—à–∏—Å—å –Ω–∞ –Ω–∞—Å</span>
            </div>
            <div class="subscribe-action">–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è</div>
        </button>

        <div class="tabs">
            <button class="tab active" data-tab="cases">–ö–µ–π—Å—ã</button>
        </div>

        <div class="live-section">
            <div class="live-badge">LIVE</div>
            <div class="live-carousel" id="liveCarousel">
            </div>
        </div>

        <div class="cases-carousel" id="casesCarousel">
            <div class="case-card" data-case="1" data-price="0.1">
                <div class="case-price-badge"><span class="currency-icon"></span> 0.1</div>
                <div class="case-icon"><img src="IconCase/2c0JGQXrElCDlaNGbYHwgipHo2-yq00qIxcU39IganVzrqDys2-no-bg-preview%20%28carve.photos%29.png" alt="Case 1" onerror="console.error('Failed to load image:', this.src)"></div>
                <div class="case-info">
                    <div class="case-name">–ö–µ–π—Å #1</div>
                    <div class="case-description">9 –ø—Ä–µ–¥–º–µ—Ç–æ–≤</div>
                </div>
            </div>
        </div>

        <div class="pagination" style="display: none;">
        </div>
    </div>

    <div class="case-detail-page" id="caseDetailPage" style="display: none;">
        <button class="back-btn" onclick="window.goBack()">‚Üê –ù–∞–∑–∞–¥</button>
        <div class="case-detail-header">
            <div class="case-detail-icon" id="detailIcon"></div>
            <div class="case-detail-price" id="detailPrice"><span class="currency-icon"></span> 2.25</div>
            
            <div class="roulette-container" id="rouletteContainer">
                <div class="roulette-wrapper">
                    <div class="center-indicator"></div>
                    <div class="roulette-track" id="rouletteTrack"></div>
                </div>
            </div>
        </div>

        <div class="whats-inside-title">–ß—Ç–æ –≤–Ω—É—Ç—Ä–∏?</div>
        
        <div class="prizes-grid" id="prizesGrid">
        </div>

    </div>

    <button class="open-btn" id="openBtn" type="button">
        –û—Ç–∫—Ä—ã—Ç—å <span>üöÄ</span>
    </button>

    <div class="modal" id="prizeModal">
        <div class="modal-content">
            <div class="modal-prize-icon" id="modalPrizeIcon">üèÜ</div>
            <div class="modal-prize-name" id="modalPrizeName">–û—Å–∫–∞—Ä</div>
            <div class="modal-prize-value" id="modalPrizeValue"><span class="currency-icon"></span> 82.17</div>
            <button class="modal-close" onclick="closePrizeModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <div class="modal" id="inventoryItemModal">
        <div class="modal-content inventory-modal-content">
            <button class="modal-close-btn" onclick="closeInventoryModal()">‚úï</button>
            <div class="inventory-modal-icon" id="inventoryModalIcon"></div>
            <div class="inventory-modal-name" id="inventoryModalName">–ü—Ä–µ–¥–º–µ—Ç</div>
            <div class="inventory-modal-price">
                <span class="price-label">–¶–µ–Ω–∞:</span>
                <span class="price-value" id="inventoryModalPrice"><span class="currency-icon"></span> 0.00</span>
            </div>
            <div class="inventory-modal-buttons">
                <button class="inventory-modal-btn sell-btn" id="sellItemBtn">–ü—Ä–æ–¥–∞—Ç—å</button>
                <button class="inventory-modal-btn close-btn" onclick="closeInventoryModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <div class="profile-page" id="profilePage" style="display: none;">
        <div class="profile-header">
            <div class="profile-avatar" id="profileAvatar">
                <img id="profileAvatarImg" src="" alt="Avatar" onerror="this.style.display='none'; this.parentElement.innerHTML='üë§';">
            </div>
            <div class="profile-username" id="profileUsername">User</div>
        </div>

        <div class="top-up-buttons">
            <button class="top-up-btn primary">
                <span class="btn-icon"><span class="currency-icon" style="width: 18px; height: 18px; display: inline-block;"></span></span>
                <span>–ü–æ–ø–æ–ª–Ω–∏—Ç—å</span>
            </button>
        </div>

        <div class="inventory-section">
            <div class="inventory-header">
                <span class="inventory-title">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å (<span id="inventoryCount">0</span>)</span>
                <button class="sell-all-btn" id="sellAllBtn">–ü—Ä–æ–¥–∞—Ç—å –≤—Å–µ</button>
            </div>
            <div class="inventory-grid" id="inventoryGrid">
            </div>
        </div>
    </div>

    <div class="crash-page" id="crashPage" style="display: none;">
        <div class="crash-header">
            <div class="players-count">
                <span class="players-icon">üë•</span>
                <span id="playersCount">0</span>
            </div>
            <div class="crash-balance">
                <span class="diamond-icon"></span>
                <span class="balance-text" id="crashBalance">0.00</span>
                <button style="background: transparent; border: none; color: #ffffff; font-size: 18px; cursor: pointer; padding: 0 5px;">+</button>
            </div>
        </div>

        <div class="crash-graph-container">
            <div class="crash-graph" id="crashGraph">
                <canvas id="crashCanvas"></canvas>
                <div class="current-multiplier" id="currentMultiplier">x1.00</div>
            </div>
        </div>

        <div class="crash-controls">
            <div class="multiplier-buttons" id="multiplierButtons">
                <button class="multiplier-btn" data-mult="auto">–ê–≤—Ç–æ</button>
                <button class="multiplier-btn active" data-mult="1.5">x1.5</button>
                <button class="multiplier-btn" data-mult="2.0">x2.0</button>
                <button class="multiplier-btn" data-mult="3.0">x3.0</button>
                <button class="multiplier-btn" data-mult="5.0">x5.0</button>
            </div>
            <div class="bet-buttons">
                <button class="bet-type-btn active" data-type="balance" id="betBalanceBtn">
                    <span class="currency-icon" style="width: 16px; height: 16px; display: inline-block;"></span>
                    <span>–ë–∞–ª–∞–Ω—Å</span>
                </button>
                <button class="bet-type-btn" data-type="item" id="betItemBtn">
                    <span>üéÅ</span>
                    <span>–ü–æ–¥–∞—Ä–æ–∫</span>
                </button>
            </div>
            <input type="number" class="bet-amount-input" id="betAmountInput" placeholder="–°—É–º–º–∞ —Å—Ç–∞–≤–∫–∏" min="0.01" step="0.01">
            <select class="bet-item-select" id="betItemSelect" style="display: none;">
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç</option>
            </select>
            <button class="make-bet-btn" id="makeBetBtn">–°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É</button>
        </div>

        <div class="bets-list" id="betsList">
            <div class="bets-list-header">–ê–∫—Ç–∏–≤–Ω—ã–µ —Å—Ç–∞–≤–∫–∏</div>
        </div>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active" data-page="cases">
            <div class="nav-icon">üéÅ</div>
            <div class="nav-label">–ö–µ–π—Å—ã</div>
        </div>
        <div class="nav-item" data-page="crash">
            <div class="nav-icon">üöÄ</div>
            <div class="nav-label">–ö—Ä–∞—à</div>
        </div>
        <div class="nav-item" data-page="profile">
            <div class="nav-icon">üë§</div>
            <div class="nav-label">–ü—Ä–æ—Ñ–∏–ª—å</div>
        </div>
    </div>

    <script>
        let tg = window.Telegram?.WebApp;
        let isTelegram = false;
        
        if (tg) {
            tg.ready();
            tg.expand();
            tg.setHeaderColor('#0a0a0a');
            tg.setBackgroundColor('#0a0a0a');
            isTelegram = true;
        }

        let balance = 100.00;
        let currentCase = null;
        let currentPrizes = [];
        let isOpening = false;
        let currentTab = 'cases';
        
        // API —ç–Ω–¥–ø–æ–∏–Ω—Ç (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä)
        const API_BASE_URL = 'https://your-api-server.com/api'; // –ó–ê–ú–ï–ù–ò–¢–ï –ù–ê –†–ï–ê–õ–¨–ù–´–ô URL
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤—ã–∏–≥—Ä—ã—à–µ–π –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        let globalPrizes = [];
        
        // –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–≤—ã–∏–≥—Ä–∞–Ω–Ω—ã–µ –ø–æ–¥–∞—Ä–∫–∏)
        let userInventory = [];
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram
        function getUserId() {
            const user = tg?.initDataUnsafe?.user;
            return user?.id || null;
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function getUsername() {
            const user = tg?.initDataUnsafe?.user;
            return user?.username || user?.first_name || 'Unknown';
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Å–µ—Ä–≤–µ—Ä–∞ (–±–∞–ª–∞–Ω—Å –∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å)
        async function loadUserData() {
            const userId = getUserId();
            if (!userId) {
                console.log('User ID not available, using local storage');
                loadInventory();
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/users/${userId}`);
                
                if (response.ok) {
                    const data = await response.json();
                    if (data) {
                        // –ó–∞–≥—Ä—É–∂–∞–µ–º –±–∞–ª–∞–Ω—Å
                        if (data.balance !== undefined) {
                            balance = parseFloat(data.balance) || 100.00;
                            document.getElementById('balance').textContent = balance.toFixed(2);
                        }
                        
                        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
                        if (data.inventory && Array.isArray(data.inventory)) {
                            userInventory = data.inventory;
                            updateInventory();
                        } else {
                            loadInventory();
                        }
                    }
                } else {
                    console.log('Failed to load user data, using local storage');
                    loadInventory();
                }
            } catch (error) {
                console.error('Error loading user data:', error);
                loadInventory();
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä (–±–∞–ª–∞–Ω—Å –∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å)
        async function saveUserData() {
            const userId = getUserId();
            if (!userId) {
                console.log('User ID not available, saving to local storage only');
                saveInventory();
                return;
            }
            
            try {
                const userData = {
                    userId: userId,
                    username: getUsername(),
                    balance: balance,
                    inventory: userInventory,
                    updatedAt: Date.now()
                };
                
                const response = await fetch(`${API_BASE_URL}/users/${userId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(userData)
                });
                
                if (response.ok) {
                    console.log('User data saved successfully');
                    // –¢–∞–∫–∂–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ –¥–ª—è –æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–∞
                    saveInventory();
                } else {
                    console.error('Failed to save user data to server');
                    saveInventory();
                }
            } catch (error) {
                console.error('Error saving user data:', error);
                // –ü—Ä–∏ –æ—à–∏–±–∫–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
                saveInventory();
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è –∏–∑ localStorage
        function loadInventory() {
            try {
                const stored = localStorage.getItem('userInventory');
                const storedBalance = localStorage.getItem('userBalance');
                
                if (stored) {
                    userInventory = JSON.parse(stored);
                } else {
                    userInventory = [];
                }
                
                if (storedBalance) {
                    balance = parseFloat(storedBalance) || 100.00;
                    document.getElementById('balance').textContent = balance.toFixed(2);
                }
                
                updateInventory();
            } catch (e) {
                console.error('Failed to load inventory:', e);
                userInventory = [];
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è –≤ localStorage
        function saveInventory() {
            try {
                localStorage.setItem('userInventory', JSON.stringify(userInventory));
                localStorage.setItem('userBalance', balance.toString());
            } catch (e) {
                console.error('Failed to save inventory:', e);
            }
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–∞—Ä–∫–∞ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
        function addToInventory(prize) {
            userInventory.push({
                icon: prize.icon,
                name: prize.name,
                value: prize.value,
                timestamp: Date.now(),
                id: Date.now() + Math.random()
            });
            saveInventory();
            saveUserData(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            updateInventory();
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ü–µ–Ω—ã —Å –∏–∫–æ–Ω–∫–æ–π –≤–∞–ª—é—Ç—ã
        function formatPrice(value) {
            return `<span class="currency-icon"></span>${value.toFixed(2)}`;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤—ã–∏–≥—Ä—ã—à–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        async function sendPrizeToServer(prize) {
            try {
                const user = tg?.initDataUnsafe?.user;
                const userId = user?.id || null;
                const username = user?.username || user?.first_name || 'Unknown';
                
                const response = await fetch(`${API_BASE_URL}/prizes`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        userId: userId,
                        username: username,
                        icon: prize.icon,
                        name: prize.name,
                        value: prize.value,
                        timestamp: Date.now()
                    })
                });
                
                if (response.ok) {
                    console.log('Prize sent to server successfully');
                    return true;
                } else {
                    console.error('Failed to send prize to server');
                    return false;
                }
            } catch (error) {
                console.error('Error sending prize to server:', error);
                // –ü—Ä–∏ –æ—à–∏–±–∫–µ –¥–æ–±–∞–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ (fallback)
                addPrizeLocally(prize);
                return false;
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –≤—ã–∏–≥—Ä—ã—à–µ–π —Å —Å–µ—Ä–≤–µ—Ä–∞
        async function fetchGlobalPrizes() {
            try {
                const response = await fetch(`${API_BASE_URL}/prizes?limit=50`);
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.prizes && Array.isArray(data.prizes)) {
                        globalPrizes = data.prizes;
                        updateLiveCarousel();
                        return true;
                    }
                } else {
                    console.error('Failed to fetch prizes from server');
                    loadPrizesFromLocalStorage();
                    return false;
                }
            } catch (error) {
                console.error('Error fetching prizes from server:', error);
                loadPrizesFromLocalStorage();
                return false;
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–∞—Ä–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ (fallback)
        function addPrizeLocally(prize) {
            globalPrizes.push({
                icon: prize.icon,
                name: prize.name,
                value: prize.value,
                timestamp: Date.now()
            });
            
            if (globalPrizes.length > 50) {
                globalPrizes.shift();
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–µ–∂–¥—É –≤–∫–ª–∞–¥–∫–∞–º–∏
            try {
                localStorage.setItem('globalPrizes', JSON.stringify(globalPrizes));
            } catch (e) {
                console.error('Failed to save to localStorage:', e);
            }
            
            updateLiveCarousel();
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–¥–∞—Ä–∫–æ–≤ –∏–∑ localStorage
        function loadPrizesFromLocalStorage() {
            try {
                const stored = localStorage.getItem('globalPrizes');
                if (stored) {
                    globalPrizes = JSON.parse(stored);
                    updateLiveCarousel();
                } else {
                    // –ù–∞—á–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –ø–æ–¥–∞—Ä–∫–æ–≤
                    globalPrizes = [
                        { icon: 'ItemCase1/_Jne2Jf3nM6erEUU5TEnvU7PWFOiElGs2WJc0zQ250JHxRd6md_v1huDDCpZRSesDCZP53pWDPEnqfojbzsYqjbD.png', name: '–õ–æ–ª–∏ –ø–æ–ø', value: 82.17 },
                        { icon: 'ItemCase1/4dOUEOHs9WSNk5pRBkEnCptGIs16lB5xe4E7mh3sWF6XAkHcwQvINscw7cXwhK5IUXv5eOdct9_vxDZtoaMTm8GJ.png', name: '–ë–∞–±–æ—á–∫–∞', value: 75.66 },
                        { icon: 'ItemCase1/GsJZ-oPiqQHoyerbmc-z_L_NTi8cBWgKmS9ueEOwk5_PHeYbWeRwn6Jxic2d1Yhl8IZwt0rBUg5ZfvrkYkYp0UrO.png', name: '–ó–µ–ª—å–µ', value: 69.30 },
                        { icon: 'ItemCase1/qlq8mJd7J1-60XWhd29rLbtjBfzeXSPLMVgzkcBDTNfHL50TBMHG2B0h2jB1bAd-rJWlHO1NtkI0zAsWF4BgcVHn.png', name: '–®–ª–µ–º', value: 25.27 },
                        { icon: 'ItemCase1/QrKwYOzBzIX1ilzkfuCuiFdyCRU9jBm5pASbp_z2Sb6ATFNaaB1Zr1XfNGehXeHTYhldZNO8x4_l0ueW2t4MZ62W.png', name: '–°–∏–≥–∞—Ä–∞', value: 23.50 }
                    ];
                    updateLiveCarousel();
                }
            } catch (e) {
                console.error('Failed to load from localStorage:', e);
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            const mainPage = document.getElementById('mainPage');
            const detailPage = document.getElementById('caseDetailPage');
            const profilePage = document.getElementById('profilePage');
            
            mainPage.style.display = 'block';
            mainPage.classList.remove('hidden');
            detailPage.style.display = 'none';
            detailPage.classList.remove('active');
            if (profilePage) {
                profilePage.style.display = 'none';
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–¥–∞—Ä–∫–∏ —Å —Å–µ—Ä–≤–µ—Ä–∞ –∏–ª–∏ –∏–∑ localStorage
            fetchGlobalPrizes();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–±–∞–ª–∞–Ω—Å –∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å) —Å —Å–µ—Ä–≤–µ—Ä–∞
            loadUserData();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø—Ä–æ—Ñ–∏–ª—è
            updateProfileInfo();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ–¥–∞—Ä–∫–æ–≤ –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã
            setInterval(() => {
                fetchGlobalPrizes();
            }, 3000);
            
            // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ localStorage (–¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–µ–∂–¥—É –≤–∫–ª–∞–¥–∫–∞–º–∏)
            window.addEventListener('storage', (e) => {
                if (e.key === 'globalPrizes') {
                    loadPrizesFromLocalStorage();
                }
                if (e.key === 'userInventory') {
                    loadInventory();
                }
            });
        });


        // –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ö–ï–ô–°–ê #1
        const case1Config = {
            // –ò–∫–æ–Ω–∫–∞ –∫–µ–π—Å–∞ (–ø—É—Ç—å –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é)
            icon: 'IconCase/2c0JGQXrElCDlaNGbYHwgipHo2-yq00qIxcU39IganVzrqDys2-no-bg-preview%20%28carve.photos%29.png',
            // –¶–µ–Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–µ–π—Å–∞
            price: 0.1,
            // –°–ø–∏—Å–æ–∫ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –≤ –∫–µ–π—Å–µ
            // –§–æ—Ä–º–∞—Ç: { icon: '–ø—É—Ç—å –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é', name: '–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞', value: —Ü–µ–Ω–∞ }
            items: [
                { icon: 'ItemCase1/_Jne2Jf3nM6erEUU5TEnvU7PWFOiElGs2WJc0zQ250JHxRd6md_v1huDDCpZRSesDCZP53pWDPEnqfojbzsYqjbD.png', name: '–õ–æ–ª–∏ –ø–æ–ø', value: 82.17 },
                { icon: 'ItemCase1/4dOUEOHs9WSNk5pRBkEnCptGIs16lB5xe4E7mh3sWF6XAkHcwQvINscw7cXwhK5IUXv5eOdct9_vxDZtoaMTm8GJ.png', name: '–ë–∞–±–æ—á–∫–∞', value: 75.66 },
                { icon: 'ItemCase1/GsJZ-oPiqQHoyerbmc-z_L_NTi8cBWgKmS9ueEOwk5_PHeYbWeRwn6Jxic2d1Yhl8IZwt0rBUg5ZfvrkYkYp0UrO.png', name: '–ó–µ–ª—å–µ', value: 69.30 },
                { icon: 'ItemCase1/qlq8mJd7J1-60XWhd29rLbtjBfzeXSPLMVgzkcBDTNfHL50TBMHG2B0h2jB1bAd-rJWlHO1NtkI0zAsWF4BgcVHn.png', name: '–®–ª–µ–º', value: 25.27 },
                { icon: 'ItemCase1/QrKwYOzBzIX1ilzkfuCuiFdyCRU9jBm5pASbp_z2Sb6ATFNaaB1Zr1XfNGehXeHTYhldZNO8x4_l0ueW2t4MZ62W.png', name: '–°–∏–≥–∞—Ä–∞', value: 23.50 },
                { icon: 'ItemCase1/R1v8ymGGn2ZBo6cI96QvcWu5Yh2FsyiAmDW_WTGMfz7CMvELAOFCf7I7Ns2XGdKv1AxHTvrioJ6h-ALjrzjxb7Ra.png', name: '–ö–æ–ª—å—Ü–æ', value: 17.00 },
                { icon: 'ItemCase1/XQTRb7Jx7OBjYfqnitHsZGV9pmln2Nhr9n5oYkJvZsF_dtkAYxPHS8Npi_qa6Pxcx0o368YwkcY9uRHmabTE5-LS.png', name: '–ë–∞–±–æ—á–∫–∞', value: 11.40 },
                { icon: 'ItemCase1/Y6HIRzDSCdUNCqWtHRsCpePjILr5QyrOnOD0T9PtrYjgu3Ff3XVbLGxLT1snsWyNNMzfDvTlhms0y1_Wwev6tz9-.png', name: '–ó–µ–ª—å–µ', value: 8.64 },
                { icon: 'ItemCase1/YLHOesDBQxjSVcanvj-iKz2mgFXRfweB38vb951G5LvwfJ8ytmlfe3PFUk3k_AgekpyW9A3uIpzEjM87k6_aUVS1.png', name: '–¶–≤–µ—Ç–æ–∫', value: 7.90 }
            ]
        };

        // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ —Ñ–æ—Ä–º–∞—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        const cases = {
            1: {
                icon: case1Config.icon,
                price: case1Config.price,
                prizes: case1Config.items
            }
        };
        
        // ==========================================
        // –ö–û–ù–ï–¶ –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò
        // ==========================================

        document.getElementById('balance').textContent = balance.toFixed(2);

        // –°–∫—Ä—ã–≤–∞–µ–º –Ω–∞–¥–ø–∏—Å—å "5 TON Demo"
        const tonBalance = document.querySelector('.ton-balance');
        if (tonBalance) {
            tonBalance.style.display = 'none';
            tonBalance.style.visibility = 'hidden';
            tonBalance.style.opacity = '0';
            tonBalance.style.height = '0';
            tonBalance.style.margin = '0';
            tonBalance.style.padding = '0';
        }

        const user = tg?.initDataUnsafe?.user;
        if (user) {
            document.getElementById('username').textContent = user.first_name || 'User';
        }

        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                currentTab = tab.dataset.tab;
            });
        });

        document.querySelectorAll('.case-card').forEach(card => {
            card.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                const caseNum = parseInt(card.dataset.case);
                if (!isOpening) {
                    showCaseDetail(caseNum);
                }
            });
        });

        window.openCase = function() {
            if (currentCase && !isOpening) {
                const openCaseFunc = function() {
                    if (isOpening) return;
                    
                    const price = currentCase.price;
                    if (balance < price) {
                        if (tg) {
                            tg.showAlert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–ª–∞–Ω—Å–∞!');
                            tg.HapticFeedback.notificationOccurred('error');
                        } else {
                            alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–ª–∞–Ω—Å–∞!');
                        }
                        return;
                    }

                    isOpening = true;
                    balance -= price;
                    document.getElementById('balance').textContent = balance.toFixed(2);
                    saveInventory(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –±–∞–ª–∞–Ω—Å –ª–æ–∫–∞–ª—å–Ω–æ
                    saveUserData(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –±–∞–ª–∞–Ω—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                    
                    const detailIcon = document.getElementById('detailIcon');
                    const rouletteContainer = document.getElementById('rouletteContainer');
                    const openBtn = document.getElementById('openBtn');
                    
                    // –ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –ø—Ä–∏ –Ω–∞—á–∞–ª–µ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
                    openBtn.classList.remove('show');
                    openBtn.style.cssText = 'display: none !important;';
                    openBtn.disabled = true;
                    
                    // –°–∫—Ä—ã–≤–∞–µ–º –∏–∫–æ–Ω–∫—É —Ç–æ–ª—å–∫–æ –≤–æ –≤—Ä–µ–º—è —Ä—É–ª–µ—Ç–∫–∏
                    detailIcon.style.display = 'none';
                    
                    // –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–µ–º —Ä—É–ª–µ—Ç–∫—É, –ø–æ—Ç–æ–º –ø–æ–∫–∞–∑—ã–≤–∞–µ–º
                    createRoulette();
                    
                    // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–∏–¥–∏–º
                    rouletteContainer.style.display = 'block';
                    rouletteContainer.classList.add('active');

                    if (tg) {
                        tg.HapticFeedback.impactOccurred('heavy');
                    }
                    
                    // –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –æ—Ç—Ä–∏—Å–æ–≤–∫—É —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø–µ—Ä–µ–¥ –∞–Ω–∏–º–∞—Ü–∏–µ–π
                    setTimeout(() => {
                        // –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –ø—Ä–∏–∑ –∏–∑ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö
                        const randomPrize = currentPrizes[Math.floor(Math.random() * currentPrizes.length)];
                        const rouletteTrack = document.getElementById('rouletteTrack');
                        const giftItems = rouletteTrack.querySelectorAll('.gift-item');
                        
                        // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –≤–∏–¥–Ω—ã –°–†–ê–ó–£
                        giftItems.forEach(item => {
                            item.style.opacity = '1';
                            item.style.visibility = 'visible';
                            item.style.display = 'flex';
                        });
                        
                        const itemWidth = 150 + 20; // 150px —à–∏—Ä–∏–Ω–∞ + 20px gap
                        const containerWidth = rouletteContainer.offsetWidth;
                        
                        // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ –ø–æ–¥–∞—Ä–∫–∏ —Å –Ω—É–∂–Ω—ã–º –∏–∫–æ–Ω–æ–º (–∏–∫–æ–Ω–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø—Ä–∏–∑–∞)
                        const matchingIndices = [];
                        for (let i = 0; i < giftItems.length; i++) {
                            if (giftItems[i].dataset.icon === randomPrize.icon && 
                                giftItems[i].dataset.name === randomPrize.name) {
                                matchingIndices.push(i);
                            }
                        }
                        
                        // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –∏–Ω–¥–µ–∫—Å –∏–∑ —Å–µ—Ä–µ–¥–∏–Ω—ã –º–∞—Å—Å–∏–≤–∞ –¥–ª—è –ø–ª–∞–≤–Ω–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
                        let targetIndex;
                        if (matchingIndices.length > 0) {
                            const midPoint = Math.floor(giftItems.length / 2);
                            const candidates = matchingIndices.filter(idx => 
                                idx > midPoint - giftItems.length / 4 && 
                                idx < midPoint + giftItems.length / 4
                            );
                            targetIndex = candidates.length > 0 
                                ? candidates[Math.floor(Math.random() * candidates.length)]
                                : matchingIndices[Math.floor(matchingIndices.length / 2)];
                        } else {
                            // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ, –≤—ã–±–∏—Ä–∞–µ–º –∏–∑ —Å–µ—Ä–µ–¥–∏–Ω—ã
                            targetIndex = Math.floor(giftItems.length / 2);
                        }
                        
                        // –†–∞—Å—á–µ—Ç –ø–æ–∑–∏—Ü–∏–π
                        // –¢—Ä–µ–∫ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ —á–µ—Ä–µ–∑ left: 50% –∏ transform: translate(-50%, -50%)
                        // –ü–æ—ç—Ç–æ–º—É –ø–æ–∑–∏—Ü–∏—è 0 = —Ü–µ–Ω—Ç—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
                        // –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è = –¥–≤–∏–∂–µ–Ω–∏–µ –≤–ª–µ–≤–æ, –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ = –≤–ø—Ä–∞–≤–æ
                        
                        // –¶–µ–ª–µ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è: —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫
                        const targetItemCenter = targetIndex * itemWidth + itemWidth / 2;
                        const totalTrackWidth = giftItems.length * itemWidth;
                        const targetItemOffset = targetItemCenter - totalTrackWidth / 2;
                        
                        // –ù–∞—á–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è: –¥–æ–±–∞–≤–ª—è–µ–º –º–Ω–æ–≥–æ –ø—Ä–æ–∫—Ä—É—Ç–æ–∫ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞
                        const spins = 15;
                        const extraDistance = spins * currentPrizes.length * itemWidth;
                        const startPosition = targetItemOffset + extraDistance;
                        
                        // –§–∏–Ω–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è: —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫
                        const finalPosition = targetItemOffset;
                        
                        const spinDuration = 4000;
                        
                        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é
                        rouletteTrack.style.left = '50%';
                        rouletteTrack.style.top = '50%';
                        rouletteTrack.style.transform = `translate(calc(-50% + ${startPosition}px), -50%)`;
                        rouletteTrack.style.transition = 'none';
                        rouletteTrack.style.display = 'flex';
                        rouletteTrack.style.visibility = 'visible';
                        rouletteTrack.style.opacity = '1';
                        rouletteTrack.style.position = 'absolute';
                        rouletteTrack.style.marginTop = '0';
                        rouletteTrack.style.marginBottom = '0';
                        
                        let startTime = Date.now();
                        const animateRoulette = () => {
                            const elapsed = Date.now() - startTime;
                            const progress = Math.min(elapsed / spinDuration, 1);
                            
                            // –ü—Ä–æ—Å—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–º–µ–¥–ª–µ–Ω–∏—è
                            const ease = 1 - Math.pow(1 - progress, 3);
                            const currentOffset = startPosition + (finalPosition - startPosition) * ease;
                            
                            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—é - —Ç—Ä–µ–∫ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω, —Å–º–µ—â–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–æ X, Y –≤—Å–µ–≥–¥–∞ -50%
                            rouletteTrack.style.transform = `translate(calc(-50% + ${currentOffset}px), -50%)`;
                            rouletteTrack.style.top = '50%';
                            rouletteTrack.style.marginTop = '0';
                            rouletteTrack.style.marginBottom = '0';
                            
                            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –∏ –í–°–ï–ì–î–ê –¥–µ–ª–∞–µ–º –≤—Å–µ –≤–∏–¥–∏–º—ã–º–∏
                            giftItems.forEach((item, index) => {
                                // –í–ê–ñ–ù–û: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –¥–µ–ª–∞–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –≤–∏–¥–∏–º—ã–º–∏ –Ω–∞ –∫–∞–∂–¥–æ–º –∫–∞–¥—Ä–µ
                                item.style.cssText = `
                                    opacity: 1 !important;
                                    visibility: visible !important;
                                    display: flex !important;
                                    transition: none !important;
                                    flex-shrink: 0 !important;
                                    width: 150px !important;
                                    min-width: 150px !important;
                                    max-width: 150px !important;
                                    height: 150px !important;
                                    position: relative !important;
                                    top: 0 !important;
                                    margin: 0 !important;
                                    padding: 0 !important;
                                    vertical-align: top !important;
                                `;
                                
                                // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ —Ç–æ–∂–µ –≤–∏–¥–∏–º—ã
                                const images = item.querySelectorAll('img');
                                images.forEach(img => {
                                    img.style.cssText = `
                                        opacity: 1 !important;
                                        visibility: visible !important;
                                        display: block !important;
                                        width: 80px !important;
                                        height: 80px !important;
                                    `;
                                });
                                
                                // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ —Ç–µ–∫—Å—Ç —Ç–æ–∂–µ –≤–∏–¥–∏–º
                                const textElements = item.querySelectorAll('.gift-name');
                                textElements.forEach(text => {
                                    text.style.cssText = `
                                        opacity: 1 !important;
                                        visibility: visible !important;
                                    `;
                                });
                                
                                // –†–∞—Å—á–µ—Ç –ø–æ–∑–∏—Ü–∏–∏ —ç–ª–µ–º–µ–Ω—Ç–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ü–µ–Ω—Ç—Ä–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
                                // –¢—Ä–µ–∫ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω, –ø–æ—ç—Ç–æ–º—É —Ü–µ–Ω—Ç—Ä —Ç—Ä–µ–∫–∞ = —Ü–µ–Ω—Ç—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
                                // –ü–æ–∑–∏—Ü–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞ = –µ–≥–æ offset –æ—Ç –Ω–∞—á–∞–ª–∞ —Ç—Ä–µ–∫–∞ - –ø–æ–ª–æ–≤–∏–Ω–∞ —à–∏—Ä–∏–Ω—ã —Ç—Ä–µ–∫–∞ + —Ç–µ–∫—É—â–µ–µ —Å–º–µ—â–µ–Ω–∏–µ
                                const itemOffset = index * itemWidth + itemWidth / 2;
                                const totalTrackWidth = giftItems.length * itemWidth;
                                const itemCenter = itemOffset - totalTrackWidth / 2 + currentOffset;
                                const distance = Math.abs(itemCenter);
                                
                                if (distance < itemWidth / 2) {
                                    item.classList.add('selected');
                                } else {
                                    item.classList.remove('selected');
                                }
                            });
                            
                            if (progress < 1) {
                                requestAnimationFrame(animateRoulette);
                            } else {
                                // –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –±—ã–ª –≤—ã–¥–µ–ª–µ–Ω –≤ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–æ–º–µ–Ω—Ç –∞–Ω–∏–º–∞—Ü–∏–∏
                                // (—Ç–æ—Ç, —É –∫–æ—Ç–æ—Ä–æ–≥–æ –∫–ª–∞—Å—Å 'selected' –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)
                                let selectedItem = null;
                                
                                // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —ç–ª–µ–º–µ–Ω—Ç —Å –∫–ª–∞—Å—Å–æ–º selected
                                giftItems.forEach(item => {
                                    if (item.classList.contains('selected')) {
                                        selectedItem = item;
                                    }
                                });
                                
                                // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–∞—Å—á–µ—Ç –ø–æ –ø–æ–∑–∏—Ü–∏–∏
                                if (!selectedItem) {
                                    let minDistance = Infinity;
                                    const centerX = 0;
                                    
                                    giftItems.forEach((item, index) => {
                                        const itemOffset = index * itemWidth + itemWidth / 2;
                                        const totalTrackWidth = giftItems.length * itemWidth;
                                        const itemCenter = itemOffset - totalTrackWidth / 2 + finalPosition;
                                        const distance = Math.abs(itemCenter - centerX);
                                        
                                        if (distance < minDistance) {
                                            minDistance = distance;
                                            selectedItem = item;
                                        }
                                    });
                                }
                                
                                // –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –Ω–µ –Ω–∞—à–ª–∏, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ü–µ–ª–µ–≤–æ–π —ç–ª–µ–º–µ–Ω—Ç
                                if (!selectedItem) {
                                    selectedItem = giftItems[targetIndex];
                                }
                                
                                setTimeout(() => {
                                    giftItems.forEach(item => item.classList.remove('selected'));
                                    
                                    if (selectedItem) {
                                        selectedItem.classList.add('selected');
                                        
                                        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏–∑–∞ –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –∏–∑ —ç–ª–µ–º–µ–Ω—Ç–∞
                                        const actualPrize = {
                                            icon: selectedItem.dataset.icon || '',
                                            name: selectedItem.dataset.name || '',
                                            value: parseFloat(selectedItem.dataset.value) || 0
                                        };
                                        
                                        // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –ø—É—Å—Ç—ã–µ, –±–µ—Ä–µ–º –∏–∑ randomPrize
                                        if (!actualPrize.name || !actualPrize.icon) {
                                            actualPrize.icon = randomPrize.icon;
                                            actualPrize.name = randomPrize.name;
                                            actualPrize.value = randomPrize.value;
                                        }
                                        
                                        console.log('=== PRIZE SELECTION ===');
                                        console.log('Selected item dataset:', {
                                            icon: selectedItem.dataset.icon,
                                            name: selectedItem.dataset.name,
                                            value: selectedItem.dataset.value
                                        });
                                        console.log('Final prize:', actualPrize.name);
                                        console.log('Target prize:', randomPrize.name);
                                        
                                        setTimeout(() => {
                                            showPrizeModal(actualPrize);
                                            
                                            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–∫–æ–Ω–∫—É –∫–µ–π—Å–∞
                                            if (currentCase && (currentCase.icon.includes('.png') || currentCase.icon.includes('.jpg') || currentCase.icon.includes('.jpeg'))) {
                                                const img = document.createElement('img');
                                                img.src = currentCase.icon;
                                                img.alt = 'Case';
                                                img.style.width = '100%';
                                                img.style.maxWidth = '300px';
                                                img.style.height = 'auto';
                                                img.style.objectFit = 'contain';
                                                img.style.display = 'block';
                                                img.onerror = function() {
                                                    detailIcon.textContent = 'üîê';
                                                };
                                                detailIcon.innerHTML = '';
                                                detailIcon.appendChild(img);
                                            }
                                            detailIcon.style.display = 'flex';
                                            
                                            rouletteContainer.classList.remove('active');
                                            isOpening = false;
                                            
                                            if (tg) {
                                                tg.HapticFeedback.notificationOccurred('success');
                                            }
                                        }, 500);
                                    }
                                }, 300);
                            }
                        };
                        
                        requestAnimationFrame(animateRoulette);
                    }, 300);
                };
                openCaseFunc();
            }
        };

        function createRoulette() {
            const rouletteTrack = document.getElementById('rouletteTrack');
            rouletteTrack.innerHTML = '';
            
            // –°–æ–∑–¥–∞–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π –¥–ª—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
            // –ü–æ–≤—Ç–æ—Ä—è–µ–º –ø–æ–¥–∞—Ä–∫–∏ –æ—á–µ–Ω—å –º–Ω–æ–≥–æ —Ä–∞–∑ –≤ —Ç–æ–π –∂–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
            const repeatCount = 50; // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –¥–æ 50 –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
            const extendedPrizes = [];
            for (let i = 0; i < repeatCount; i++) {
                extendedPrizes.push(...currentPrizes);
            }
            
            extendedPrizes.forEach((prize, index) => {
                const giftItem = document.createElement('div');
                giftItem.className = 'gift-item';
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∏–∫–æ–Ω–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
                const iconStr = String(prize.icon || '');
                if (iconStr.toLowerCase().includes('.png') || iconStr.toLowerCase().includes('.jpg') || iconStr.toLowerCase().includes('.jpeg')) {
                    const img = document.createElement('img');
                    img.src = prize.icon;
                    img.alt = prize.name;
                    
                    // –ñ–µ—Å—Ç–∫–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è - –≤—Å–µ–≥–¥–∞ –≤–∏–¥–∏–º–æ–µ
                    img.style.cssText = `
                        width: 80px !important;
                        height: 80px !important;
                        object-fit: contain !important;
                        display: block !important;
                        visibility: visible !important;
                        opacity: 1 !important;
                        pointer-events: auto !important;
                        transition: none !important;
                        position: relative !important;
                    `;
                    
                    img.onload = function() {
                        this.style.opacity = '1';
                        this.style.visibility = 'visible';
                        this.style.display = 'block';
                        console.log('Gift image loaded:', this.src);
                    };
                    
                    img.onerror = function() {
                        console.error('Failed to load gift image:', this.src);
                        this.style.display = 'none';
                    };
                    
                    const nameDiv = document.createElement('div');
                    nameDiv.className = 'gift-name';
                    nameDiv.textContent = prize.name;
                    nameDiv.style.cssText = `
                        opacity: 1 !important;
                        visibility: visible !important;
                    `;
                    
                    giftItem.appendChild(img);
                    giftItem.appendChild(nameDiv);
                } else {
                    giftItem.innerHTML = `
                        ${prize.icon || '?'}
                        <div class="gift-name">${prize.name}</div>
                    `;
                }
                
                giftItem.dataset.icon = prize.icon;
                giftItem.dataset.name = prize.name;
                giftItem.dataset.value = prize.value;
                
                // –ñ–µ—Å—Ç–∫–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –≤–∏–¥–∏–º–æ—Å—Ç–∏
                giftItem.style.cssText = `
                    flex-shrink: 0 !important;
                    visibility: visible !important;
                    opacity: 1 !important;
                    display: flex !important;
                    pointer-events: auto !important;
                    transition: none !important;
                    position: relative !important;
                    z-index: 2 !important;
                    width: 150px !important;
                    min-width: 150px !important;
                    max-width: 150px !important;
                    height: 150px !important;
                `;
                
                rouletteTrack.appendChild(giftItem);
            });
            
            // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ —Ç—Ä–µ–∫ –≤–∏–¥–∏–º
            rouletteTrack.style.cssText = `
                display: flex !important;
                visibility: visible !important;
                opacity: 1 !important;
            `;
        }

        function showCaseDetail(caseNum) {
            if (isOpening) return;
            
            currentCase = cases[caseNum];
            if (!currentCase) return;

            isOpening = false;
            
            const mainPage = document.getElementById('mainPage');
            const detailPage = document.getElementById('caseDetailPage');
            const modal = document.getElementById('prizeModal');
            const profilePage = document.getElementById('profilePage');
            
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∫—Ä–æ–º–µ –¥–µ—Ç–∞–ª–µ–π –∫–µ–π—Å–∞
            mainPage.style.display = 'none';
            mainPage.classList.add('hidden');
            if (profilePage) {
                profilePage.style.display = 'none';
            }
            
            detailPage.style.display = 'block';
            detailPage.classList.add('active');
            
            modal.style.display = 'none';
            modal.classList.remove('active');
            
            const detailIcon = document.getElementById('detailIcon');
            if (currentCase.icon.includes('.jpg') || currentCase.icon.includes('.png') || currentCase.icon.includes('.jpeg')) {
                // –î–µ–∫–æ–¥–∏—Ä—É–µ–º –ø—É—Ç—å –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
                let imgPath = currentCase.icon;
                // –ï—Å–ª–∏ –ø—É—Ç—å —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ –Ω–∞–ø—Ä—è–º—É—é
                detailIcon.innerHTML = '';
                const img = document.createElement('img');
                img.src = imgPath;
                img.alt = `Case ${caseNum}`;
                img.style.width = '100%';
                img.style.maxWidth = '300px';
                img.style.height = 'auto';
                img.style.objectFit = 'contain';
                img.style.display = 'block';
                img.onload = function() {
                    console.log('Image loaded successfully:', this.src);
                };
                img.onerror = function() {
                    console.error('Failed to load detail image:', this.src);
                    // –ü–æ–ø—Ä–æ–±—É–µ–º –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å –ø—É—Ç—å
                    try {
                        const decodedPath = decodeURIComponent(imgPath);
                        if (decodedPath !== imgPath) {
                            this.src = decodedPath;
                        } else {
                            detailIcon.textContent = 'üîê';
                        }
                    } catch(e) {
                        detailIcon.textContent = 'üîê';
                    }
                };
                detailIcon.appendChild(img);
            } else {
                detailIcon.textContent = currentCase.icon || 'üîê';
            }
            detailIcon.style.display = 'flex';
            document.getElementById('detailPrice').innerHTML = formatPrice(currentCase.price);
            
            const rouletteContainer = document.getElementById('rouletteContainer');
            rouletteContainer.classList.remove('active');
            
            const prizesGrid = document.getElementById('prizesGrid');
            prizesGrid.innerHTML = '';
            currentPrizes = currentCase.prizes;
            
            currentPrizes.forEach(prize => {
                const prizeItem = document.createElement('div');
                prizeItem.className = 'prize-item';
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∏–∫–æ–Ω–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
                const iconDiv = document.createElement('div');
                iconDiv.className = 'prize-icon';
                
                const iconStr = String(prize.icon || '');
                if (iconStr.toLowerCase().includes('.png') || iconStr.toLowerCase().includes('.jpg') || iconStr.toLowerCase().includes('.jpeg')) {
                    const img = document.createElement('img');
                    
                    // –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –ø—É—Ç–∏
                    const tryLoadImage = (src) => {
                        img.src = src;
                        img.alt = prize.name || 'Prize';
                        img.style.width = '60px';
                        img.style.height = '60px';
                        img.style.objectFit = 'contain';
                        img.style.display = 'block';
                        
                        img.onload = function() {
                            console.log('Prize image loaded:', this.src);
                        };
                        
                        img.onerror = function() {
                            console.error('Failed to load prize image:', this.src);
                            // –ü—Ä–æ–±—É–µ–º –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å –ø—É—Ç—å
                            try {
                                const decodedPath = decodeURIComponent(src);
                                if (decodedPath !== src) {
                                    this.src = decodedPath;
                                    return;
                                }
                            } catch(e) {}
                            
                            // –ü—Ä–æ–±—É–µ–º –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å –ø—É—Ç—å
                            try {
                                const encodedPath = encodeURI(src);
                                if (encodedPath !== src) {
                                    this.src = encodedPath;
                                    return;
                                }
                            } catch(e) {}
                            
                            // –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–ª–æ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ
                            this.style.display = 'none';
                            const textNode = document.createTextNode(prize.name || '?');
                            if (this.parentElement) {
                                this.parentElement.appendChild(textNode);
                            }
                        };
                        
                        iconDiv.appendChild(img);
                    };
                    
                    tryLoadImage(prize.icon);
                } else {
                    iconDiv.textContent = prize.icon || '?';
                }
                
                prizeItem.appendChild(iconDiv);
                
                const valueDiv = document.createElement('div');
                valueDiv.className = 'prize-value';
                valueDiv.innerHTML = formatPrice(prize.value);
                prizeItem.appendChild(valueDiv);
                
                prizeItem.dataset.icon = prize.icon;
                prizeItem.dataset.name = prize.name;
                prizeItem.dataset.value = prize.value;
                prizeItem.classList.remove('win');
                prizesGrid.appendChild(prizeItem);
            });

            const openBtn = document.getElementById('openBtn');
            if (openBtn) {
                openBtn.disabled = false;
                openBtn.classList.add('show');
                openBtn.style.cssText = 'display: flex !important; visibility: visible !important; opacity: 1 !important; position: fixed !important; bottom: 100px !important; left: 20px !important; right: 20px !important; z-index: 99999 !important;';
                openBtn.innerHTML = '–û—Ç–∫—Ä—ã—Ç—å <span>üöÄ</span>';
                
                openBtn.onclick = function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    if (currentCase && !isOpening) {
                        window.openCase();
                    }
                };
            } else {
                console.error('Open button not found!');
            }

            document.querySelectorAll('.prize-item').forEach(item => {
                item.classList.remove('win', 'spinning-prizes');
            });

            if (tg) {
                tg.HapticFeedback.impactOccurred('medium');
            }
        }

        function goBack() {
            const mainPage = document.getElementById('mainPage');
            const detailPage = document.getElementById('caseDetailPage');
            const modal = document.getElementById('prizeModal');
            const openBtn = document.getElementById('openBtn');
            
            detailPage.style.display = 'none';
            detailPage.classList.remove('active');
            
            // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–û—Ç–∫—Ä—ã—Ç—å" –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –Ω–∞–∑–∞–¥
            if (openBtn) {
                openBtn.classList.remove('show');
                openBtn.style.cssText = 'display: none !important; visibility: hidden !important; opacity: 0 !important;';
                openBtn.disabled = true;
                openBtn.style.pointerEvents = 'none';
                openBtn.style.opacity = '0';
                openBtn.style.cursor = 'default';
                openBtn.innerHTML = '–û—Ç–∫—Ä—ã—Ç—å <span>üöÄ</span>';
            }
            
            mainPage.style.display = 'block';
            mainPage.classList.remove('hidden');
            
            modal.style.display = 'none';
            modal.classList.remove('active');
            
            document.querySelectorAll('.prize-item').forEach(item => {
                item.classList.remove('win', 'spinning-prizes');
            });
            
            isOpening = false;
            currentCase = null;
            
            if (tg) {
                tg.HapticFeedback.impactOccurred('light');
            }
        }
        
        window.goBack = goBack;

        function updateLiveCarousel() {
            const liveCarousel = document.getElementById('liveCarousel');
            liveCarousel.innerHTML = '';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –ø–æ–¥–∞—Ä–∫–æ–≤ –∏–∑ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ (–≤—ã–∏–≥—Ä—ã—à–∏ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
            const displayPrizes = globalPrizes.slice(-10).reverse();
            
            if (displayPrizes.length === 0) {
                return;
            }
            
            displayPrizes.forEach((prize, index) => {
                const liveItem = document.createElement('div');
                liveItem.className = 'live-item';
                // –ü–æ—Å–ª–µ–¥–Ω–∏–π (—Å–∞–º—ã–π –Ω–æ–≤—ã–π) –ø–æ–¥–∞—Ä–æ–∫ –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º
                if (index === 0) {
                    liveItem.classList.add('active');
                }
                
                const iconStr = String(prize.icon || '');
                if (iconStr.toLowerCase().includes('.png') || iconStr.toLowerCase().includes('.jpg') || iconStr.toLowerCase().includes('.jpeg')) {
                    const img = document.createElement('img');
                    img.src = prize.icon;
                    img.alt = prize.name;
                    img.onerror = function() {
                        liveItem.textContent = '?';
                    };
                    liveItem.appendChild(img);
                } else {
                    liveItem.textContent = prize.icon || '?';
                }
                
                liveCarousel.appendChild(liveItem);
            });
        }

        async function showPrizeModal(prize) {
            // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–∞—Ä–æ–∫ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            addToInventory(prize);
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤—ã–∏–≥—Ä—ã—à –Ω–∞ —Å–µ—Ä–≤–µ—Ä (–∏–ª–∏ –¥–æ–±–∞–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ –ø—Ä–∏ –æ—à–∏–±–∫–µ)
            const sent = await sendPrizeToServer(prize);
            
            // –ï—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä, –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
            if (sent) {
                setTimeout(() => {
                    fetchGlobalPrizes();
                }, 500);
            }
            
            const modalPrizeIcon = document.getElementById('modalPrizeIcon');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∏–∫–æ–Ω–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
            const iconStr = String(prize.icon || '');
            if (iconStr.toLowerCase().includes('.png') || iconStr.toLowerCase().includes('.jpg') || iconStr.toLowerCase().includes('.jpeg')) {
                const img = document.createElement('img');
                img.src = prize.icon;
                img.alt = prize.name;
                img.style.width = '120px';
                img.style.height = '120px';
                img.style.objectFit = 'contain';
                img.onerror = function() {
                    console.error('Failed to load modal prize image:', this.src);
                    modalPrizeIcon.textContent = prize.name || '?';
                };
                modalPrizeIcon.innerHTML = '';
                modalPrizeIcon.appendChild(img);
            } else {
                modalPrizeIcon.textContent = prize.icon || '?';
            }
            
            document.getElementById('modalPrizeName').textContent = prize.name;
            document.getElementById('modalPrizeValue').innerHTML = formatPrice(prize.value);
            document.getElementById('prizeModal').classList.add('active');
            
            // –ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–û—Ç–∫—Ä—ã—Ç—å" —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–µ—Ç–∞–ª–µ–π –∫–æ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            const openBtn = document.getElementById('openBtn');
            if (openBtn) {
                openBtn.classList.remove('show');
                openBtn.style.display = 'none';
                openBtn.style.visibility = 'hidden';
                openBtn.style.opacity = '0';
                openBtn.style.pointerEvents = 'none';
                openBtn.style.cssText += 'display: none !important; visibility: hidden !important; opacity: 0 !important; pointer-events: none !important;';
            }
        }

        function closePrizeModal() {
            document.getElementById('prizeModal').classList.remove('active');
            document.querySelectorAll('.prize-item').forEach(item => {
                item.classList.remove('win');
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–û—Ç–∫—Ä—ã—Ç—å" –æ–±—Ä–∞—Ç–Ω–æ –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            const openBtn = document.getElementById('openBtn');
            const detailPage = document.getElementById('caseDetailPage');
            const detailIcon = document.getElementById('detailIcon');
            
            if (openBtn && detailPage && detailPage.classList.contains('active')) {
                openBtn.disabled = false;
                openBtn.classList.add('show');
                openBtn.style.cssText = 'display: flex !important; visibility: visible !important; opacity: 1 !important;';
                openBtn.innerHTML = '–û—Ç–∫—Ä—ã—Ç—å <span>üöÄ</span>';
            }
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–∫–æ–Ω–∫—É –∫–µ–π—Å–∞ –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            if (detailIcon && currentCase) {
                if (currentCase.icon.includes('.jpg') || currentCase.icon.includes('.png') || currentCase.icon.includes('.jpeg')) {
                    const imgPath = currentCase.icon;
                    detailIcon.innerHTML = '';
                    const img = document.createElement('img');
                    img.src = imgPath;
                    img.alt = 'Case';
                    img.style.width = '100%';
                    img.style.maxWidth = '300px';
                    img.style.height = 'auto';
                    img.style.objectFit = 'contain';
                    img.style.display = 'block';
                    img.onload = function() {
                        console.log('Image loaded successfully:', this.src);
                    };
                    img.onerror = function() {
                        console.error('Failed to load detail image:', this.src);
                        // –ü–æ–ø—Ä–æ–±—É–µ–º –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å –ø—É—Ç—å
                        try {
                            const decodedPath = decodeURIComponent(imgPath);
                            if (decodedPath !== imgPath) {
                                this.src = decodedPath;
                            } else {
                                detailIcon.textContent = 'üîê';
                            }
                        } catch(e) {
                            detailIcon.textContent = 'üîê';
                        }
                    };
                    detailIcon.appendChild(img);
                } else {
                    detailIcon.textContent = currentCase.icon || 'üîê';
                }
                detailIcon.style.display = 'flex';
            }
            
            if (tg) {
                tg.HapticFeedback.impactOccurred('light');
            }
        }

        function openNextCase() {
            closePrizeModal();
            if (tg) {
                tg.HapticFeedback.impactOccurred('medium');
            }
        }
        
        window.openNextCase = openNextCase;

        document.querySelector('.subscribe-btn').addEventListener('click', () => {
            if (tg) {
                tg.openTelegramLink('https://t.me/YourChannel');
                tg.HapticFeedback.impactOccurred('medium');
            } else {
                window.open('https://t.me/YourChannel', '_blank');
            }
        });

        document.querySelector('.balance-section button').addEventListener('click', () => {
            if (tg) {
                tg.showAlert('–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞');
                tg.HapticFeedback.impactOccurred('light');
            } else {
                alert('–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞');
            }
        });

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è
        function updateProfileInfo() {
            const user = tg?.initDataUnsafe?.user;
            const profileUsername = document.getElementById('profileUsername');
            const profileAvatar = document.getElementById('profileAvatarImg');
            
            if (user) {
                if (profileUsername) {
                    profileUsername.textContent = user.first_name || user.username || 'User';
                }
                if (profileAvatar && user.photo_url) {
                    profileAvatar.src = user.photo_url;
                }
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
        function updateInventory() {
            const inventoryGrid = document.getElementById('inventoryGrid');
            const inventoryCount = document.getElementById('inventoryCount');
            
            if (!inventoryGrid) return;
            
            inventoryGrid.innerHTML = '';
            
            if (inventoryCount) {
                inventoryCount.textContent = userInventory.length;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–∞–∫—Å–∏–º—É–º 9 –ø—Ä–µ–¥–º–µ—Ç–æ–≤ (3x3), + —Å–ª–æ—Ç –¥–ª—è –ø–µ—Ä–µ–ª–∏—Å—Ç—ã–≤–∞–Ω–∏—è
            const itemsToShow = userInventory.slice(0, 8);
            
            itemsToShow.forEach(item => {
                const slot = document.createElement('div');
                slot.className = 'inventory-slot has-item';
                
                const iconStr = String(item.icon || '');
                if (iconStr.toLowerCase().includes('.png') || iconStr.toLowerCase().includes('.jpg') || iconStr.toLowerCase().includes('.jpeg')) {
                    const img = document.createElement('img');
                    img.src = item.icon;
                    img.alt = item.name;
                    img.onerror = function() {
                        slot.innerHTML = '<span class="empty-icon">üéÅ</span>';
                    };
                    slot.appendChild(img);
                } else {
                    slot.innerHTML = `<span class="empty-icon">${item.icon || 'üéÅ'}</span>`;
                }
                
                const valueBadge = document.createElement('div');
                valueBadge.className = 'item-value';
                valueBadge.innerHTML = formatPrice(item.value);
                slot.appendChild(valueBadge);
                
                slot.addEventListener('click', () => {
                    showInventoryItemModal(item);
                });
                
                inventoryGrid.appendChild(slot);
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Å—Ç—ã–µ —Å–ª–æ—Ç—ã –∏–ª–∏ —Å–ª–æ—Ç –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            const remaining = userInventory.length - itemsToShow.length;
            const slotsNeeded = 9 - itemsToShow.length;
            
            for (let i = 0; i < slotsNeeded; i++) {
                const slot = document.createElement('div');
                slot.className = 'inventory-slot';
                
                if (i === slotsNeeded - 1 && remaining > 0) {
                    slot.innerHTML = '<span class="next-icon">‚Üí</span>';
                    slot.addEventListener('click', () => {
                        if (tg) {
                            tg.showAlert('–°–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
                        }
                    });
                } else {
                    slot.innerHTML = '<span class="empty-icon">üéÅ</span>';
                }
                
                inventoryGrid.appendChild(slot);
            }
        }
        
        // –ü—Ä–æ–¥–∞–∂–∞ –≤—Å–µ—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤
        function sellAllItems() {
            if (userInventory.length === 0) {
                if (tg) {
                    tg.showAlert('–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç');
                } else {
                    alert('–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç');
                }
                return;
            }
            
            const totalValue = userInventory.reduce((sum, item) => sum + item.value, 0);
            
            if (tg) {
                tg.showConfirm(`–ü—Ä–æ–¥–∞—Ç—å –≤—Å–µ –ø—Ä–µ–¥–º–µ—Ç—ã –∑–∞ ${formatPrice(totalValue)}?`, (confirmed) => {
                    if (confirmed) {
                        balance += totalValue;
                        document.getElementById('balance').textContent = balance.toFixed(2);
                        userInventory = [];
                        saveInventory(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –±–∞–ª–∞–Ω—Å –ª–æ–∫–∞–ª—å–Ω–æ
                        saveUserData(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                        updateInventory();
                        tg.HapticFeedback.notificationOccurred('success');
                    }
                });
            } else {
                if (confirm(`–ü—Ä–æ–¥–∞—Ç—å –≤—Å–µ –ø—Ä–µ–¥–º–µ—Ç—ã –∑–∞ ${totalValue.toFixed(2)}?`)) {
                    balance += totalValue;
                    document.getElementById('balance').textContent = balance.toFixed(2);
                    userInventory = [];
                    saveInventory(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –±–∞–ª–∞–Ω—Å –ª–æ–∫–∞–ª—å–Ω–æ
                    saveUserData(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                    updateInventory();
                }
            }
        }

        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', () => {
                const page = item.dataset.page;
                document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                item.classList.add('active');
                
                const mainPage = document.getElementById('mainPage');
                const caseDetailPage = document.getElementById('caseDetailPage');
                const profilePage = document.getElementById('profilePage');
                
                if (!mainPage || !caseDetailPage || !profilePage) {
                    console.error('Pages not found!');
                    return;
                }
                
                const openBtn = document.getElementById('openBtn');
                
                // –í—Å–µ–≥–¥–∞ —Å–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –≤–∫–ª–∞–¥–æ–∫
                if (openBtn) {
                    openBtn.style.display = 'none';
                    openBtn.style.visibility = 'hidden';
                    openBtn.style.opacity = '0';
                    openBtn.classList.remove('show');
                    openBtn.disabled = true;
                    openBtn.style.pointerEvents = 'none';
                }
                
                if (page === 'cases') {
                    mainPage.style.display = 'block';
                    mainPage.classList.remove('hidden');
                    caseDetailPage.style.display = 'none';
                    caseDetailPage.classList.remove('active');
                    profilePage.style.display = 'none';
                } else if (page === 'profile') {
                    mainPage.style.display = 'none';
                    mainPage.classList.add('hidden');
                    caseDetailPage.style.display = 'none';
                    caseDetailPage.classList.remove('active');
                    profilePage.style.display = 'block';
                    profilePage.style.visibility = 'visible';
                    profilePage.style.opacity = '1';
                    updateInventory();
                    updateProfileInfo();
                    if (tg) {
                        tg.HapticFeedback.impactOccurred('light');
                    }
                } else if (page === 'crash') {
                    mainPage.style.display = 'none';
                    mainPage.classList.add('hidden');
                    caseDetailPage.style.display = 'none';
                    caseDetailPage.classList.remove('active');
                    profilePage.style.display = 'none';
                    const crashPage = document.getElementById('crashPage');
                    if (crashPage) {
                        crashPage.style.display = 'block';
                        // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∫—Ä–∞—à–∞
                        document.getElementById('crashBalance').textContent = balance.toFixed(2);
                        initCrashGame();
                    }
                    // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–û—Ç–∫—Ä—ã—Ç—å" –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –≤ –∫—Ä–∞—à
                    if (openBtn) {
                        openBtn.style.display = 'none';
                        openBtn.style.visibility = 'hidden';
                        openBtn.style.opacity = '0';
                        openBtn.classList.remove('show');
                        openBtn.disabled = true;
                        openBtn.style.pointerEvents = 'none';
                    }
                    if (tg) {
                        tg.HapticFeedback.impactOccurred('light');
                    }
                }
            });
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è
        document.querySelectorAll('.top-up-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                if (tg) {
                    tg.showAlert('–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞');
                    tg.HapticFeedback.impactOccurred('medium');
                } else {
                    alert('–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞');
                }
            });
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ü—Ä–æ–¥–∞—Ç—å –≤—Å–µ"
        const sellAllBtn = document.getElementById('sellAllBtn');
        if (sellAllBtn) {
            sellAllBtn.addEventListener('click', sellAllItems);
        }
        
        // –¢–µ–∫—É—â–∏–π –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç –∏–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
        let selectedInventoryItem = null;
        
        // –ü–æ–∫–∞–∑ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–µ–¥–º–µ—Ç–∞ –∏–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
        function showInventoryItemModal(item) {
            selectedInventoryItem = item;
            const modal = document.getElementById('inventoryItemModal');
            const modalIcon = document.getElementById('inventoryModalIcon');
            const modalName = document.getElementById('inventoryModalName');
            const modalPrice = document.getElementById('inventoryModalPrice');
            
            if (!modal || !modalIcon || !modalName || !modalPrice) return;
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ
            modalName.textContent = item.name;
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–µ–Ω—É
            modalPrice.innerHTML = formatPrice(item.value);
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–∫–æ–Ω–∫—É
            modalIcon.innerHTML = '';
            const iconStr = String(item.icon || '');
            if (iconStr.toLowerCase().includes('.png') || iconStr.toLowerCase().includes('.jpg') || iconStr.toLowerCase().includes('.jpeg')) {
                const img = document.createElement('img');
                img.src = item.icon;
                img.alt = item.name;
                img.onerror = function() {
                    modalIcon.innerHTML = '<span style="font-size: 80px;">üéÅ</span>';
                };
                modalIcon.appendChild(img);
            } else {
                modalIcon.innerHTML = `<span style="font-size: 80px;">${item.icon || 'üéÅ'}</span>`;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            modal.classList.add('active');
            
            if (tg) {
                tg.HapticFeedback.impactOccurred('light');
            }
        }
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–µ–¥–º–µ—Ç–∞ –∏–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
        function closeInventoryModal() {
            const modal = document.getElementById('inventoryItemModal');
            if (modal) {
                modal.classList.remove('active');
            }
            selectedInventoryItem = null;
            
            if (tg) {
                tg.HapticFeedback.impactOccurred('light');
            }
        }
        
        window.closeInventoryModal = closeInventoryModal;
        
        // –ü—Ä–æ–¥–∞–∂–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞
        function sellSelectedItem() {
            if (!selectedInventoryItem) return;
            
            const item = selectedInventoryItem;
            
            if (tg) {
                tg.showConfirm(`–ü—Ä–æ–¥–∞—Ç—å "${item.name}" –∑–∞ üíé ${item.value.toFixed(2)}?`, (confirmed) => {
                    if (confirmed) {
                        balance += item.value;
                        document.getElementById('balance').textContent = balance.toFixed(2);
                        
                        // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥–º–µ—Ç –∏–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
                        userInventory = userInventory.filter(invItem => invItem.id !== item.id);
                        saveInventory(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –±–∞–ª–∞–Ω—Å –ª–æ–∫–∞–ª—å–Ω–æ
                        saveUserData(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                        updateInventory();
                        closeInventoryModal();
                        
                        tg.HapticFeedback.notificationOccurred('success');
                    }
                });
            } else {
                if (confirm(`–ü—Ä–æ–¥–∞—Ç—å "${item.name}" –∑–∞ ${item.value.toFixed(2)}?`)) {
                    balance += item.value;
                    document.getElementById('balance').textContent = balance.toFixed(2);
                    
                    // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥–º–µ—Ç –∏–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
                    userInventory = userInventory.filter(invItem => invItem.id !== item.id);
                    saveInventory(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –±–∞–ª–∞–Ω—Å –ª–æ–∫–∞–ª—å–Ω–æ
                    saveUserData(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                    updateInventory();
                    closeInventoryModal();
                }
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ü—Ä–æ–¥–∞—Ç—å" –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
        const sellItemBtn = document.getElementById('sellItemBtn');
        if (sellItemBtn) {
            sellItemBtn.addEventListener('click', sellSelectedItem);
        }

        // ========== –ö–†–ê–® –ò–ì–†–ê ==========
        let crashMultiplier = 1.00;
        let crashAnimationId = null;
        let crashGameRunning = false;
        let crashPlayers = [];
        let crashGraphPoints = [];
        let selectedMultiplier = null;
        let betType = 'balance';
        let userBet = null;
        let crashRoundActive = false;
        let crashTarget = 1.00;
        let crashDirection = 1; // 1 = –≤–≤–µ—Ä—Ö, -1 = –≤–Ω–∏–∑ (–∫—Ä–∞—à)

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã –ö—Ä–∞—à
        function initCrashGame() {
            const canvas = document.getElementById('crashCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            
            startNewCrashRound(ctx, canvas);
            updateCrashBetsList();
            updateBetItemSelect();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Å—Ç–∞–≤–æ–∫ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
            if (window.crashBetsInterval) {
                clearInterval(window.crashBetsInterval);
            }
            window.crashBetsInterval = setInterval(() => {
                if (document.getElementById('crashPage')?.style.display === 'block') {
                    updateCrashBetsList();
                }
            }, 500);
        }

        // –ù–∞—á–∞–ª–æ –Ω–æ–≤–æ–≥–æ —Ä–∞—É–Ω–¥–∞ –∫—Ä–∞—à–∞ (—Å –∫—É–ª–¥–∞—É–Ω–æ–º –¥–ª—è —Å—Ç–∞–≤–æ–∫)
        function startNewCrashRound(ctx, canvas) {
            // –°–Ω–∞—á–∞–ª–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫—É–ª–¥–∞—É–Ω, —á—Ç–æ–±—ã –ª—é–¥–∏ —É—Å–ø–µ–ª–∏ –ø–æ—Å—Ç–∞–≤–∏—Ç—å —Å—Ç–∞–≤–∫–∏
            showCrashCooldown(10, ctx, canvas);
        }
        
        // –ü–æ–∫–∞–∑ –∫—É–ª–¥–∞—É–Ω–∞ –ø–µ—Ä–µ–¥ –Ω–æ–≤—ã–º —Ä–∞—É–Ω–¥–æ–º (–≤–æ –≤—Ä–µ–º—è –∫—É–ª–¥–∞—É–Ω–∞ –º–æ–∂–Ω–æ —Å—Ç–∞–≤–∏—Ç—å —Å—Ç–∞–≤–∫–∏)
        function showCrashCooldown(seconds, ctx, canvas) {
            const multiplierElement = document.getElementById('currentMultiplier');
            const makeBetBtn = document.getElementById('makeBetBtn');
            
            // –†–∞–∑—Ä–µ—à–∞–µ–º —Å—Ç–∞–≤–∫–∏ –≤–æ –≤—Ä–µ–º—è –∫—É–ª–¥–∞—É–Ω–∞
            crashRoundActive = false; // –†–∞—É–Ω–¥ –µ—â–µ –Ω–µ –Ω–∞—á–∞–ª—Å—è
            crashMultiplier = 1.00;
            
            // –û—á–∏—â–∞–µ–º –≥—Ä–∞—Ñ–∏–∫ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫—É–ª–¥–∞—É–Ω
            crashGraphPoints = [];
            
            let remaining = seconds;
            
            const countdown = setInterval(() => {
                if (multiplierElement) {
                    multiplierElement.textContent = `–°—Ç–∞–≤–∫–∏ —á–µ—Ä–µ–∑ ${remaining}...`;
                    multiplierElement.style.color = '#ffaa00';
                    multiplierElement.style.borderColor = '#ffaa00';
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º canvas —Å —Ç–µ–∫—Å—Ç–æ–º –∫—É–ª–¥–∞—É–Ω–∞
                if (ctx && canvas) {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.fillStyle = '#ffaa00';
                    ctx.font = 'bold 28px Arial';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(`–°—Ç–∞–≤–∫–∏ –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è`, canvas.width / 2, canvas.height / 2 - 20);
                    ctx.fillText(`${remaining}...`, canvas.width / 2, canvas.height / 2 + 20);
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å—Ç–∞–≤–æ–∫
                const makeBetBtn = document.getElementById('makeBetBtn');
                if (makeBetBtn && userBet && !userBet.cashedOut) {
                    makeBetBtn.textContent = '–°—Ç–∞–≤–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞';
                    makeBetBtn.disabled = true;
                } else if (makeBetBtn && !userBet) {
                    makeBetBtn.textContent = '–°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É';
                    makeBetBtn.disabled = false;
                }
                
                remaining--;
                
                if (remaining < 0) {
                    clearInterval(countdown);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å—Ç–∞–≤–æ–∫
                    if (makeBetBtn && userBet && !userBet.cashedOut && crashRoundActive === false) {
                        makeBetBtn.textContent = '–ó–∞–±—Ä–∞—Ç—å';
                        makeBetBtn.disabled = false;
                    }
                    
                    // –ù–∞—á–∏–Ω–∞–µ–º —Ä–∞—É–Ω–¥
                    crashRoundActive = true;
                    crashMultiplier = 1.00;
                    crashDirection = 1;
                    crashGraphPoints = [{ x: 0, y: canvas.height - 50, multiplier: 1.00 }];
                    
                    // –û–¥–∏–Ω–∞–∫–æ–≤—ã–π –∫—Ä–∞—à –¥–ª—è –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤ (–Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞—á–∞–ª–∞ —Ä–∞—É–Ω–¥–∞)
                    const roundStartTime = Date.now();
                    const seed = roundStartTime % 1000000; // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å—Ç–∞—Ç–æ–∫ –æ—Ç –≤—Ä–µ–º–µ–Ω–∏ –∫–∞–∫ seed
                    const random = seed / 1000000; // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ 0-1
                    
                    // –ú–æ–º–µ–Ω—Ç –∫—Ä–∞—à–∞ (–æ—Ç 1.01 –¥–æ 10.0) - –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –¥–ª—è –≤—Å–µ—Ö
                    crashTarget = 1.01 + random * 9.0;
                    
                    // –í—Ä–µ–º—è –¥–æ –∫—Ä–∞—à–∞ (–æ—Ç 3 –¥–æ 20 —Å–µ–∫—É–Ω–¥) - –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –¥–ª—è –≤—Å–µ—Ö
                    const timeToCrash = 3000 + random * 17000;
                    
                    setTimeout(() => {
                        if (crashRoundActive) {
                            // –†–µ–∑–∫–æ –æ–±—Ä—É—à–∏–≤–∞–µ–º –≥—Ä–∞—Ñ–∏–∫
                            crashDirection = -1;
                            crashMultiplier = 0.01;
                            
                            // –í–∏–±—Ä–∞—Ü–∏—è –ø—Ä–∏ –∫—Ä–∞—à–µ
                            if (tg) {
                                tg.HapticFeedback.notificationOccurred('error');
                            }
                            
                            // –°—Ä–∞–∑—É –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫—Ä–∞—à
                            crashRoundActive = false;
                            processCrashRound();
                            
                            // –ù–∞—á–∏–Ω–∞–µ–º –∫—É–ª–¥–∞—É–Ω 10 —Å–µ–∫—É–Ω–¥
                            setTimeout(() => {
                                showCrashCooldown(10, ctx, canvas);
                            }, 500);
                        }
                    }, timeToCrash);
                    
                    // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é —Ä–æ—Å—Ç–∞ –≥—Ä–∞—Ñ–∏–∫–∞
                    startCrashAnimation(ctx, canvas);
                }
            }, 1000);
        }

        // –ê–Ω–∏–º–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–∞ –∫—Ä–∞—à–∞
        function startCrashAnimation(ctx, canvas) {
            if (crashAnimationId) {
                cancelAnimationFrame(crashAnimationId);
            }
            
            let speed = 0.008 + Math.random() * 0.015;
            
            const animate = () => {
                // –ù–µ –æ–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞—Ñ–∏–∫ –µ—Å–ª–∏ —Ä–∞—É–Ω–¥ –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω (–∫—É–ª–¥–∞—É–Ω –∏–ª–∏ –∫—Ä–∞—à –∑–∞–≤–µ—Ä—à–µ–Ω)
                if (!crashRoundActive) {
                    return;
                }
                
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –º–Ω–æ–∂–∏—Ç–µ–ª—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ä–∞—É–Ω–¥ –∞–∫—Ç–∏–≤–µ–Ω
                if (crashRoundActive && crashDirection === 1) {
                    // –î–≤–∏–∂–µ–Ω–∏–µ –≤–≤–µ—Ä—Ö (—Ä–æ—Å—Ç)
                    crashMultiplier += speed;
                    if (crashMultiplier >= crashTarget) {
                        crashDirection = -1; // –î–æ—Å—Ç–∏–≥–ª–∏ —Ü–µ–ª–∏, –Ω–∞—á–∏–Ω–∞–µ–º –∫—Ä–∞—à
                    }
                } else if (crashDirection === -1) {
                    // –†–µ–∑–∫–æ–µ –ø–∞–¥–µ–Ω–∏–µ - —Å—Ä–∞–∑—É –¥–æ –Ω—É–ª—è (–æ–±—Ä–∞–±–æ—Ç–∫–∞ —É–∂–µ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –≤ setTimeout)
                    crashMultiplier = 0.01;
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ—á–∫—É –Ω–∞ –≥—Ä–∞—Ñ–∏–∫
                const x = crashGraphPoints.length * 2;
                // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –º–Ω–æ–∂–∏—Ç–µ–ª—å –≤ Y –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—É (1.0 = –Ω–∏–∑, –≤—ã—à–µ = –≤—ã—à–µ –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ)
                const multiplierPercent = ((crashMultiplier - 1.0) / 9.0) * 100;
                const y = canvas.height - 50 - (multiplierPercent / 100) * (canvas.height - 100);
                
                crashGraphPoints.push({ x, y, multiplier: crashMultiplier });
                
                // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ—á–µ–∫
                if (crashGraphPoints.length > canvas.width / 2) {
                    crashGraphPoints = crashGraphPoints.slice(-Math.floor(canvas.width / 2));
                    crashGraphPoints.forEach((point, i) => {
                        point.x = i * 2;
                    });
                }
                
                // –†–∏—Å—É–µ–º –≥—Ä–∞—Ñ–∏–∫
                ctx.strokeStyle = crashDirection === 1 ? '#00ff00' : '#ff0000';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(crashGraphPoints[0].x, crashGraphPoints[0].y);
                for (let i = 1; i < crashGraphPoints.length; i++) {
                    ctx.lineTo(crashGraphPoints[i].x, crashGraphPoints[i].y);
                }
                ctx.stroke();
                
                // –ü—Ä–∏ —Ä–µ–∑–∫–æ–º –ø–∞–¥–µ–Ω–∏–∏ —Ä–∏—Å—É–µ–º –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—É—é –∫—Ä–∞—Å–Ω—É—é –ª–∏–Ω–∏—é
                if (crashDirection === -1 && crashMultiplier <= 0.01) {
                    ctx.strokeStyle = '#ff0000';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    const lastPoint = crashGraphPoints[crashGraphPoints.length - 2];
                    if (lastPoint) {
                        ctx.moveTo(lastPoint.x, lastPoint.y);
                        ctx.lineTo(lastPoint.x, canvas.height - 50);
                    }
                    ctx.stroke();
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–Ω–æ–∂–∏—Ç–µ–ª—è
                const multiplierElement = document.getElementById('currentMultiplier');
                if (multiplierElement && crashRoundActive) {
                    multiplierElement.textContent = `x${crashMultiplier.toFixed(2)}`;
                    multiplierElement.style.color = crashDirection === 1 ? '#00ff00' : '#ff0000';
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—ã–∏–≥—Ä—ã—à–∏ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ä–∞—É–Ω–¥ –∞–∫—Ç–∏–≤–µ–Ω
                if (crashRoundActive) {
                    checkCrashWins();
                }
                
                crashAnimationId = requestAnimationFrame(animate);
            };
            
            animate();
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞—É–Ω–¥–∞ –∫—Ä–∞—à–∞
        function processCrashRound() {
            // –í—Å–µ –Ω–µ –∑–∞–±—Ä–∞–Ω–Ω—ã–µ —Å—Ç–∞–≤–∫–∏ —Ç–µ—Ä—è—é—Ç—Å—è
            let lostCount = 0;
            crashPlayers.forEach(player => {
                if (!player.cashedOut) {
                    // –°—Ç–∞–≤–∫–∞ –ø–æ—Ç–µ—Ä—è–Ω–∞ - —á–µ–ª–æ–≤–µ–∫ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç
                    player.cashedOut = true;
                    player.winnings = 0;
                    player.cashOutMultiplier = 0;
                    lostCount++;
                    
                    // –ï—Å–ª–∏ —ç—Ç–æ —Å—Ç–∞–≤–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                    if (player.id === userBet?.id) {
                        userBet = null;
                        const makeBetBtn = document.getElementById('makeBetBtn');
                        if (makeBetBtn) {
                            makeBetBtn.textContent = '–°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É';
                        }
                    }
                }
            });
            
            if (lostCount > 0 && tg) {
                tg.showAlert(`–ö–†–ê–®! –ü–æ—Ç–µ—Ä—è–Ω–æ ${lostCount} —Å—Ç–∞–≤–æ–∫`);
                tg.HapticFeedback.notificationOccurred('error');
            }
            
            updateCrashBetsList();
            
            // –û—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤ –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ä–∞—É–Ω–¥–∞ —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                crashPlayers = [];
                updateCrashBetsList();
            }, 5000);
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–∏–≥—Ä—ã—à–µ–π –∏–≥—Ä–æ–∫–æ–≤
        function checkCrashWins() {
            crashPlayers.forEach(player => {
                if (!player.cashedOut && player.autoCash && crashMultiplier >= player.autoCash) {
                    cashOutPlayer(player.id);
                }
            });
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–∫—É—â–∏—Ö –≤—ã–∏–≥—Ä—ã—à–µ–π
            if (crashPlayers.length > 0 && crashPlayers.some(p => !p.cashedOut)) {
                setTimeout(() => updateCrashBetsList(), 1000);
            }
        }

        // –í—ã–≤–æ–¥ —Å—Ç–∞–≤–∫–∏
        function cashOutPlayer(playerId) {
            const player = crashPlayers.find(p => p.id === playerId);
            if (!player || player.cashedOut) return;
            
            const betValue = player.itemValue || player.betAmount;
            const winnings = betValue * crashMultiplier;
            player.cashedOut = true;
            player.winnings = winnings;
            player.cashOutMultiplier = crashMultiplier;
            
            // –ï—Å–ª–∏ —ç—Ç–æ —Å—Ç–∞–≤–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –¥–æ–±–∞–≤–ª—è–µ–º –≤—ã–∏–≥—Ä—ã—à –∫ –±–∞–ª–∞–Ω—Å—É
            if (playerId === userBet?.id) {
                balance += winnings;
                document.getElementById('balance').textContent = balance.toFixed(2);
                document.getElementById('crashBalance').textContent = balance.toFixed(2);
                saveInventory();
                saveUserData();
                
                if (tg) {
                    tg.showAlert(`–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${winnings.toFixed(2)}!`);
                    tg.HapticFeedback.notificationOccurred('success');
                }
                
                userBet = null;
                const makeBetBtn = document.getElementById('makeBetBtn');
                if (makeBetBtn) {
                    makeBetBtn.textContent = '–°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É';
                }
            }
            
            updateCrashBetsList();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å—Ç–∞–≤–æ–∫
        function updateCrashBetsList() {
            const betsList = document.getElementById('betsList');
            if (!betsList) return;
            
            betsList.innerHTML = '';
            const headerDiv = document.createElement('div');
            headerDiv.className = 'bets-list-header';
            headerDiv.textContent = `–°—Ç–∞–≤–∫–∏ (${crashPlayers.length})`;
            betsList.appendChild(headerDiv);
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∏–≥—Ä–æ–∫–æ–≤: —Å–Ω–∞—á–∞–ª–∞ –∞–∫—Ç–∏–≤–Ω—ã–µ, –ø–æ—Ç–æ–º –≤—ã–≤–µ–¥–µ–Ω–Ω—ã–µ
            const activePlayers = crashPlayers.filter(p => !p.cashedOut);
            const cashedPlayers = crashPlayers.filter(p => p.cashedOut);
            const sortedPlayers = [...activePlayers, ...cashedPlayers].reverse();
            
            sortedPlayers.forEach(player => {
                const betItem = document.createElement('div');
                betItem.className = 'bet-item';
                
                const avatar = document.createElement('div');
                avatar.className = 'bet-item-avatar';
                const user = tg?.initDataUnsafe?.user;
                if (player.userId === user?.id && user?.photo_url) {
                    const img = document.createElement('img');
                    img.src = user.photo_url;
                    img.style.width = '100%';
                    img.style.height = '100%';
                    img.style.objectFit = 'cover';
                    img.style.borderRadius = '50%';
                    avatar.appendChild(img);
                } else {
                    avatar.textContent = player.avatar || 'üë§';
                }
                betItem.appendChild(avatar);
                
                const info = document.createElement('div');
                info.className = 'bet-item-info';
                
                const username = document.createElement('div');
                username.className = 'bet-item-username';
                username.textContent = player.username;
                info.appendChild(username);
                
                const details = document.createElement('div');
                details.className = 'bet-item-details';
                if (player.itemName) {
                    const betValue = player.itemValue || 0;
                    details.innerHTML = `üéÅ ${player.itemName}<br><span style="font-size: 12px; opacity: 0.8;">–°—Ç–∞–≤–∫–∞: ${betValue.toFixed(2)}</span>`;
                } else {
                    details.innerHTML = `<span class="currency-icon" style="width: 12px; height: 12px; display: inline-block;"></span> ${player.betAmount.toFixed(2)}<br><span style="font-size: 12px; opacity: 0.8;">–ú–Ω–æ–∂–∏—Ç–µ–ª—å: ${(player.cashOutMultiplier || crashMultiplier).toFixed(2)}</span>`;
                }
                info.appendChild(details);
                
                betItem.appendChild(info);
                
                const winnings = document.createElement('div');
                winnings.className = 'bet-item-winnings';
                if (player.cashedOut) {
                    if (player.winnings > 0) {
                        winnings.innerHTML = `<span class="currency-icon" style="width: 14px; height: 14px; display: inline-block;"></span> ${player.winnings.toFixed(2)} ‚úÖ`;
                        winnings.style.color = '#00ff00';
                    } else {
                        winnings.innerHTML = `‚ùå –ü–æ—Ç–µ—Ä—è–Ω–æ`;
                        winnings.style.color = '#ff0000';
                    }
                } else {
                    const betValue = player.itemValue || player.betAmount;
                    const currentWinnings = betValue * crashMultiplier;
                    winnings.innerHTML = `<span class="currency-icon" style="width: 14px; height: 14px; display: inline-block;"></span> ${currentWinnings.toFixed(2)}`;
                    winnings.style.color = '#667eea';
                }
                betItem.appendChild(winnings);
                
                betsList.appendChild(betItem);
            });
            
            document.getElementById('playersCount').textContent = crashPlayers.length;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∞ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –¥–ª—è —Å—Ç–∞–≤–∫–∏
        function updateBetItemSelect() {
            const select = document.getElementById('betItemSelect');
            if (!select) return;
            
            select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç</option>';
            userInventory.forEach(item => {
                const option = document.createElement('option');
                option.value = item.id;
                option.textContent = `${item.name} (${formatPrice(item.value).replace(/<[^>]*>/g, '')})`;
                option.dataset.item = JSON.stringify(item);
                select.appendChild(option);
            });
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∏–ø–∞ —Å—Ç–∞–≤–∫–∏
        document.querySelectorAll('.bet-type-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.bet-type-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                betType = btn.dataset.type;
                
                const amountInput = document.getElementById('betAmountInput');
                const itemSelect = document.getElementById('betItemSelect');
                
                if (betType === 'balance') {
                    amountInput.style.display = 'block';
                    if (itemSelect) itemSelect.style.display = 'none';
                } else {
                    amountInput.style.display = 'none';
                    if (itemSelect) itemSelect.style.display = 'block';
                }
            });
        });

        // –í—ã–±–æ—Ä –º–Ω–æ–∂–∏—Ç–µ–ª—è –∞–≤—Ç–æ-–≤—ã–≤–æ–¥–∞
        document.querySelectorAll('.multiplier-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                if (btn.dataset.mult === 'auto') {
                    selectedMultiplier = null;
                } else {
                    selectedMultiplier = parseFloat(btn.dataset.mult);
                }
                document.querySelectorAll('.multiplier-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            });
        });

        // –°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É
        const makeBetBtn = document.getElementById('makeBetBtn');
        if (makeBetBtn) {
            makeBetBtn.addEventListener('click', () => {
                // –ï—Å–ª–∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–∞—è —Å—Ç–∞–≤–∫–∞ –∏ —Ä–∞—É–Ω–¥ –∏–¥–µ—Ç, –º–æ–∂–Ω–æ –∑–∞–±—Ä–∞—Ç—å
                if (userBet && crashRoundActive && !userBet.cashedOut) {
                    cashOutPlayer(userBet.id);
                    return;
                }
                
                // –ù–µ–ª—å–∑—è —Å—Ç–∞–≤–∏—Ç—å –≤–æ –≤—Ä–µ–º—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ä–∞—É–Ω–¥–∞ (–º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –≤–æ –≤—Ä–µ–º—è –∫—É–ª–¥–∞—É–Ω–∞)
                if (crashRoundActive) {
                    if (tg) {
                        tg.showAlert('–†–∞—É–Ω–¥ —É–∂–µ –∏–¥–µ—Ç! –î–æ–∂–¥–∏—Ç–µ—Å—å —Å–ª–µ–¥—É—é—â–µ–≥–æ –∫—É–ª–¥–∞—É–Ω–∞.');
                    } else {
                        alert('–†–∞—É–Ω–¥ —É–∂–µ –∏–¥–µ—Ç! –î–æ–∂–¥–∏—Ç–µ—Å—å —Å–ª–µ–¥—É—é—â–µ–≥–æ –∫—É–ª–¥–∞—É–Ω–∞.');
                    }
                    return;
                }
                
                const amountInput = document.getElementById('betAmountInput');
                const itemSelect = document.getElementById('betItemSelect');
                
                let betAmount = 0;
                let itemData = null;
                
                if (betType === 'balance') {
                    betAmount = parseFloat(amountInput.value);
                    if (!betAmount || betAmount <= 0 || betAmount > balance) {
                        if (tg) {
                            tg.showAlert('–ù–µ–≤–µ—Ä–Ω–∞—è —Å—É–º–º–∞ —Å—Ç–∞–≤–∫–∏!');
                        } else {
                            alert('–ù–µ–≤–µ—Ä–Ω–∞—è —Å—É–º–º–∞ —Å—Ç–∞–≤–∫–∏!');
                        }
                        return;
                    }
                } else {
                    const selectedOption = itemSelect.options[itemSelect.selectedIndex];
                    if (!selectedOption || !selectedOption.value) {
                        if (tg) {
                            tg.showAlert('–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç!');
                        } else {
                            alert('–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç!');
                        }
                        return;
                    }
                    itemData = JSON.parse(selectedOption.dataset.item);
                    betAmount = itemData.value;
                }
                
                const user = tg?.initDataUnsafe?.user;
                const newBet = {
                    id: Date.now(),
                    userId: user?.id || Math.random(),
                    username: user?.first_name || user?.username || '–ò–≥—Ä–æ–∫',
                    avatar: user?.photo_url ? null : 'üë§',
                    betAmount: betAmount,
                    itemName: itemData?.name || null,
                    itemValue: itemData?.value || null,
                    itemId: itemData?.id || null,
                    betMultiplier: selectedMultiplier,
                    autoCash: selectedMultiplier,
                    cashedOut: false,
                    timestamp: Date.now()
                };
                
                if (betType === 'balance') {
                    balance -= betAmount;
                    document.getElementById('balance').textContent = balance.toFixed(2);
                    document.getElementById('crashBalance').textContent = balance.toFixed(2);
                    saveInventory();
                    saveUserData();
                } else {
                    userInventory = userInventory.filter(item => item.id !== itemData.id);
                    saveInventory();
                    saveUserData();
                    updateBetItemSelect();
                }
                
                userBet = newBet;
                crashPlayers.push(newBet);
                updateCrashBetsList();
                
                // –ú–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ä–∞—É–Ω–¥ –∞–∫—Ç–∏–≤–µ–Ω
                if (crashRoundActive) {
                    makeBetBtn.textContent = '–ó–∞–±—Ä–∞—Ç—å';
                } else {
                    makeBetBtn.textContent = '–°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É';
                }
                
                if (tg) {
                    tg.showAlert('–°—Ç–∞–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞! –î–æ–∂–¥–∏—Ç–µ—Å—å –Ω–∞—á–∞–ª–∞ —Ä–∞—É–Ω–¥–∞.');
                    tg.HapticFeedback.impactOccurred('medium');
                }
            });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∫—Ä–∞—à–∞
        document.getElementById('crashBalance')?.parentElement.querySelector('button')?.addEventListener('click', () => {
            if (tg) {
                tg.showAlert('–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞');
                tg.HapticFeedback.impactOccurred('light');
            } else {
                alert('–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞');
            }
        });
    </script>
</body>
</html>
